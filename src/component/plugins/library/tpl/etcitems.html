{% extends 'struct.html' %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12 mb-3 d-flex flex-wrap align-items-center gap-3">
            <div>
                <h2 class="h4 mb-1">Другие предметы (EtcItems)</h2>
                <div class="small text-muted">Тип: {{ etc_current_type }} • Всего: {{ etc_total }} • Страница {{
                    etc_page }} / {{ etc_pages }}</div>
            </div>
            <div class="ms-auto">
                <a href="/library" class="btn btn-sm btn-outline-secondary">← Назад в библиотеку</a>
            </div>
        </div>
    </div>

    {% if etc_types is empty %}
    <div class="alert alert-info">Нет предметов.</div>
    {% else %}
    <form id="etc-filter-form" class="row g-2 mb-3">
        <div class="col-auto">
            <label for="etcType" class="form-label mb-1 small text-muted">Тип</label>
            <select name="type" id="etcType" class="form-select form-select-sm"
                onchange="this.form.page.value=1; this.form.submit();">
                {% for t,c in etc_types %}
                <option value="{{ t }}" {% if t==etc_current_type %}selected{% endif %}>{{ t }} ({{ c }})</option>
                {% endfor %}
            </select>
        </div>
        <input type="hidden" name="page" value="{{ etc_page }}">
    </form>

    <div class="card custom-card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-sm table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width:42px"></th>
                            <th>Название</th>
                            <th class="text-center">Stack</th>
                            <th class="text-end">Цена</th>
                            <th class="text-end">Вес</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if etc_items is empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">Нет предметов для отображения.</td>
                        </tr>
                        {% else %}
                        {% for i in etc_items %}
                        {% include 'library/tpl/_etcitem_row.html' with {'i': i} %}
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% if etc_quest_included and etc_items is not empty and etc_current_type != 'quest' %}
    <div class="alert alert-warning mt-2 py-2 mb-2 small">
        Показаны предметы вместе с квестовыми, так как неквестовых в этом типе нет.
    </div>
    {% endif %}

    <nav aria-label="Пагинация" class="mt-3">
        <ul class="pagination pagination-sm flex-wrap mb-0">
            {% set base = '/library/items/etcitems?type=' ~ etc_current_type %}
            <li class="page-item {% if etc_page<=1 %}disabled{% endif %}"><a class="page-link"
                    href="{{ base ~ '&page=' ~ (etc_page-1) }}" tabindex="-1">‹</a></li>
            {% set start = etc_page - 3 %}
            {% set end = etc_page + 3 %}
            {% if start < 1 %}{% set end=end + (1-start) %}{% set start=1 %}{% endif %} {% if end> etc_pages %}{% set
                start = start - (end-etc_pages) %}{% set end = etc_pages %}{% endif %}
                {% if start < 1 %}{% set start=1 %}{% endif %} {% if start> 1 %}
                    <li class="page-item"><a class="page-link" href="{{ base ~ '&page=1' }}">1</a></li>
                    {% if start > 2 %}<li class="page-item disabled"><span class="page-link">…</span></li>{% endif %}
                    {% endif %}
                    {% for p in start..end %}
                    <li class="page-item {% if p==etc_page %}active{% endif %}"><a class="page-link"
                            href="{{ base ~ '&page=' ~ p }}">{{ p }}</a></li>
                    {% endfor %}
                    {% if end < etc_pages %} {% if end < etc_pages - 1 %}<li class="page-item disabled"><span
                            class="page-link">…</span></li>{% endif %}
                        <li class="page-item"><a class="page-link" href="{{ base ~ '&page=' ~ etc_pages }}">{{ etc_pages
                                }}</a></li>
                        {% endif %}
                        <li class="page-item {% if etc_page>=etc_pages %}disabled{% endif %}"><a class="page-link"
                                href="{{ base ~ '&page=' ~ (etc_page+1) }}">›</a></li>
        </ul>
    </nav>
    {% endif %}

    {% if db_timing is defined %}
    <div class="small text-muted mt-2">DB: {{ db_timing.db_open_ms }} ms • Read: {{ db_timing.read_ms }} ms • Total: {{
        db_timing.total_ms }} ms</div>
    {% endif %}
</div>

<style>
    .pagination .page-link {
        cursor: pointer;
    }

    .table td,
    .table th {
        vertical-align: middle;
    }
</style>
{% endblock %}