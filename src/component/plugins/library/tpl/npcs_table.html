<div class="row">
    <div class="col-12">
        <div class="card custom-card">
            <div class="card-body">
                <div class="table-responsive position-relative">
                    <div id="npc-loading" class="preloader-overlay" style="display:none;">
                        <div class="preloader-content text-center">
                            <div class="preloader-spinner mx-auto mb-2">
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                            </div>
                            <div class="preloader-text">
                                <h5>Загрузка списка NPC</h5>
                                <p class="text-muted">Подготовка данных...</p>
                            </div>
                        </div>
                    </div>

                    <table id="npc-table" class="table table-bordered table-striped table-sm align-middle w-100"
                        style="visibility:hidden;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Имя</th>
                                <th>Уровень</th>
                                <th>Тип</th>
                                <th>Раса</th>
                                <th>HP</th>
                                <th>MP</th>
                                <th>P.Atk</th>
                                <th>M.Atk</th>
                                <th>P.Def</th>
                                <th>M.Def</th>
                                <th>Atk Spd</th>
                                <th>Crit</th>
                                <th>Acc</th>
                                <th>Evasion</th>
                                <th>Skills</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="preload" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
</noscript>

<style>
    /* ...existing CSS from npcs.html omitted for brevity... */
</style>

<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        if (!window.jQuery) { console.warn('jQuery не найден для DataTables'); return; }
        const $table = $('#npc-table');
        const $loader = $('#npc-loading');
        $loader.show();
        setTimeout(() => {
            try {
                const dt = $table.DataTable({
                    paging: true,
                    pageLength: 25,
                    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, 'Все']],
                    ordering: true,
                    order: [[2, 'asc']],
                    info: true,
                    searching: true,
                    deferRender: true,
                    processing: true,
                    serverSide: true,
                    ajax: '{{ npc_data_url|default("/library/npcs/data") }}',
                    stateSave: true,
                    stateDuration: 300,
                    dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rtip',
                    language: { processing: 'Обработка...', search: '', searchPlaceholder: 'Поиск...', lengthMenu: 'Показать _MENU_', info: '_START_—_END_ из _TOTAL_', infoEmpty: 'Нет записей', infoFiltered: '(из _MAX_)', zeroRecords: 'Ничего не найдено', emptyTable: 'Нет данных', paginate: { previous: '‹ Пред', next: 'След ›' } },
                    autoWidth: false,
                    columnDefs: [
                        { targets: [0, 2, 3, 4], className: 'text-center align-middle', width: '1px' },
                        { targets: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14], className: 'text-end align-middle', width: '1px' },
                        { targets: 15, className: 'align-middle' }
                    ],
                    initComplete: function () {
                        $loader.addClass('preloader-hide');
                        setTimeout(() => { $loader.addClass('d-none'); $table.addClass('dt-initialized'); }, 300);
                    }
                });
                let to; const $input = $table.closest('.dataTables_wrapper').find('.dataTables_filter input');
                $input.off('keyup search').on('keyup search', function () { clearTimeout(to); const v = this.value; to = setTimeout(() => { dt.search(v).draw(); }, 300); });
            } catch (e) { console.error('NPC DataTable init error', e); $loader.addClass('preloader-hide'); }
        }, 30);
    });
</script>