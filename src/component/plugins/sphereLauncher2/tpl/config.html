{% extends 'struct.html' %}

{% block title %}–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –õ–∞—É–Ω—á–µ—Ä–∞ –∏ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏{% endblock %}

{% block content %}

<div class="container-fluid">
    <div class="row ">
        <div class="col-xl-12">
            <div class="card custom-card">
                <div class="card-header">
                    <div class="card-title">
                        1. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JSON –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (launcher.json)
                    </div>
                </div>
                <div class="card-body">

                    <div class="shadow p-3 mb-5 bg-body rounded">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="fw-bold text-primary mb-2">–û –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–∞—É–Ω—á–µ—Ä–∞</h6>
                                <p class="mb-2">–≠—Ç–∞ —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–∞—É–Ω—á–µ—Ä–∞. –õ–∞—É–Ω—á–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                                    –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–∫–∞–∂–∏—Ç–µ —Ç—É—Ç.</p>
                                <p class="mb-2">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–µ–Ω—è—Ç—å.</p>
                                <p class="mb-0">–í —ç—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∏–∑ –∫–∞–∫–æ–≥–æ –º–µ—Å—Ç–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫
                                    –∞—Ä—Ö–∏–≤–æ–≤ –∏ —Å–∞–º–∏ –∞—Ä—Ö–∏–≤—ã, –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ—é –ª–µ–Ω—Ç—É –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è
                                    –ª–∞—É–Ω—á–µ—Ä–∞.</p>
                            </div>

                            <div class="col-md-4">
                                <div id="json-drop-zone"
                                    class="json-drop-zone-compact border border-2 border-dashed border-info rounded p-3 text-center">
                                    <div class="drop-zone-content">
                                        <i class="ri-file-upload-line fs-1 text-info mb-2"></i>
                                        <h6 class="text-info mb-1">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</h6>
                                        <p class="small text-muted mb-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ launcher.json</p>
                                        <input type="file" id="json-file-input" accept=".json" style="display: none;">
                                        <button type="button" class="btn btn-outline-info btn-sm"
                                            onclick="document.getElementById('json-file-input').click()">
                                            <i class="ri-folder-open-line me-1"></i>–í—ã–±—Ä–∞—Ç—å
                                        </button>
                                    </div>
                                </div>
                                <div id="drop-zone-status" class="mt-2" style="display: none;">
                                    <div class="alert alert-success py-2 mb-0 small">
                                        <i class="ri-check-line me-1"></i>
                                        <span id="loaded-file-name"></span> –∑–∞–≥—Ä—É–∂–µ–Ω!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form id="json-generator-form">
                        <div class="row g-3">
                            <div class="col-md-6 border-end">
                                <h5>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞</h5>
                                <div class="mb-3">
                                    <label class="form-label">–°—Å—ã–ª–∫–∏ –Ω–∞ CSV</label>
                                    <div class="input-group">
                                        <input class="form-control" id="csv-input"
                                            placeholder="https://example.com/updates.csv" type="url">
                                        <button class="btn btn-outline-secondary" id="add-csv-btn"
                                            type="button">–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë</button>
                                    </div>
                                    <ul class="list-group mt-2" id="csv-list"></ul>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–°—Å—ã–ª–∫–∏ –Ω–∞ –∞—Ä—Ö–∏–≤—ã</label>
                                    <div class="input-group">
                                        <input class="form-control" id="archive-input"
                                            placeholder="https://example.com/archives/" type="url">
                                        <button class="btn btn-outline-secondary" id="add-archive-btn"
                                            type="button">–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë</button>
                                    </div>
                                    <ul class="list-group mt-2" id="archive-list"></ul>
                                </div>

                                <div class="mb-3 mt-3">
                                    <label class="form-label d-flex justify-content-between align-items-center">–ê–∫–∫–∞—É–Ω—Ç
                                        –º–µ–Ω–µ–¥–∂–µ—Ä
                                        <small class="text-muted">(autologin)</small>
                                    </label>
                                    <div class="p-2 bg-white border rounded">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="autologin-enable">
                                            <label class="form-check-label small" for="autologin-enable">–í–∫–ª—é—á–∏—Ç—å
                                                –∞–∫–∫–∞—É–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä</label>
                                        </div>

                                        –ê–∫–∫–∞—É–Ω—Ç –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å –∏ –Ω–∏–∫
                                        –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã.
                                        –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤–≤–æ–¥–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ª–∞—É–Ω—á–µ—Ä–µ.
                                        –í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–∞ –æ–ø—Ü–∏—è –¥–ª—è —Ç–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤—Ö–æ–¥ —á–µ—Ä–µ–∑
                                        –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫ l2.exe

                                        <div class="mb-2">
                                            <label class="form-label small">–ü–∞—Ç—Ç–µ—Ä–Ω</label>
                                            <input class="form-control form-control-sm" id="autologin-pattern"
                                                placeholder="-login=%login% -password=%password% -charname=%charname%"
                                                type="text">
                                            <small class="text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤–∏–¥–∞ %login%, %password%,
                                                %charname%</small>
                                        </div>

                                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–ª–æ–≥–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h5>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞</h5>
                                <div class="p-3 bg-light rounded">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">–ù–∞–∑–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞:</label>
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <label class="form-label small">üá∑üá∫ –†—É—Å—Å–∫–∏–π (ru)</label>
                                                <input class="form-control form-control-sm" id="app-name-ru"
                                                    placeholder="–ò–≥—Ä–∞—Ç—å" type="text" value="–ò–≥—Ä–∞—Ç—å">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá∫üá∏ English (en)</label>
                                                <input class="form-control form-control-sm" id="app-name-en"
                                                    placeholder="Play" type="text" value="Play">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá™üá∏ Espa√±ol (es)</label>
                                                <input class="form-control form-control-sm" id="app-name-es"
                                                    placeholder="Jugar" type="text" value="Jugar">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üáµüáπ Portugu√™s (pt)</label>
                                                <input class="form-control form-control-sm" id="app-name-pt"
                                                    placeholder="Jogar" type="text" value="Jogar">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (uk)</label>
                                                <input class="form-control form-control-sm" id="app-name-uk"
                                                    placeholder="–ì—Ä–∞—Ç–∏" type="text" value="–ì—Ä–∞—Ç–∏">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨ (el)</label>
                                                <input class="form-control form-control-sm" id="app-name-el"
                                                    placeholder="Œ†Œ±ŒØŒæœÑŒµ" type="text" value="Œ†Œ±ŒØŒæœÑŒµ">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-2">
                                        <div class="col-12">
                                            <label class="form-label">–ü—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É</label>
                                            <input value="system/l2.exe" class="form-control" id="app-exe-input"
                                                placeholder="–ü—É—Ç—å –∫ exe (–Ω–∞–ø—Ä. system/l2.exe)" type="text"
                                                value="system/l2.exe">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                            <input class="form-control" id="app-args-input" placeholder="" type="text">
                                        </div>
                                        <div class="col-12">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <label class="form-label mb-0">–¢—Ä–∏–≥–≥–µ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                                <button type="button" class="btn btn-outline-secondary btn-sm"
                                                    id="add-trigger-btn">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä</button>
                                            </div>
                                            <div id="trigger-container" class="vstack gap-2"></div>
                                            <small class="text-muted">–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤. –ü–æ–∫–∞
                                                –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–∏–ø—ã <code>copy</code>, <code>WindowMinimize</code> –∏
                                                <code>WindowClose</code> (–±–µ–∑
                                                –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤).</small>
                                        </div>
                                        <div class="col-12 text-end">
                                            <button class="btn btn-outline-primary btn-sm" id="add-app-btn"
                                                type="button">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
                                        </div>
                                    </div>
                                </div>
                                <ul class="list-group mt-2" id="app-list"></ul>
                            </div>

                            <hr class="my-4">

                            <div class="col-md-6">
                                <label class="form-label" for="json-launcher-version">–í–µ—Ä—Å–∏—è –ª–∞—É–Ω—á–µ—Ä–∞</label>
                                <input class="form-control" id="json-launcher-version" type="text" value="1.0.0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="json-launcher-link">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–∞—É–Ω—á–µ—Ä–∞</label>
                                <input class="form-control" id="json-launcher-link"
                                    placeholder="https://example.com/launcher.exe" type="url">
                            </div>

                            <hr class="my-4">

                            <div class="col-12">
                                <h5>–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h5>
                                <div class="p-3 bg-light rounded">
                                    <div class="row g-3">
                                        <div class="col-md-2">
                                            <label class="form-label">–Ø–∑—ã–∫</label>
                                            <select class="form-select" id="news-lang-select">
                                                <option selected value="ru">–†—É—Å—Å–∫–∏–π (ru)</option>
                                                <option value="en">English (en)</option>
                                                <option value="es">Espa√±ol (es)</option>
                                                <option value="pt">Portugu√™s (pt)</option>
                                                <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (uk)</option>
                                                <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨ (el)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-5"><label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input
                                                class="form-control" id="news-name-input"
                                                placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" type="text"></div>
                                        <div class="col-md-5"><label class="form-label">–î–∞—Ç–∞</label><input
                                                class="form-control" id="news-date-input" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥"
                                                type="text"></div>
                                        <div class="col-12"><label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea
                                                class="form-control" id="news-desc-input"
                                                placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–æ ~140 —Å–∏–º–≤–æ–ª–æ–≤)" rows="2"></textarea>
                                        </div>
                                        <div class="col-md-6"><label class="form-label">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label><input
                                                class="form-control" id="news-image-input"
                                                placeholder="https://example.com/image.png" type="url"></div>
                                        <div class="col-md-6"><label class="form-label">URL —Å—Å—ã–ª–∫–∏</label><input
                                                class="form-control" id="news-link-input"
                                                placeholder="https://example.com/full-news" type="url"></div>
                                        <div class="col-12 text-end"><button class="btn btn-outline-primary btn-sm"
                                                id="add-news-btn" type="button">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button></div>
                                    </div>
                                </div>
                                <div class="mt-3" id="news-container"></div>
                            </div>

                            <hr class="my-4">

                            <div class="col-12 text-center">
                                <button class="btn btn-success btn-lg" id="generate-json-btn" type="button">
                                    <i class="ri-file-download-line"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å launcher.json
                                </button>
                                <br>

                                <small class="d-block text-muted">
                                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ launcher.json —Å–µ–±–µ –Ω–∞ —Å–∞–π—Ç.<br>
                                    –ò –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –ª–∞—É–Ω—á–µ—Ä–∞ —É–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª launcher.json
                                </small>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

{% endblock %}

{% block js %}
<style>
    .json-drop-zone-compact {
        min-height: 140px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .json-drop-zone-compact:hover {
        border-color: #0dcaf0 !important;
        background-color: rgba(13, 202, 240, 0.05);
    }

    .json-drop-zone-compact.drag-over {
        border-color: #198754 !important;
        background-color: rgba(25, 135, 84, 0.1);
        transform: scale(1.05);
    }

    .json-drop-zone-compact.drag-over .drop-zone-content {
        color: #198754;
    }

    .json-drop-zone-compact.error {
        border-color: #dc3545 !important;
        background-color: rgba(220, 53, 69, 0.1);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        // === –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ó–ê–ì–†–£–ó–ö–ò JSON –§–ê–ô–õ–ê ===
        const dropZone = document.getElementById('json-drop-zone');
        const fileInput = document.getElementById('json-file-input');
        const dropZoneStatus = document.getElementById('drop-zone-status');
        const loadedFileName = document.getElementById('loaded-file-name');

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ drag and drop
        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleJsonFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleJsonFile(e.target.files[0]);
            }
        });

        function handleJsonFile(file) {
            if (!file.name.toLowerCase().endsWith('.json')) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    loadJsonData(jsonData);
                    showSuccess(file.name);
                } catch (error) {
                    showError('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function showSuccess(fileName) {
            dropZone.classList.remove('error');
            loadedFileName.textContent = fileName;
            dropZoneStatus.style.display = 'block';
            dropZoneStatus.innerHTML = `
            <div class="alert alert-success py-2 mb-0 small">
                <i class="ri-check-line me-1"></i>
                <span>${fileName}</span> –∑–∞–≥—Ä—É–∂–µ–Ω!
            </div>
        `;
        }

        function showError(message) {
            dropZone.classList.add('error');
            dropZoneStatus.style.display = 'block';
            dropZoneStatus.innerHTML = `
            <div class="alert alert-danger py-2 mb-0 small">
                <i class="ri-error-warning-line me-1"></i>
                ${message}
            </div>
        `;
        }

        function loadJsonData(data) {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            clearAllData();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º CSV URLs
            if (data.download && data.download.csv) {
                data.download.csv.forEach(url => {
                    addToList('csv-list', url);
                });
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º Archive URLs
            if (data.download && data.download.archives) {
                data.download.archives.forEach(url => {
                    addToList('archive-list', url);
                });
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∞—É–Ω—á–µ—Ä–µ
            if (data.lastLauncherVersion) {
                document.getElementById('json-launcher-version').value = data.lastLauncherVersion;
            }
            if (data.launcherLink) {
                document.getElementById('json-launcher-link').value = data.launcherLink;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            if (data.application && Array.isArray(data.application)) {
                data.application.forEach(app => {
                    loadApplicationData(app);
                });
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏
            if (data.news) {
                Object.keys(data.news).forEach(lang => {
                    if (Array.isArray(data.news[lang])) {
                        data.news[lang].forEach(newsItem => {
                            loadNewsData(lang, newsItem);
                        });
                    }
                });
            }
            // –ó–∞–≥—Ä—É–∂–∞–µ–º autologin
            if (data.autologin) {
                const ag = data.autologin;
                if (ag.pattern) {
                    document.getElementById('autologin-pattern').value = ag.pattern;
                }
                // autologin description field was removed from UI
                // enable if autologin block exists
                document.getElementById('autologin-enable').checked = true;
            }
        }

        function clearAllData() {
            document.getElementById('csv-list').innerHTML = '';
            document.getElementById('archive-list').innerHTML = '';
            document.getElementById('app-list').innerHTML = '';
            document.getElementById('news-container').innerHTML = '';

            document.getElementById('json-launcher-version').value = '1.0.0';
            document.getElementById('json-launcher-link').value = '';

            // clear autologin
            document.getElementById('autologin-enable').checked = false;
            document.getElementById('autologin-pattern').value = '';
        }

        function addToList(listId, value) {
            const list = document.getElementById(listId);
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
            listItem.innerHTML = `
            <span class="text-break">${value}</span>
            <button type="button" class="btn btn-danger btn-sm remove-btn">
                <i class="ri-delete-bin-line"></i>
            </button>
        `;
            list.appendChild(listItem);
        }

        function loadApplicationData(app) {
            const appList = document.getElementById('app-list');
            const supportedLanguages = ['ru', 'en', 'es', 'pt', 'uk', 'el'];

            let nameTranslations = {};

            if (typeof app.name === 'string') {
                nameTranslations.ru = app.name;
            } else if (Array.isArray(app.name) && app.name.length > 0) {
                nameTranslations = app.name[0] || {};
            }

            const listItem = document.createElement('li');
            listItem.className = 'list-group-item';

            listItem.dataset.exe = app.exe || '';
            listItem.dataset.args = app.args || '';
            listItem.dataset.translations = JSON.stringify(nameTranslations);
            listItem.dataset.triggers = JSON.stringify(app.trigger || []);

            const namesDisplay = supportedLanguages
                .filter(lang => nameTranslations[lang])
                .map(lang => `${lang.toUpperCase()}: "${nameTranslations[lang]}"`)
                .join(', ');

            let triggersSummary = '';
            if (app.trigger && Array.isArray(app.trigger) && app.trigger.length) {
                const parts = app.trigger.map(t => {
                    if (t.name === 'copy') {
                        return `copy(${t.src || ''} -> ${t.dst || ''})`;
                    }
                    return t.name || '';
                });
                triggersSummary = `<small class="d-block text-warning">–¢—Ä–∏–≥–≥–µ—Ä—ã: ${parts.join(', ')}</small>`;
            }

            listItem.innerHTML = `
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${app.exe || ''}</strong>
                    <small class="d-block text-muted">–ê—Ä–≥—É–º–µ–Ω—Ç—ã: ${app.args || '–Ω–µ—Ç'}</small>
                    <small class="d-block text-info">–ù–∞–∑–≤–∞–Ω–∏—è: ${namesDisplay}</small>
                    ${triggersSummary}
                </div>
                <button type="button" class="btn btn-danger btn-sm remove-btn">
                    <i class="ri-delete-bin-line"></i>
                </button>
            </div>
        `;

            appList.appendChild(listItem);
        }

        function loadNewsData(lang, newsItem) {
            const newsContainer = document.getElementById('news-container');

            let langGroup = newsContainer.querySelector(`.news-language-group[data-lang="${lang}"]`);
            if (!langGroup) {
                langGroup = document.createElement('div');
                langGroup.className = 'news-language-group mb-3';
                langGroup.dataset.lang = lang;
                langGroup.innerHTML = `
                <h5>–ù–æ–≤–æ—Å—Ç–∏ (${lang})</h5>
                <ul class="list-group"></ul>
            `;
                newsContainer.appendChild(langGroup);
            }

            const newsList = langGroup.querySelector('.list-group');
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item';

            listItem.dataset.name = newsItem.name || '';
            listItem.dataset.description = newsItem.description || '';
            listItem.dataset.image = newsItem.image || '';
            listItem.dataset.link = newsItem.link || '';
            listItem.dataset.date = newsItem.date || '';

            listItem.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <strong>${newsItem.name || ''}</strong> <small class="text-muted">(${newsItem.date || ''})</small>
                    <p class="mb-1 text-break">${newsItem.description || ''}</p>
                    <small class="text-muted text-break">–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${newsItem.image || '–Ω–µ—Ç'}<br>–°—Å—ã–ª–∫–∞: ${newsItem.link || '–Ω–µ—Ç'}</small>
                </div>
                <button type="button" class="btn btn-danger btn-sm remove-btn ms-2">
                    <i class="ri-delete-bin-line"></i>
                </button>
            </div>
        `;
            newsList.appendChild(listItem);
        }


    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏ (CSV, –ê—Ä—Ö–∏–≤—ã) ---
        function setupSimpleList(inputId, btnId, listId) {
            const input = document.getElementById(inputId);
            const addBtn = document.getElementById(btnId);
            const list = document.getElementById(listId);

            addBtn.addEventListener('click', () => {
                const value = input.value.trim();
                if (value) {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                    listItem.innerHTML = `
                        <span class="text-break">${value}</span>
                        <button type="button" class="btn btn-danger btn-sm remove-btn">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    `;
                    list.appendChild(listItem);
                    input.value = '';
                }
            });
        }

        setupSimpleList('csv-input', 'add-csv-btn', 'csv-list');
        setupSimpleList('archive-input', 'add-archive-btn', 'archive-list');

        // ...existing code...

        document.addEventListener('click', (e) => {
            if (e.target.closest('.remove-btn')) {
                const listItem = e.target.closest('li');
                const listGroup = listItem.parentElement;
                listItem.remove();

                // –ï—Å–ª–∏ —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –æ–Ω–∞ —Å—Ç–∞–ª–∞ –ø—É—Å—Ç–æ–π, —É–¥–∞–ª—è–µ–º –≤—Å—é –≥—Ä—É–ø–ø—É
                if (listGroup.children.length === 0 && listGroup.parentElement.classList.contains('news-language-group')) {
                    listGroup.parentElement.remove();
                }
            }
        });

        const appExeInput = document.getElementById('app-exe-input');
        const appArgsInput = document.getElementById('app-args-input');
        const addAppBtn = document.getElementById('add-app-btn');
        const appList = document.getElementById('app-list');
        const supportedLanguages = ['ru', 'en', 'es', 'pt', 'uk', 'el'];
        const triggerContainer = document.getElementById('trigger-container');
        const addTriggerBtn = document.getElementById('add-trigger-btn');

        function createTriggerRow(prefill) {
            const div = document.createElement('div');
            div.className = 'border rounded p-2 trigger-row';
            div.innerHTML = `
            <div class="row g-2 align-items-end">
                <div class="col-md-3">
                    <label class="form-label small mb-1">–¢–∏–ø</label>
                    <select class="form-select form-select-sm trigger-type">
                        <option value="">-- –Ω–µ –≤—ã–±—Ä–∞–Ω–æ --</option>
                        <option value="copy">copy</option>
                        <option value="WindowMinimize">WindowMinimize</option>
                        <option value="WindowClose">WindowClose</option>
                        <option value="StartGameReport">StartGameReport</option>
                    </select>
                </div>
                <div class="col-md-4 copy-fields d-none">
                    <label class="form-label small mb-1">–ò—Å—Ö–æ–¥–Ω–∞—è –ø–∞–ø–∫–∞</label>
                    <input type="text" class="form-control form-control-sm trigger-src" placeholder="system/files/x1">
                </div>
                <div class="col-md-4 copy-fields d-none">
                    <label class="form-label small mb-1">–ü–∞–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                    <input type="text" class="form-control form-control-sm trigger-dst" placeholder="system/">
                </div>
                <div class="col-md-6 url-field d-none">
                    <label class="form-label small mb-1">URL</label>
                    <input type="text" class="form-control form-control-sm trigger-url" placeholder="https://example.com/api">
                </div>
                <div class="col-md-1 text-end">
                    <button type="button" class="btn btn-outline-danger btn-sm remove-trigger-btn" title="–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä"><i class="ri-close-line"></i></button>
                </div>
                <div class="col-12 mt-2">
                    <div class="alert alert-secondary py-2 mb-0 small trigger-description" style="min-height:40px;">
                        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span class="desc-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—è.</span>
                    </div>
                </div>
            </div>`;
            triggerContainer.appendChild(div);
            if (prefill) {
                const select = div.querySelector('.trigger-type');
                select.value = prefill.name || '';
                if (prefill.name === 'copy') {
                    div.querySelectorAll('.copy-fields').forEach(el => el.classList.remove('d-none'));
                    div.querySelector('.trigger-src').value = prefill.src || '';
                    div.querySelector('.trigger-dst').value = prefill.dst || '';
                }
                if (prefill.name === 'StartGameReport') {
                    div.querySelectorAll('.url-field').forEach(el => el.classList.remove('d-none'));
                    div.querySelector('.trigger-url').value = prefill.url || '';
                }
                // update description for prefilled row
                updateTriggerDescription(div);
            }
        }

        addTriggerBtn.addEventListener('click', () => createTriggerRow());

        triggerContainer.addEventListener('change', (e) => {
            if (e.target.classList.contains('trigger-type')) {
                const row = e.target.closest('.trigger-row');
                const val = e.target.value;
                if (val === 'copy') {
                    row.querySelectorAll('.copy-fields').forEach(el => el.classList.remove('d-none'));
                    row.querySelectorAll('.url-field').forEach(el => { el.classList.add('d-none'); el.querySelector('input').value = ''; });
                } else if (val === 'StartGameReport') {
                    row.querySelectorAll('.url-field').forEach(el => el.classList.remove('d-none'));
                    row.querySelectorAll('.copy-fields').forEach(el => { el.classList.add('d-none'); el.querySelector('input').value = ''; });
                } else {
                    row.querySelectorAll('.copy-fields').forEach(el => { el.classList.add('d-none'); el.querySelector('input').value = ''; });
                    row.querySelectorAll('.url-field').forEach(el => { el.classList.add('d-none'); el.querySelector('input').value = ''; });
                }
            }
        });

        // Update trigger description on type or field changes
        triggerContainer.addEventListener('input', (e) => {
            const row = e.target.closest && e.target.closest('.trigger-row');
            if (!row) return;
            if (e.target.classList.contains('trigger-src') || e.target.classList.contains('trigger-dst') || e.target.classList.contains('trigger-type') || e.target.classList.contains('trigger-url')) {
                updateTriggerDescription(row);
            }
        });

        function updateTriggerDescription(row) {
            const type = row.querySelector('.trigger-type').value;
            const descEl = row.querySelector('.desc-text');
            if (!descEl) return;
            if (type === 'copy') {
                const src = row.querySelector('.trigger-src').value.trim();
                const dst = row.querySelector('.trigger-dst').value.trim();
                const srcText = src ? `<code>${escapeHtml(src)}</code>` : '<em>–Ω–µ —É–∫–∞–∑–∞–Ω–∞</em>';
                const dstText = dst ? `<code>${escapeHtml(dst)}</code>` : '<em>–Ω–µ —É–∫–∞–∑–∞–Ω–∞</em>';
                descEl.innerHTML = `–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ ${srcText} –≤ ${dstText}. –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è –¥–æ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.`;
            } else if (type === 'WindowMinimize') {
                descEl.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å –æ–∫–Ω–æ –ª–∞—É–Ω—á–µ—Ä–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.';
            } else if (type === 'WindowClose') {
                descEl.textContent = '–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ª–∞—É–Ω—á–µ—Ä–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.';
            } else if (type === 'StartGameReport') {
                const url = row.querySelector('.trigger-url').value.trim();
                const urlText = url ? `<code>${escapeHtml(url)}</code>` : '<em>–Ω–µ —É–∫–∞–∑–∞–Ω</em>';
                descEl.innerHTML = `–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã –Ω–∞ URL: ${urlText}. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.`;
            } else {
                descEl.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—è.';
            }
        }

        function escapeHtml(str) {
            return str.replace(/[&<>"']/g, function (c) { return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": "&#39;" }[c]; });
        }

        triggerContainer.addEventListener('click', (e) => {
            if (e.target.closest('.remove-trigger-btn')) {
                e.target.closest('.trigger-row').remove();
            }
        });

        addAppBtn.addEventListener('click', () => {
            const exe = appExeInput.value.trim();
            const args = appArgsInput.value.trim();
            const nameTranslations = {};
            let hasAnyName = false;
            supportedLanguages.forEach(lang => {
                const input = document.getElementById(`app-name-${lang}`);
                if (input && input.value.trim()) {
                    nameTranslations[lang] = input.value.trim();
                    hasAnyName = true;
                }
            });
            if (!hasAnyName || !exe) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∏ –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É.');
                return;
            }
            // –°–±–æ—Ä —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
            const triggers = [];
            let triggerError = false;
            triggerContainer.querySelectorAll('.trigger-row').forEach(row => {
                const type = row.querySelector('.trigger-type').value;
                if (!type) return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ
                if (type === 'copy') {
                    const src = row.querySelector('.trigger-src').value.trim();
                    const dst = row.querySelector('.trigger-dst').value.trim();
                    if (!src || !dst) {
                        triggerError = true;
                    } else {
                        triggers.push({ name: 'copy', src, dst });
                    }
                } else if (type === 'WindowMinimize') {
                    // No parameters required for WindowMinimize
                    triggers.push({ name: 'WindowMinimize' });
                } // –î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä WindowClose
                else if (type === 'WindowClose') {
                    triggers.push({ name: 'WindowClose' });
                } else if (type === 'StartGameReport') {
                    const url = row.querySelector('.trigger-url').value.trim();
                    if (!url) {
                        triggerError = true;
                    } else {
                        triggers.push({ name: 'StartGameReport', url });
                    }
                }
            });
            if (triggerError) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ copy –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ.');
                return;
            }
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item';
            listItem.dataset.exe = exe;
            listItem.dataset.args = args;
            listItem.dataset.translations = JSON.stringify(nameTranslations);
            listItem.dataset.triggers = JSON.stringify(triggers);
            const namesDisplay = supportedLanguages
                .filter(lang => nameTranslations[lang])
                .map(lang => `${lang.toUpperCase()}: "${nameTranslations[lang]}"`)
                .join(', ');
            let triggersSummary = '';
            if (triggers.length) {
                const parts = triggers.map(t => t.name === 'copy' ? `copy(${t.src} -> ${t.dst})` : t.name);
                triggersSummary = `<small class=\"d-block text-warning\">–¢—Ä–∏–≥–≥–µ—Ä—ã: ${parts.join(', ')}<\/small>`;
            }
            listItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${exe}</strong>
                        <small class="d-block text-muted">–ê—Ä–≥—É–º–µ–Ω—Ç—ã: ${args || '–Ω–µ—Ç'}</small>
                        <small class="d-block text-info">–ù–∞–∑–≤–∞–Ω–∏—è: ${namesDisplay}</small>
                        ${triggersSummary}
                    </div>
                    <button type="button" class="btn btn-danger btn-sm remove-btn">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            `;
            appList.appendChild(listItem);
            appExeInput.value = '';
            appArgsInput.value = '';
            triggerContainer.innerHTML = ''; // –æ—á–∏—â–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        });


        const newsLangSelect = document.getElementById('news-lang-select');
        const newsNameInput = document.getElementById('news-name-input');
        const newsDateInput = document.getElementById('news-date-input');
        const newsDescInput = document.getElementById('news-desc-input');
        const newsImageInput = document.getElementById('news-image-input');
        const newsLinkInput = document.getElementById('news-link-input');
        const addNewsBtn = document.getElementById('add-news-btn');
        const newsContainer = document.getElementById('news-container');

        addNewsBtn.addEventListener('click', () => {
            const lang = newsLangSelect.value;
            const name = newsNameInput.value.trim();
            const date = newsDateInput.value.trim();
            const description = newsDescInput.value.trim();
            const image = newsImageInput.value.trim();
            const link = newsLinkInput.value.trim();
            if (!lang || !name || !date || !description) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –Ω–æ–≤–æ—Å—Ç–∏: –Ø–∑—ã–∫, –ó–∞–≥–æ–ª–æ–≤–æ–∫, –î–∞—Ç–∞, –û–ø–∏—Å–∞–Ω–∏–µ.');
                return;
            }
            let langGroup = newsContainer.querySelector(`.news-language-group[data-lang="${lang}"]`);
            if (!langGroup) {
                langGroup = document.createElement('div');
                langGroup.className = 'news-language-group mb-3';
                langGroup.dataset.lang = lang;
                langGroup.innerHTML = `<h5>–ù–æ–≤–æ—Å—Ç–∏ (${lang})</h5><ul class="list-group"></ul>`;
                newsContainer.appendChild(langGroup);
            }
            const newsList = langGroup.querySelector('.list-group');
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item';
            listItem.dataset.name = name;
            listItem.dataset.description = description;
            listItem.dataset.image = image;
            listItem.dataset.link = link;
            listItem.dataset.date = date;
            listItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <strong>${name}</strong> <small class="text-muted">(${date})</small>
                        <p class="mb-1 text-break">${description}</p>
                        <small class="text-muted text-break">–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${image || '–Ω–µ—Ç'}<br>–°—Å—ã–ª–∫–∞: ${link || '–Ω–µ—Ç'}</small>
                    </div>
                    <button type="button" class="btn btn-danger btn-sm remove-btn ms-2">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            `;
            newsList.appendChild(listItem);
            newsNameInput.value = '';
            newsDateInput.value = '';
            newsDescInput.value = '';
            newsImageInput.value = '';
            newsLinkInput.value = '';
        });

        const generateJsonBtn = document.getElementById('generate-json-btn');
        generateJsonBtn.addEventListener('click', () => {
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤, –æ–Ω –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
            const supportedLanguages = ['ru', 'en', 'es', 'pt', 'uk', 'el'];

            const config = {
                download: {
                    csv: [],
                    archives: []
                },
                application: [],
                lastLauncherVersion: document.getElementById('json-launcher-version').value || '1.0.0',
                launcherLink: document.getElementById('json-launcher-link').value || '',
                news: {}
            };

            // --- 1. –°–±–æ—Ä —Å—Å—ã–ª–æ–∫ –Ω–∞ CSV ---
            // –°–Ω–∞—á–∞–ª–∞ –±–µ—Ä–µ–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–∑ —Å–ø–∏—Å–∫–∞
            document.querySelectorAll('#csv-list li').forEach(item => {
                const span = item.querySelector('span');
                if (span && span.textContent.trim()) {
                    config.download.csv.push(span.textContent.trim());
                }
            });
            // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å –Ω–µ–¥–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞
            const csvInput = document.getElementById('csv-input');
            if (csvInput.value.trim()) {
                config.download.csv.push(csvInput.value.trim());
            }

            // --- 2. –°–±–æ—Ä —Å—Å—ã–ª–æ–∫ –Ω–∞ –∞—Ä—Ö–∏–≤—ã ---
            // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ CSV, —Å–Ω–∞—á–∞–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
            document.querySelectorAll('#archive-list li').forEach(item => {
                const span = item.querySelector('span');
                if (span && span.textContent.trim()) {
                    config.download.archives.push(span.textContent.trim());
                }
            });
            // –ù–û–í–û–ï: –ò –ø–æ—Ç–æ–º –∏–∑ –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞
            const archiveInput = document.getElementById('archive-input');
            if (archiveInput.value.trim()) {
                config.download.archives.push(archiveInput.value.trim());
            }

            // --- 3. –°–±–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ---
            // –ò–∑ —Å–ø–∏—Å–∫–∞
            document.querySelectorAll('#app-list li').forEach(item => {
                if (item.dataset.exe && item.dataset.translations) {
                    const translations = JSON.parse(item.dataset.translations || '{}');
                    const triggers = item.dataset.triggers ? JSON.parse(item.dataset.triggers) : [];
                    const appObj = {
                        name: [translations],
                        exe: item.dataset.exe,
                        args: item.dataset.args || ''
                    };
                    if (triggers && Array.isArray(triggers) && triggers.length) {
                        appObj.trigger = triggers;
                    }
                    config.application.push(appObj);
                }
            });
            // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const appExeInput = document.getElementById('app-exe-input');
            if (appExeInput.value.trim()) {
                const nameTranslations = {};
                let hasAnyName = false;
                supportedLanguages.forEach(lang => {
                    const input = document.getElementById(`app-name-${lang}`);
                    if (input && input.value.trim()) {
                        nameTranslations[lang] = input.value.trim();
                        hasAnyName = true;
                    }
                });
                // –î–æ–±–∞–≤–ª—è–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω exe –∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ
                if (hasAnyName) {
                    // –°–æ–±–∏—Ä–∞–µ–º (–µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ) —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–∑ UI –µ—Å–ª–∏ –µ—Å—Ç—å
                    const triggers = [];
                    triggerContainer.querySelectorAll('.trigger-row').forEach(row => {
                        const type = row.querySelector('.trigger-type').value;
                        if (!type) return;
                        if (type === 'copy') {
                            const src = row.querySelector('.trigger-src').value.trim();
                            const dst = row.querySelector('.trigger-dst').value.trim();
                            if (src && dst) triggers.push({ name: 'copy', src, dst });
                        } else if (type === 'WindowMinimize') {
                            triggers.push({ name: 'WindowMinimize' });
                        } else if (type === 'WindowClose') {
                            triggers.push({ name: 'WindowClose' });
                        } else if (type === 'StartGameReport') {
                            const url = row.querySelector('.trigger-url').value.trim();
                            if (url) triggers.push({ name: 'StartGameReport', url });
                        }
                    });
                    const appObj = {
                        name: [nameTranslations],
                        exe: appExeInput.value.trim(),
                        args: document.getElementById('app-args-input').value.trim() || ''
                    };
                    if (triggers.length) appObj.trigger = triggers;
                    config.application.push(appObj);
                }
            }

            // --- 4. –°–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π ---
            // –ò–∑ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø
            document.querySelectorAll('.news-language-group').forEach(group => {
                const lang = group.dataset.lang;
                if (lang) {
                    if (!config.news[lang]) {
                        config.news[lang] = [];
                    }
                    group.querySelectorAll('ul li').forEach(item => {
                        if (item.dataset.name && item.dataset.description && item.dataset.date) {
                            config.news[lang].push({
                                name: item.dataset.name,
                                description: item.dataset.description,
                                image: item.dataset.image || '',
                                link: item.dataset.link || '',
                                date: item.dataset.date
                            });
                        }
                    });
                }
            });
            // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–π –Ω–æ–≤–æ—Å—Ç–∏
            const newsNameInput = document.getElementById('news-name-input');
            const newsDescInput = document.getElementById('news-desc-input');
            const newsDateInput = document.getElementById('news-date-input');
            // –î–æ–±–∞–≤–ª—è–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (newsNameInput.value.trim() && newsDescInput.value.trim() && newsDateInput.value.trim()) {
                const lang = document.getElementById('news-lang-select').value;
                const newsItem = {
                    name: newsNameInput.value.trim(),
                    description: newsDescInput.value.trim(),
                    image: document.getElementById('news-image-input').value.trim() || '',
                    link: document.getElementById('news-link-input').value.trim() || '',
                    date: newsDateInput.value.trim()
                };
                if (!config.news[lang]) {
                    config.news[lang] = [];
                }
                config.news[lang].push(newsItem);
            }


            // --- 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ---
            // Autologin: –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–∞–ª–æ—á–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –ò –ø–æ–ª–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –Ω–µ –ø—É—Å—Ç–æ–µ
            const autologinEnable = document.getElementById('autologin-enable').checked;
            const autologinPattern = document.getElementById('autologin-pattern').value.trim();
            if (autologinEnable && autologinPattern) {
                config.autologin = {
                    pattern: autologinPattern
                };
            }
            const jsonString = JSON.stringify(config, null, 2);
            const blob = new Blob([jsonString], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'launcher.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

    });
</script>
{% endblock %}