{% extends 'struct.html' %}

{% block title %}–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –õ–∞—É–Ω—á–µ—Ä–∞ –∏ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏{% endblock %}

{% block content %}

<div class="container-fluid">
    <div class="row ">
        <div class="col-xl-12">
            <div class="card custom-card">
                <div class="card-header">
                    <div class="card-title">
                        1. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JSON –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (launcher.json)
                    </div>
                </div>
                <div class="card-body">

                    <div class="shadow p-3 mb-5 bg-body rounded">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="fw-bold text-primary mb-2">–û –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–∞—É–Ω—á–µ—Ä–∞</h6>
                                <p class="mb-2">–≠—Ç–∞ —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–∞—É–Ω—á–µ—Ä–∞. –õ–∞—É–Ω—á–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–∫–∞–∂–∏—Ç–µ —Ç—É—Ç.</p>
                                <p class="mb-2">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–µ–Ω—è—Ç—å.</p>
                                <p class="mb-0">–í —ç—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∏–∑ –∫–∞–∫–æ–≥–æ –º–µ—Å—Ç–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∞—Ä—Ö–∏–≤–æ–≤ –∏ —Å–∞–º–∏ –∞—Ä—Ö–∏–≤—ã, –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ—é –ª–µ–Ω—Ç—É –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –ª–∞—É–Ω—á–µ—Ä–∞.</p>
                            </div>

                            <div class="col-md-4">
                                <div id="json-drop-zone" class="json-drop-zone-compact border border-2 border-dashed border-info rounded p-3 text-center">
                                    <div class="drop-zone-content">
                                        <i class="ri-file-upload-line fs-1 text-info mb-2"></i>
                                        <h6 class="text-info mb-1">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</h6>
                                        <p class="small text-muted mb-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ launcher.json</p>
                                        <input type="file" id="json-file-input" accept=".json" style="display: none;">
                                        <button type="button" class="btn btn-outline-info btn-sm" onclick="document.getElementById('json-file-input').click()">
                                            <i class="ri-folder-open-line me-1"></i>–í—ã–±—Ä–∞—Ç—å
                                        </button>
                                    </div>
                                </div>
                                <div id="drop-zone-status" class="mt-2" style="display: none;">
                                    <div class="alert alert-success py-2 mb-0 small">
                                        <i class="ri-check-line me-1"></i>
                                        <span id="loaded-file-name"></span> –∑–∞–≥—Ä—É–∂–µ–Ω!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form id="json-generator-form">
                        <div class="row g-3">
                            <div class="col-md-6 border-end">
                                <h5>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞</h5>
                                <div class="mb-3">
                                    <label class="form-label">–°—Å—ã–ª–∫–∏ –Ω–∞ CSV</label>
                                    <div class="input-group">
                                        <input class="form-control" id="csv-input" placeholder="https://example.com/updates.csv" type="url">
                                        <button class="btn btn-outline-secondary" id="add-csv-btn" type="button">–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë</button>
                                    </div>
                                    <ul class="list-group mt-2" id="csv-list"></ul>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–°—Å—ã–ª–∫–∏ –Ω–∞ –∞—Ä—Ö–∏–≤—ã</label>
                                    <div class="input-group">
                                        <input class="form-control" id="archive-input" placeholder="https://example.com/archives/" type="url">
                                        <button class="btn btn-outline-secondary" id="add-archive-btn" type="button">–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë</button>
                                    </div>
                                    <ul class="list-group mt-2" id="archive-list"></ul>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h5>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞</h5>
                                <div class="p-3 bg-light rounded">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">–ù–∞–∑–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞:</label>
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <label class="form-label small">üá∑üá∫ –†—É—Å—Å–∫–∏–π (ru)</label>
                                                <input class="form-control form-control-sm" id="app-name-ru" placeholder="–ò–≥—Ä–∞—Ç—å" type="text" value="–ò–≥—Ä–∞—Ç—å">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá∫üá∏ English (en)</label>
                                                <input class="form-control form-control-sm" id="app-name-en" placeholder="Play" type="text" value="Play">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá™üá∏ Espa√±ol (es)</label>
                                                <input class="form-control form-control-sm" id="app-name-es" placeholder="Jugar" type="text" value="Jugar">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üáµüáπ Portugu√™s (pt)</label>
                                                <input class="form-control form-control-sm" id="app-name-pt" placeholder="Jogar" type="text" value="Jogar">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (uk)</label>
                                                <input class="form-control form-control-sm" id="app-name-uk" placeholder="–ì—Ä–∞—Ç–∏" type="text" value="–ì—Ä–∞—Ç–∏">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨ (el)</label>
                                                <input class="form-control form-control-sm" id="app-name-el" placeholder="Œ†Œ±ŒØŒæœÑŒµ" type="text" value="Œ†Œ±ŒØŒæœÑŒµ">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-2">
                                        <div class="col-12">
                                            <label class="form-label">–ü—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É</label>
                                            <input value="system-ru/l2.exe" class="form-control" id="app-exe-input" placeholder="–ü—É—Ç—å –∫ exe (–Ω–∞–ø—Ä. system-ru/l2.exe)" type="text">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                            <input class="form-control" id="app-args-input" placeholder="–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" type="text">
                                        </div>
                                        <div class="col-12 text-end">
                                            <button class="btn btn-outline-primary btn-sm" id="add-app-btn" type="button">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
                                        </div>
                                    </div>
                                </div>
                                <ul class="list-group mt-2" id="app-list"></ul>
                            </div>

                            <hr class="my-4">

                            <div class="col-md-6">
                                <label class="form-label" for="json-launcher-version">–í–µ—Ä—Å–∏—è –ª–∞—É–Ω—á–µ—Ä–∞</label>
                                <input class="form-control" id="json-launcher-version" type="text" value="1.0.0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="json-launcher-link">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–∞—É–Ω—á–µ—Ä–∞</label>
                                <input class="form-control" id="json-launcher-link" placeholder="https://example.com/launcher.exe" type="url">
                            </div>

                             <hr class="my-4">

                            <div class="col-12">
                                <h5>–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h5>
                                <div class="p-3 bg-light rounded">
                                    <div class="row g-3">
                                        <div class="col-md-2">
                                            <label class="form-label">–Ø–∑—ã–∫</label>
                                            <select class="form-select" id="news-lang-select">
                                                <option selected value="ru">–†—É—Å—Å–∫–∏–π (ru)</option>
                                                <option value="en">English (en)</option>
                                                <option value="es">Espa√±ol (es)</option>
                                                <option value="pt">Portugu√™s (pt)</option>
                                                <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (uk)</option>
                                                <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨ (el)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-5"><label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input class="form-control" id="news-name-input" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏"
                                                                                                                type="text"></div>
                                        <div class="col-md-5"><label class="form-label">–î–∞—Ç–∞</label><input class="form-control" id="news-date-input" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" type="text"></div>
                                        <div class="col-12"><label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea class="form-control" id="news-desc-input"
                                                                                                                placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–æ ~140 —Å–∏–º–≤–æ–ª–æ–≤)"
                                                                                                                rows="2"></textarea></div>
                                        <div class="col-md-6"><label class="form-label">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label><input class="form-control" id="news-image-input"
                                                                                                                      placeholder="https://example.com/image.png"
                                                                                                                      type="url"></div>
                                        <div class="col-md-6"><label class="form-label">URL —Å—Å—ã–ª–∫–∏</label><input class="form-control" id="news-link-input" placeholder="https://example.com/full-news"
                                                                                                                 type="url"></div>
                                        <div class="col-12 text-end"><button class="btn btn-outline-primary btn-sm" id="add-news-btn" type="button">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button></div>
                                    </div>
                                </div>
                                <div class="mt-3" id="news-container"></div>
                            </div>

                            <hr class="my-4">

                            <div class="col-12 text-center">
                                <button class="btn btn-success btn-lg" id="generate-json-btn" type="button">
                                    <i class="ri-file-download-line"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å launcher.json
                                </button>
                                <br>

                                <small class="d-block text-muted">
                                –ó–∞–≥—Ä—É–∑–∏—Ç–µ launcher.json —Å–µ–±–µ –Ω–∞ —Å–∞–π—Ç.<br>
                                –ò –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –ª–∞—É–Ω—á–µ—Ä–∞ —É–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª launcher.json
                               </small>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="row mt-4">
        <div class="col-xl-12">
            <div class="card custom-card">
                <div class="card-header">
                    <div class="card-title">
                        2. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –õ–∞—É–Ω—á–µ—Ä–∞ (–ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª)
                    </div>
                </div>
                <div class="card-body">
                    <form id="compile-form">
                        <div class="row g-3">
                           <div class="col-md-12">

                               <label class="form-label"  for="dataUrl">
                                    0. –°—Å—ã–ª–∫–∞ –Ω–∞ launcher.json<i class="text-danger">*</i>
                                </label>

                               <input class="form-control" id="dataUrl"
                                      placeholder="https://example.com/launcher.json"
                                      type="text" value="">
                           </div>

                           <div class="col-md-12">

                               <label class="form-label" data-bs-content="<img src='{{template_plugin}}/img/title.jpg' alt='–ü—Ä–∏–º–µ—Ä –ø–æ–¥—Å–∫–∞–∑–∫–∏' style='max-width: 300px; border-radius: 5px;'>"
                                      data-bs-html="true"
                                      data-bs-toggle="popover"
                                      data-bs-trigger="hover"
                                      for="pageTitle"
                                      tabindex="0">
                                    1. –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã<i class="text-danger">*</i> <i class="ri-information-line"></i>
                                </label>

                               <input class="form-control" id="pageTitle"
                                      placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–∫–Ω–∞ –ª–∞—É–Ω—á–µ—Ä–∞"
                                      type="text" value="–ú–æ–π –õ–∞—É–Ω—á–µ—Ä">

                           </div>
                           <div class="col-md-6"><label class="form-label" data-bs-content="<img src='{{template_plugin}}/img/min.jpg' alt='–ü—Ä–∏–º–µ—Ä –ø–æ–¥—Å–∫–∞–∑–∫–∏' style='max-width: 300px; border-radius: 5px;'>"
                                                        data-bs-html="true"
                                                        data-bs-toggle="popover"
                                                        data-bs-trigger="hover"
                                                        for="minWidth"
                                                        tabindex="0"
                           >2. –ú–∏–Ω. —à–∏—Ä–∏–Ω–∞ –æ–∫–Ω–∞ <i class="ri-information-line"></i></label>

                               <div class="input-group"><input class="form-control" id="minWidth" type="number"
                                                               value="1200">
                                   <span
                                         class="input-group-text">px</span></div></div>
                           <div class="col-md-6"><label class="form-label"
                                                        data-bs-content="<img src='{{template_plugin}}/img/max.jpg' alt='–ü—Ä–∏–º–µ—Ä –ø–æ–¥—Å–∫–∞–∑–∫–∏' style='max-width: 300px; border-radius: 5px;'>"
                                                        data-bs-html="true"
                                                        data-bs-toggle="popover"
                                                        data-bs-trigger="hover"
                                                        for="minWidth"
                                                        tabindex="0"
                           >–ú–∏–Ω. –≤—ã—Å–æ—Ç–∞ –æ–∫–Ω–∞ <i class="ri-information-line"></i></label><div class="input-group"><input class="form-control" id="minHeight" type="number"
                                                                                                                        value="900"><span class="input-group-text">px</span></div></div>
                           <div class="col-md-6"><label class="form-label" for="launcherVersion">3. –í–µ—Ä—Å–∏—è –ª–∞—É–Ω—á–µ—Ä–∞
                           <small class="d-block text-muted">–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ª–∞—É–Ω—á–µ—Ä–∞. –ï—Å–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ª–∞—É–Ω—á–µ—Ä–∞ –±—É–¥–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ launcher.json, —Ç–æ –ª–∞—É–Ω—á–µ—Ä –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</small>
                           </label>

                               <input class="form-control" id="launcherVersion"
                                      placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 1.0.0"
                                      type="text" value="1.0.0"></div>
                            <div class="col-md-6">
                                <label class="form-label" for="templateSelect">4. –®–∞–±–ª–æ–Ω –ª–∞—É–Ω—á–µ—Ä–∞
                                    <small class="d-block text-muted">
                                        –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –ª–∞—É–Ω—á–µ—Ä–∞. –í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π —à–∞–±–ª–æ–Ω.
                                    </small>
                                </label>
                                <select class="form-select" id="templateSelect">
                                    <option selected value="default">default</option>
                                    <option value="cyberpunk">cyberpunk</option>
                                    <option value="flat">flat</option>
                                    <option value="futuristic">futuristic</option>
                                    <option value="material">material</option>
                                    <option value="skeuomorphism">skeuomorphism</option>
                                    <option value="custom">–°–≤–æ–π —à–∞–±–ª–æ–Ω</option>
                                </select>
                            </div>
                          <div class="col-12 mt-3" id="custom-template-fields" style="display: none;">
                                <div class="p-3 border rounded">
                                    <h6 class="text-primary">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–≤–æ–µ–≥–æ —à–∞–±–ª–æ–Ω–∞</h6>
                                     <div class="mb-3">
                                         <label for="customHtmlFile" class="form-label">–§–∞–π–ª —à–∞–±–ª–æ–Ω–∞ (index.html) <i class="text-danger">*</i></label>
                                         <input class="form-control" type="file" id="customHtmlFile" accept=".html">
                                         <div class="form-text">–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª. –ù–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 100 –ö–ë.
                                         –î–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è index.html<br>
                                         </div>
                                     </div>
                                     <div class="mb-3">
                                         <label for="customCssFile" class="form-label">–§–∞–π–ª —Å—Ç–∏–ª–µ–π (launcher.css) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                         <input class="form-control" type="file" id="customCssFile" accept=".css">
                                          <div class="form-text">–§–∞–π–ª –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 100 –ö–ë.
                                            –î–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è launcher.css<br>
                                          </div>
                                     </div>
                                     <div class="mb-3">
                                         <label for="customLangFile" class="form-label">–§–∞–π–ª –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (lang.json) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                         <input class="form-control" type="file" id="customLangFile" accept=".json">
                                          <div class="form-text">–§–∞–π–ª –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 100 –ö–ë.
                                            –î–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è lang.json<br>
                                          </div>
                                     </div>
                                     <div class="mb-3">
                                         <label for="customLogoFile" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                         <input class="form-control" type="file" id="customLogoFile" accept=".png,.jpg,.jpeg,.gif,.bmp,.svg">
                                         <div class="form-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PNG, JPG, JPEG, GIF, BMP, SVG. –†–∞–∑–º–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 250 –ö–ë.
                                         <br>–õ–æ–≥–æ –¥–æ–ª–∂–Ω–æ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è logo.png/jpg/jpeg/gif/bmp/svg –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ä–∞–∑–º–µ—Ç–∫–µ index.html —Ç–æ–∂–µ
                                         </div>
                                     </div>
                                </div>
                           </div>
                           <div class="col-md-6"><label class="form-label" for="accountLink">5. –°—Å—ã–ª–∫–∞ –Ω–∞ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</label><div class="input-group"><span class="input-group-text"><i
                                 class="ri-account-circle-line"></i></span><input class="form-control" id="accountLink" placeholder="https://example.com/account" type="url"></div></div>
                           <div class="col-md-6"><label class="form-label" for="registerLink">6. –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</label><div class="input-group"><span class="input-group-text"><i
                                 class="ri-user-add-line"></i></span><input class="form-control" id="registerLink" placeholder="https://example.com/register" type="url"></div></div>
                           <div class="col-md-6"><label class="form-label" for="forumLink">7. –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ä—É–º</label><div class="input-group"><span class="input-group-text"><i
                                 class="ri-question-answer-line"></i></span><input class="form-control" id="forumLink" placeholder="https://example.com/forum" type="url"></div></div>
                           <div class="col-md-6"><label class="form-label" for="iconUpload">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∫–æ–Ω–∫–∏ (.png –∏–ª–∏ .ico)</label><input accept=".png,.ico" class="form-control" id="iconUpload"
                                                                                                                                          type="file"></div>
                           <div class="col-12"><label class="form-label">8. –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                           <small class="d-block text-muted">–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, —Ç–æ –ª–∞—É–Ω—á–µ—Ä –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ</small>

                           </label><div class="form-check form-switch"><input class="form-check-input" id="fullscreenSwitch"
                                                                              role="switch"
                                                                              type="checkbox"><label class="form-check-label"
                                                                                                     for="fullscreenSwitch">–í–∫–ª—é—á–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label></div></div>
                           <div class="col-12"><button class="btn btn-primary" id="compile-btn" type="submit">–ù–∞—á–∞—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é</button></div>
                        </div>
                    </form>

                    <div class="mt-4" id="status-container" style="display: none;">
                        <h5 class="card-title">–°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏</h5>
                        <div class="progress mb-2" style="height: 25px;">
                            <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="0" class="progress-bar progress-bar-striped progress-bar-animated" id="progress-bar" role="progressbar"
                                 style="width: 0%;">0%</div>
                        </div>
                        <p class="text-muted" id="status-message">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏...</p>
                        <div class="mt-3" id="result-container" style="display: none;">
                             <a class="btn btn-success disabled" href="#" id="download-btn"><i class="ri-download-2-line"></i> –°–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –ª–∞—É–Ω—á–µ—Ä</a>
                            <button class="btn btn-secondary ms-2" id="new-build-btn">–°–æ–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π</button>
                        </div>
                        <div class="alert alert-danger mt-3" id="error-container" style="display: none;">
                             <strong>–û—à–∏–±–∫–∞!</strong> <span id="error-message"></span>
                             <button class="btn btn-warning btn-sm float-end" id="retry-build-btn">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

 </div>

{% endblock %}

{% block js %}
<style>
.json-drop-zone-compact {
    min-height: 140px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.json-drop-zone-compact:hover {
    border-color: #0dcaf0 !important;
    background-color: rgba(13, 202, 240, 0.05);
}

.json-drop-zone-compact.drag-over {
    border-color: #198754 !important;
    background-color: rgba(25, 135, 84, 0.1);
    transform: scale(1.05);
}

.json-drop-zone-compact.drag-over .drop-zone-content {
    color: #198754;
}

.json-drop-zone-compact.error {
    border-color: #dc3545 !important;
    background-color: rgba(220, 53, 69, 0.1);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {

    // === –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ó–ê–ì–†–£–ó–ö–ò JSON –§–ê–ô–õ–ê ===
    const dropZone = document.getElementById('json-drop-zone');
    const fileInput = document.getElementById('json-file-input');
    const dropZoneStatus = document.getElementById('drop-zone-status');
    const loadedFileName = document.getElementById('loaded-file-name');

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ drag and drop
    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleJsonFile(files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleJsonFile(e.target.files[0]);
        }
    });

    function handleJsonFile(file) {
        if (!file.name.toLowerCase().endsWith('.json')) {
            showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª.');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const jsonData = JSON.parse(e.target.result);
                loadJsonData(jsonData);
                showSuccess(file.name);
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: ' + error.message);
            }
        };
        reader.readAsText(file);
    }

    function showSuccess(fileName) {
        dropZone.classList.remove('error');
        loadedFileName.textContent = fileName;
        dropZoneStatus.style.display = 'block';
        dropZoneStatus.innerHTML = `
            <div class="alert alert-success py-2 mb-0 small">
                <i class="ri-check-line me-1"></i>
                <span>${fileName}</span> –∑–∞–≥—Ä—É–∂–µ–Ω!
            </div>
        `;
    }

    function showError(message) {
        dropZone.classList.add('error');
        dropZoneStatus.style.display = 'block';
        dropZoneStatus.innerHTML = `
            <div class="alert alert-danger py-2 mb-0 small">
                <i class="ri-error-warning-line me-1"></i>
                ${message}
            </div>
        `;
    }

    function loadJsonData(data) {
        // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        clearAllData();

        // –ó–∞–≥—Ä—É–∂–∞–µ–º CSV URLs
        if (data.download && data.download.csv) {
            data.download.csv.forEach(url => {
                addToList('csv-list', url);
            });
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º Archive URLs
        if (data.download && data.download.archives) {
            data.download.archives.forEach(url => {
                addToList('archive-list', url);
            });
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∞—É–Ω—á–µ—Ä–µ
        if (data.lastLauncherVersion) {
            document.getElementById('json-launcher-version').value = data.lastLauncherVersion;
        }
        if (data.launcherLink) {
            document.getElementById('json-launcher-link').value = data.launcherLink;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        if (data.application && Array.isArray(data.application)) {
            data.application.forEach(app => {
                loadApplicationData(app);
            });
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏
        if (data.news) {
            Object.keys(data.news).forEach(lang => {
                if (Array.isArray(data.news[lang])) {
                    data.news[lang].forEach(newsItem => {
                        loadNewsData(lang, newsItem);
                    });
                }
            });
        }
    }

    function clearAllData() {
        document.getElementById('csv-list').innerHTML = '';
        document.getElementById('archive-list').innerHTML = '';
        document.getElementById('app-list').innerHTML = '';
        document.getElementById('news-container').innerHTML = '';

        document.getElementById('json-launcher-version').value = '1.0.0';
        document.getElementById('json-launcher-link').value = '';
    }

    function addToList(listId, value) {
        const list = document.getElementById(listId);
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
        listItem.innerHTML = `
            <span class="text-break">${value}</span>
            <button type="button" class="btn btn-danger btn-sm remove-btn">
                <i class="ri-delete-bin-line"></i>
            </button>
        `;
        list.appendChild(listItem);
    }

    function loadApplicationData(app) {
        const appList = document.getElementById('app-list');
        const supportedLanguages = ['ru', 'en', 'es', 'pt', 'uk', 'el'];

        let nameTranslations = {};

        if (typeof app.name === 'string') {
            nameTranslations.ru = app.name;
        } else if (Array.isArray(app.name) && app.name.length > 0) {
            nameTranslations = app.name[0] || {};
        }

        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';

        listItem.dataset.exe = app.exe || '';
        listItem.dataset.args = app.args || '';
        listItem.dataset.translations = JSON.stringify(nameTranslations);

        const namesDisplay = supportedLanguages
              .filter(lang => nameTranslations[lang])
              .map(lang => `${lang.toUpperCase()}: "${nameTranslations[lang]}"`)
              .join(', ');

        listItem.innerHTML = `
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${app.exe || ''}</strong>
                    <small class="d-block text-muted">–ê—Ä–≥—É–º–µ–Ω—Ç—ã: ${app.args || '–Ω–µ—Ç'}</small>
                    <small class="d-block text-info">–ù–∞–∑–≤–∞–Ω–∏—è: ${namesDisplay}</small>
                </div>
                <button type="button" class="btn btn-danger btn-sm remove-btn">
                    <i class="ri-delete-bin-line"></i>
                </button>
            </div>
        `;

        appList.appendChild(listItem);
    }

    function loadNewsData(lang, newsItem) {
        const newsContainer = document.getElementById('news-container');

        let langGroup = newsContainer.querySelector(`.news-language-group[data-lang="${lang}"]`);
        if (!langGroup) {
            langGroup = document.createElement('div');
            langGroup.className = 'news-language-group mb-3';
            langGroup.dataset.lang = lang;
            langGroup.innerHTML = `
                <h5>–ù–æ–≤–æ—Å—Ç–∏ (${lang})</h5>
                <ul class="list-group"></ul>
            `;
            newsContainer.appendChild(langGroup);
        }

        const newsList = langGroup.querySelector('.list-group');
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';

        listItem.dataset.name = newsItem.name || '';
        listItem.dataset.description = newsItem.description || '';
        listItem.dataset.image = newsItem.image || '';
        listItem.dataset.link = newsItem.link || '';
        listItem.dataset.date = newsItem.date || '';

        listItem.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <strong>${newsItem.name || ''}</strong> <small class="text-muted">(${newsItem.date || ''})</small>
                    <p class="mb-1 text-break">${newsItem.description || ''}</p>
                    <small class="text-muted text-break">–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${newsItem.image || '–Ω–µ—Ç'}<br>–°—Å—ã–ª–∫–∞: ${newsItem.link || '–Ω–µ—Ç'}</small>
                </div>
                <button type="button" class="btn btn-danger btn-sm remove-btn ms-2">
                    <i class="ri-delete-bin-line"></i>
                </button>
            </div>
        `;
        newsList.appendChild(listItem);
    }

    const GO_SERVER_ADDRESS = '{{go_server_address|raw}}';

    if (!GO_SERVER_ADDRESS) {
        console.error("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –ê–¥—Ä–µ—Å Go-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –∏–∑ PHP. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ PHP-—à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è 'go_server_address'.");
        alert("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ UI. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.");
        return;
    }

    const compileForm = document.getElementById('compile-form');
    const compileBtn = document.getElementById('compile-btn');
    const statusContainer = document.getElementById('status-container');
    const progressBar = document.getElementById('progress-bar');
    const statusMessage = document.getElementById('status-message');
    const resultContainer = document.getElementById('result-container');
    const downloadBtn = document.getElementById('download-btn');
    const newBuildBtn = document.getElementById('new-build-btn');
    const errorContainer = document.getElementById('error-container');
    const errorMessage = document.getElementById('error-message');
    const retryBuildBtn = document.getElementById('retry-build-btn');
    const templateSelect = document.getElementById('templateSelect');
    const customTemplateFields = document.getElementById('custom-template-fields');

    function toggleCustomTemplateFields() {
        customTemplateFields.style.display = templateSelect.value === 'custom' ? 'block' : 'none';
    }
    templateSelect.addEventListener('change', toggleCustomTemplateFields);
    toggleCustomTemplateFields();

    let pollingInterval; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞

    compileForm.addEventListener('submit', handleCompileRequest);
    newBuildBtn.addEventListener('click', resetUI);
    retryBuildBtn.addEventListener('click', resetUI);

    function resetUI() {
        compileForm.style.display = 'block';
        statusContainer.style.display = 'none';
        errorContainer.style.display = 'none';
        resultContainer.style.display = 'none';
        downloadBtn.classList.add('disabled');
        downloadBtn.href = "#";
        downloadBtn.style.display = 'inline-block';
        downloadBtn.innerHTML = '<i class="ri-download-2-line"></i> –°–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –ª–∞—É–Ω—á–µ—Ä';
        compileBtn.disabled = false;
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–ª–∏–Ω–≥, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–ø—É—â–µ–Ω
        if (pollingInterval) {
            clearInterval(pollingInterval);
        }
        updateProgress(0, "–û–∂–∏–¥–∞–Ω–∏–µ...");
    }

    function updateProgress(progress, message) {
        const p = Math.max(0, Math.min(100, progress));
        progressBar.style.width = p + '%';
        progressBar.innerText = p + '%';
        progressBar.setAttribute('aria-valuenow', p);
        progressBar.classList.remove('bg-success', 'bg-danger');
        if (p < 100) {
            progressBar.classList.add('progress-bar-animated', 'progress-bar-striped');
        }
        statusMessage.innerText = message;
    }

    function handleCompileRequest(event) {
        event.preventDefault();
        compileBtn.disabled = true;

        const buildData = {
            dataUrl: document.getElementById('dataUrl').value,
            title: document.getElementById('pageTitle').value,
            minWidth: parseInt(document.getElementById('minWidth').value) || 800,
            minHeight: parseInt(document.getElementById('minHeight').value) || 600,
            launcherVersion: document.getElementById('launcherVersion').value || "1.0.0",
            template: document.getElementById('templateSelect').value,
            accountLink: document.getElementById('accountLink').value,
            registrationLink: document.getElementById('registerLink').value,
            forumLink: document.getElementById('forumLink').value,
            fullscreen: document.getElementById('fullscreenSwitch').checked,
            iconBase64: "",
            customHtmlBase64: "",
            customCssBase64: "",
            customLangJsonBase64: "",
            customLogoBase64: ""
        };

        const iconFile = document.getElementById('iconUpload').files[0];
        const customHtmlFile = document.getElementById('customHtmlFile').files[0];
        const customCssFile = document.getElementById('customCssFile').files[0];
        const customLangFile = document.getElementById('customLangFile').files[0];
        const customLogoFile = document.getElementById('customLogoFile').files[0];

        const MAX_SIZE = 100 * 1024; // 100 –ö–ë
        const MAX_LOGO_SIZE = 250 * 1024; // 250 –ö–ë –¥–ª—è –ª–æ–≥–æ

        // --- 1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ---
        if (iconFile && iconFile.size > MAX_SIZE) {
            alert('–û—à–∏–±–∫–∞: –†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 –ö–ë.');
            compileBtn.disabled = false;
            return;
        }

        if (buildData.template === 'custom') {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ö–æ—Ç—è –±—ã HTML —Ñ–∞–π–ª –≤—ã–±—Ä–∞–Ω
            if (!customHtmlFile) {
                alert('–î–ª—è —Å–≤–æ–µ–≥–æ —à–∞–±–ª–æ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ñ–∞–π–ª index.html.');
                compileBtn.disabled = false;
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã
            if (customHtmlFile.size > MAX_SIZE) {
                alert('–û—à–∏–±–∫–∞: –†–∞–∑–º–µ—Ä HTML —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 –ö–ë.');
                compileBtn.disabled = false;
                return;
            }
            if (customCssFile && customCssFile.size > MAX_SIZE) {
                alert('–û—à–∏–±–∫–∞: –†–∞–∑–º–µ—Ä CSS —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 –ö–ë.');
                compileBtn.disabled = false;
                return;
            }
            if (customLangFile && customLangFile.size > MAX_SIZE) {
                alert('–û—à–∏–±–∫–∞: –†–∞–∑–º–µ—Ä lang.json —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 –ö–ë.');
                compileBtn.disabled = false;
                return;
            }
            if (customLogoFile && customLogoFile.size > MAX_LOGO_SIZE) {
                alert('–û—à–∏–±–∫–∞: –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ª–æ–≥–æ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 250 –ö–ë.');
                compileBtn.disabled = false;
                return;
            }
        }

        // --- 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ---
        const readFileAsBase64 = (file) => new Promise((resolve, reject) => {
            if (!file) return resolve("");
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = (error) => reject(error);
            reader.readAsDataURL(file);
        });

        Promise.all([
            readFileAsBase64(iconFile),
            readFileAsBase64(customHtmlFile),
            readFileAsBase64(customCssFile),
            readFileAsBase64(customLangFile),
            readFileAsBase64(customLogoFile),
        ]).then(([iconBase64, customHtml, customCss, customLang, customLogo]) => {
            buildData.iconBase64 = iconBase64;
            buildData.customHtmlBase64 = customHtml;
            buildData.customCssBase64 = customCss;
            buildData.customLangJsonBase64 = customLang;
            buildData.customLogoBase64 = customLogo;
            sendInitialRequest(buildData);
        }).catch(err => {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + err.message);
            compileBtn.disabled = false;
        });

        const checkImageDimensions = (file) => new Promise((resolve, reject) => {
            if (!file) return resolve();
            const image = new Image();
            image.onload = () => {
                if (image.width > 128 || image.height > 128) {
                    reject(new Error('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 128x128 –ø–∏–∫—Å–µ–ª–µ–π.'));
                } else {
                    resolve();
                }
            };
            image.onerror = () => reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∏–∫–æ–Ω–∫–∏.'));
            image.src = URL.createObjectURL(file);
        });

        const startProcessing = (data) => {
            compileForm.style.display = 'none';
            statusContainer.style.display = 'block';
            errorContainer.style.display = 'none';
            resultContainer.style.display = 'none';
            updateProgress(0, '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
            sendInitialRequest(data);
        };

        checkImageDimensions(iconFile)
              .then(() => {
                  // –†–∞–∑–º–µ—Ä—ã –∏–∫–æ–Ω–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ, —á–∏—Ç–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã
                  return Promise.all([
                      readFileAsBase64(iconFile),
                      readFileAsBase64(customHtmlFile),
                      readFileAsBase64(customCssFile),
                      readFileAsBase64(customLangFile),
                      readFileAsBase64(customLogoFile),
                  ]);
              })
              .then(([iconBase64, customHtml, customCss, customLang, customLogo]) => {
                  // –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ—á–∏—Ç–∞–Ω—ã, –æ–±–Ω–æ–≤–ª—è–µ–º buildData
                  buildData.iconBase64 = iconBase64;
                  buildData.customHtmlBase64 = customHtml;
                  buildData.customCssBase64 = customCss;
                  buildData.customLangJsonBase64 = customLang;
                  buildData.customLogoBase64 = customLogo;
                  startProcessing(buildData);
              })
              .catch(err => {
                  alert('–û—à–∏–±–∫–∞: ' + err.message);
                  compileBtn.disabled = false;
              });
    }


    function sendInitialRequest(data) {
        compileForm.style.display = 'none';
        statusContainer.style.display = 'block';
        errorContainer.style.display = 'none';
        resultContainer.style.display = 'none';
        updateProgress(0, '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');

        fetch('/admin/plugin/sphereLauncher2/compile', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        })
              .then(response => {
                  if (!response.ok) {
                      return response.text().then(text => { throw new Error(text || '–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É') });
                  }
                  return response.json();
              })
              .then(result => {
                  if (result.error) {
                      throw new Error(result.error);
                  }
                  if (result.task_id) {
                      updateProgress(2, '–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞. –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞...');
                      // –í–º–µ—Å—Ç–æ WebSocket, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–ª–∏–Ω–≥
                      startPolling(result.task_id);
                  } else {
                      throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª ID –∑–∞–¥–∞—á–∏.');
                  }
              })
              .catch(err => {
                  statusContainer.style.display = 'block';
                  errorContainer.style.display = 'block';
                  errorMessage.innerText = err.message;
                  resultContainer.style.display = 'block';
                  downloadBtn.style.display = 'none';
                  compileBtn.disabled = false;
              });
    }

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–ª–∏–Ω–≥–∞
    function startPolling(taskId) {
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
        if (pollingInterval) {
            clearInterval(pollingInterval);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å –æ–ø—Ä–æ—Å–æ–º –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        pollingInterval = setInterval(() => {
            pollTaskStatus(taskId);
        }, 2000); // 2000 –º—Å = 2 —Å–µ–∫—É–Ω–¥—ã
    }

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å—Ç–∞—Ç—É—Å–∞
    function pollTaskStatus(taskId) {
        const statusUrl = `/admin/plugin/sphereLauncher2/status/${taskId}`;

        fetch(statusUrl)
              .then(response => {
                  if (response.status === 404) {
                      throw new Error('–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.');
                  }
                  if (!response.ok) {
                      throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç–∞—Ç—É—Å–∞.');
                  }
                  return response.json();
              })
              .then(task => {
                  console.log("–ü–æ–ª—É—á–µ–Ω —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:", task);

                  if (task.error && task.status !== 'failed') {
                      throw new Error(task.error);
                  }


                  updateProgress(task.progress, task.message);

                  if (task.status === 'completed' || task.status === 'failed') {
                      clearInterval(pollingInterval);

                      if (task.status === 'completed') {
                          statusMessage.innerText = "–°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä...";
                          progressBar.classList.remove('progress-bar-animated', 'progress-bar-striped');
                          progressBar.classList.add('bg-success');
                          resultContainer.style.display = 'block';
                          downloadBtn.style.display = 'inline-block';
                          downloadBtn.classList.add('disabled');
                          downloadBtn.innerHTML = "–ò–¥—ë—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";

                          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ PHP-–±—ç–∫–µ–Ω–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
                          fetch('/admin/plugin/sphereLauncher2/download', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json',
                                  'Accept': 'application/json'
                              },
                              body: JSON.stringify({
                                  result_url: task.result_url
                              })
                          })
                                .then(response => {
                                    if (!response.ok) {
                                        return response.json().then(err => { throw new Error(err.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.'); });
                                    }
                                    return response.json();
                                })
                                .then(data => {
                                    if (data.success) {
                                        statusMessage.innerText = "–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é!";
                                        downloadBtn.href = data.file_path;
                                        downloadBtn.innerHTML = '<i class="ri-download-2-line"></i> –°–∫–∞—á–∞—Ç—å Launcher.exe';
                                        downloadBtn.classList.remove('disabled');
                                        downloadBtn.target = '_blank';
                                    } else {
                                        throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞.');
                                    }
                                })
                                .catch(err => {
                                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:', err);
                                    errorContainer.style.display = 'block';
                                    errorMessage.innerText = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π –ª–∞—É–Ω—á–µ—Ä –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä. ' + err.message;
                                    downloadBtn.style.display = 'none';
                                });

                      } else { // status === 'failed'
                          statusMessage.innerText = "–°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π.";
                          progressBar.classList.remove('progress-bar-animated', 'progress-bar-striped');
                          progressBar.classList.add('bg-danger');
                          errorContainer.style.display = 'block';
                          errorMessage.innerText = task.error;
                          resultContainer.style.display = 'block';
                          downloadBtn.style.display = 'none';
                      }
                  }
              })
              .catch(error => {
                  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–æ—Å–µ —Å—Ç–∞—Ç—É—Å–∞:', error);
                  clearInterval(pollingInterval);
                  errorContainer.style.display = 'block';
                  errorMessage.innerText = error.message;
                  resultContainer.style.display = 'block';
                  downloadBtn.style.display = 'none';
              });
    }


});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {

    // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏ (CSV, –ê—Ä—Ö–∏–≤—ã) ---
    function setupSimpleList(inputId, btnId, listId) {
        const input = document.getElementById(inputId);
        const addBtn = document.getElementById(btnId);
        const list = document.getElementById(listId);

        addBtn.addEventListener('click', () => {
            const value = input.value.trim();
            if (value) {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `
                        <span class="text-break">${value}</span>
                        <button type="button" class="btn btn-danger btn-sm remove-btn">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    `;
                list.appendChild(listItem);
                input.value = '';
            }
        });
    }

    setupSimpleList('csv-input', 'add-csv-btn', 'csv-list');
    setupSimpleList('archive-input', 'add-archive-btn', 'archive-list');

    document.addEventListener('click', (e) => {
        if (e.target.closest('.remove-btn')) {
            const listItem = e.target.closest('li');
            const listGroup = listItem.parentElement;
            listItem.remove();

            // –ï—Å–ª–∏ —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –æ–Ω–∞ —Å—Ç–∞–ª–∞ –ø—É—Å—Ç–æ–π, —É–¥–∞–ª—è–µ–º –≤—Å—é –≥—Ä—É–ø–ø—É
            if (listGroup.children.length === 0 && listGroup.parentElement.classList.contains('news-language-group')) {
                listGroup.parentElement.remove();
            }
        }
    });

    const appExeInput = document.getElementById('app-exe-input');
    const appArgsInput = document.getElementById('app-args-input');
    const addAppBtn = document.getElementById('add-app-btn');
    const appList = document.getElementById('app-list');
    const supportedLanguages = ['ru', 'en', 'es', 'pt', 'uk', 'el'];

    addAppBtn.addEventListener('click', () => {
        const exe = appExeInput.value.trim();
        const args = appArgsInput.value.trim();
        const nameTranslations = {};
        let hasAnyName = false;
        supportedLanguages.forEach(lang => {
            const input = document.getElementById(`app-name-${lang}`);
            if (input && input.value.trim()) {
                nameTranslations[lang] = input.value.trim();
                hasAnyName = true;
            }
        });
        if (!hasAnyName || !exe) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∏ –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É.');
            return;
        }
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';
        listItem.dataset.exe = exe;
        listItem.dataset.args = args;
        listItem.dataset.translations = JSON.stringify(nameTranslations);
        const namesDisplay = supportedLanguages
              .filter(lang => nameTranslations[lang])
              .map(lang => `${lang.toUpperCase()}: "${nameTranslations[lang]}"`)
              .join(', ');
        listItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${exe}</strong>
                        <small class="d-block text-muted">–ê—Ä–≥—É–º–µ–Ω—Ç—ã: ${args || '–Ω–µ—Ç'}</small>
                        <small class="d-block text-info">–ù–∞–∑–≤–∞–Ω–∏—è: ${namesDisplay}</small>
                    </div>
                    <button type="button" class="btn btn-danger btn-sm remove-btn">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            `;
        appList.appendChild(listItem);
        appExeInput.value = '';
        appArgsInput.value = '';
    });


    const newsLangSelect = document.getElementById('news-lang-select');
    const newsNameInput = document.getElementById('news-name-input');
    const newsDateInput = document.getElementById('news-date-input');
    const newsDescInput = document.getElementById('news-desc-input');
    const newsImageInput = document.getElementById('news-image-input');
    const newsLinkInput = document.getElementById('news-link-input');
    const addNewsBtn = document.getElementById('add-news-btn');
    const newsContainer = document.getElementById('news-container');

    addNewsBtn.addEventListener('click', () => {
        const lang = newsLangSelect.value;
        const name = newsNameInput.value.trim();
        const date = newsDateInput.value.trim();
        const description = newsDescInput.value.trim();
        const image = newsImageInput.value.trim();
        const link = newsLinkInput.value.trim();
        if (!lang || !name || !date || !description) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –Ω–æ–≤–æ—Å—Ç–∏: –Ø–∑—ã–∫, –ó–∞–≥–æ–ª–æ–≤–æ–∫, –î–∞—Ç–∞, –û–ø–∏—Å–∞–Ω–∏–µ.');
            return;
        }
        let langGroup = newsContainer.querySelector(`.news-language-group[data-lang="${lang}"]`);
        if (!langGroup) {
            langGroup = document.createElement('div');
            langGroup.className = 'news-language-group mb-3';
            langGroup.dataset.lang = lang;
            langGroup.innerHTML = `<h5>–ù–æ–≤–æ—Å—Ç–∏ (${lang})</h5><ul class="list-group"></ul>`;
            newsContainer.appendChild(langGroup);
        }
        const newsList = langGroup.querySelector('.list-group');
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';
        listItem.dataset.name = name;
        listItem.dataset.description = description;
        listItem.dataset.image = image;
        listItem.dataset.link = link;
        listItem.dataset.date = date;
        listItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <strong>${name}</strong> <small class="text-muted">(${date})</small>
                        <p class="mb-1 text-break">${description}</p>
                        <small class="text-muted text-break">–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${image || '–Ω–µ—Ç'}<br>–°—Å—ã–ª–∫–∞: ${link || '–Ω–µ—Ç'}</small>
                    </div>
                    <button type="button" class="btn btn-danger btn-sm remove-btn ms-2">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            `;
        newsList.appendChild(listItem);
        newsNameInput.value = '';
        newsDateInput.value = '';
        newsDescInput.value = '';
        newsImageInput.value = '';
        newsLinkInput.value = '';
    });

    const generateJsonBtn = document.getElementById('generate-json-btn');
    generateJsonBtn.addEventListener('click', () => {
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤, –æ–Ω –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
        const supportedLanguages = ['ru', 'en', 'es', 'pt', 'uk', 'el'];

        const config = {
            download: {
                csv: [],
                archives: []
            },
            application: [],
            lastLauncherVersion: document.getElementById('json-launcher-version').value || '1.0.0',
            launcherLink: document.getElementById('json-launcher-link').value || '',
            news: {}
        };

        // --- 1. –°–±–æ—Ä —Å—Å—ã–ª–æ–∫ –Ω–∞ CSV ---
        // –°–Ω–∞—á–∞–ª–∞ –±–µ—Ä–µ–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–∑ —Å–ø–∏—Å–∫–∞
        document.querySelectorAll('#csv-list li').forEach(item => {
            const span = item.querySelector('span');
            if (span && span.textContent.trim()) {
                config.download.csv.push(span.textContent.trim());
            }
        });
        // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å –Ω–µ–¥–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞
        const csvInput = document.getElementById('csv-input');
        if (csvInput.value.trim()) {
            config.download.csv.push(csvInput.value.trim());
        }

        // --- 2. –°–±–æ—Ä —Å—Å—ã–ª–æ–∫ –Ω–∞ –∞—Ä—Ö–∏–≤—ã ---
        // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ CSV, —Å–Ω–∞—á–∞–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        document.querySelectorAll('#archive-list li').forEach(item => {
            const span = item.querySelector('span');
            if (span && span.textContent.trim()) {
                config.download.archives.push(span.textContent.trim());
            }
        });
        // –ù–û–í–û–ï: –ò –ø–æ—Ç–æ–º –∏–∑ –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞
        const archiveInput = document.getElementById('archive-input');
        if (archiveInput.value.trim()) {
            config.download.archives.push(archiveInput.value.trim());
        }

        // --- 3. –°–±–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ---
        // –ò–∑ —Å–ø–∏—Å–∫–∞
        document.querySelectorAll('#app-list li').forEach(item => {
            if (item.dataset.exe && item.dataset.translations) {
                const translations = JSON.parse(item.dataset.translations || '{}');
                config.application.push({
                    name: [translations],
                    exe: item.dataset.exe,
                    args: item.dataset.args || ''
                });
            }
        });
        // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const appExeInput = document.getElementById('app-exe-input');
        if (appExeInput.value.trim()) {
            const nameTranslations = {};
            let hasAnyName = false;
            supportedLanguages.forEach(lang => {
                const input = document.getElementById(`app-name-${lang}`);
                if (input && input.value.trim()) {
                    nameTranslations[lang] = input.value.trim();
                    hasAnyName = true;
                }
            });
            // –î–æ–±–∞–≤–ª—è–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω exe –∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ
            if (hasAnyName) {
                config.application.push({
                    name: [nameTranslations],
                    exe: appExeInput.value.trim(),
                    args: document.getElementById('app-args-input').value.trim() || ''
                });
            }
        }

        // --- 4. –°–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π ---
        // –ò–∑ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø
        document.querySelectorAll('.news-language-group').forEach(group => {
            const lang = group.dataset.lang;
            if (lang) {
                if (!config.news[lang]) {
                    config.news[lang] = [];
                }
                group.querySelectorAll('ul li').forEach(item => {
                    if (item.dataset.name && item.dataset.description && item.dataset.date) {
                        config.news[lang].push({
                            name: item.dataset.name,
                            description: item.dataset.description,
                            image: item.dataset.image || '',
                            link: item.dataset.link || '',
                            date: item.dataset.date
                        });
                    }
                });
            }
        });
        // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–π –Ω–æ–≤–æ—Å—Ç–∏
        const newsNameInput = document.getElementById('news-name-input');
        const newsDescInput = document.getElementById('news-desc-input');
        const newsDateInput = document.getElementById('news-date-input');
        // –î–æ–±–∞–≤–ª—è–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        if (newsNameInput.value.trim() && newsDescInput.value.trim() && newsDateInput.value.trim()) {
            const lang = document.getElementById('news-lang-select').value;
            const newsItem = {
                name: newsNameInput.value.trim(),
                description: newsDescInput.value.trim(),
                image: document.getElementById('news-image-input').value.trim() || '',
                link: document.getElementById('news-link-input').value.trim() || '',
                date: newsDateInput.value.trim()
            };
            if (!config.news[lang]) {
                config.news[lang] = [];
            }
            config.news[lang].push(newsItem);
        }


        // --- 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ---
        const jsonString = JSON.stringify(config, null, 2);
        const blob = new Blob([jsonString], {
            type: 'application/json'
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'launcher.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });

});
</script>
{% endblock %}