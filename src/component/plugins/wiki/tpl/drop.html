{% extends 'struct.html' %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-3">
    <div class="col-12">
      <div class="wiki-subnav">
  <div class="subnav-header d-flex align-items-center gap-3 flex-wrap mb-2">
    <button type="button" class="btn btn-sm btn-outline-secondary"
      onclick="try{if(history.length > 1){history.back();}else{location.href='/wiki';}}catch(e){location.href='/wiki';}">{{ phrase('Back') }}</button>
          <a href="/wiki" class="back-link d-inline-flex align-items-center gap-2">
            <span class="chevron" aria-hidden="true">←</span>
            <span class="label">{{ phrase('Library') }}</span>
          </a>
          <h1 class="h5 m-0 fw-semibold page-title">{{ phrase('Drop items') }}</h1>
        </div>
  <form method="get" class="d-flex gap-2" onsubmit="event.preventDefault();var v=this.q.value.trim(); if(v.length){ window.location.href='{{ search_base }}' + '/' + encodeURIComponent(v); } else { window.location.href='{{ list_base }}'; }">
          <input type="text" class="form-control form-control-sm" name="q" value="{{ list_q|default('') }}" placeholder="{{ phrase('Search by name or ID') }}">
          <button class="btn btn-sm btn-primary" type="submit">{{ phrase('Search') }}</button>
          {% if list_q %}<a class="btn btn-sm btn-outline-secondary" href="{{ list_base }}">{{ phrase('Reset') }}</a>{% endif %}
        </form>
      </div>
    </div>
  </div>

  <div class="card custom-card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:44px"></th>
              <th>{{ phrase('Name') }}</th>
              <th style="width:120px" class="text-end">ID</th>
              <th style="width:160px" class="text-end">{{ phrase('Sources') }}</th>
            </tr>
          </thead>
          <tbody>
            {% if list_items is empty %}
            <tr>
              <td colspan="4" class="text-center text-muted py-3">{{ phrase('Nothing found') }}</td>
            </tr>
            {% else %}
            {% for it in list_items %}
            <tr>
              <td>
                <img src="{{ it.icon_path }}" width="32" height="32" class="rounded" loading="lazy" onerror="this.src='/uploads/images/icon/NOIMAGE.webp'" />
              </td>
              <td>
                <a class="text-decoration-none fw-semibold d-inline-flex align-items-center gap-2" href="{{ it.link_sources }}">{{ grade_img(it.crystal_type|default(null))|raw }} {{ it.name }}</a>
              </td>
              <td class="text-end">{{ it.id }}</td>
              <td class="text-end">
                <a href="{{ it.link_sources }}" class="btn btn-sm btn-outline-secondary">{{ phrase('NPC list') }}</a>
              </td>
            </tr>
            {% endfor %}
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <nav aria-label="{{ phrase('Pagination') }}" class="mt-3">
  {% set base = (list_q ? (search_base ~ '/' ~ list_q ~ '/page/') : (list_base ~ '/page/')) %}
  {% set query = '' %}
    <ul class="pagination pagination-sm flex-wrap mb-0">
      <li class="page-item {% if list_page<=1 %}disabled{% endif %}"><a class="page-link" href="{{ base ~ (list_page-1) ~ query }}">‹</a></li>
      {% set start = list_page - 3 %}
      {% set end = list_page + 3 %}
      {% if start < 1 %}{% set end=end + (1-start) %}{% set start=1 %}{% endif %}
      {% if end > list_pages %}{% set start = start - (end-list_pages) %}{% set end = list_pages %}{% endif %}
      {% if start < 1 %}{% set start=1 %}{% endif %}
      {% if start > 1 %}
        <li class="page-item"><a class="page-link" href="{{ base ~ '1' ~ query }}">1</a></li>
        {% if start > 2 %}<li class="page-item disabled"><span class="page-link">…</span></li>{% endif %}
      {% endif %}
      {% for p in start..end %}
        <li class="page-item {% if p==list_page %}active{% endif %}"><a class="page-link" href="{{ base ~ p ~ query }}">{{ p }}</a></li>
      {% endfor %}
      {% if end < list_pages %}
        {% if end < list_pages - 1 %}<li class="page-item disabled"><span class="page-link">…</span></li>{% endif %}
        <li class="page-item"><a class="page-link" href="{{ base ~ list_pages ~ query }}">{{ list_pages }}</a></li>
      {% endif %}
      <li class="page-item {% if list_page>=list_pages %}disabled{% endif %}"><a class="page-link" href="{{ base ~ (list_page+1) ~ query }}">›</a></li>
    </ul>
  </nav>
</div>

{% block css %}
<link rel="stylesheet" href="/src/component/plugins/wiki/tpl/css/_wiki_subnav.css">
{% endblock %}
{% endblock %}
