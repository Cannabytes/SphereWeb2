{% extends 'struct.html' %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12 mb-3">
            <div class="wiki-subnav mb-3">
                <div class="subnav-header d-flex align-items-center gap-3 flex-wrap mb-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="try{if(history.length > 1){history.back();}else{location.href='/wiki';}}catch(e){location.href='/wiki';}">{{ phrase('Back') }}</button>
                    <a href="/wiki" class="back-link d-inline-flex align-items-center gap-2">
                        <span class="chevron" aria-hidden="true">←</span>
                        <span class="label">{{ phrase('Library') }}</span>
                    </a>
                    <h1 class="h4 m-0 fw-semibold page-title">{{ phrase('Other items (EtcItems)') }}</h1>
                </div>
                <p class="small text-muted mb-0">{{ phrase('Type') }}: {{ etc_current_type }} • {{ phrase('Total') }}: {{ etc_total }} • {{ phrase('Page') }} {{ etc_page }} / {{ etc_pages }}</p>
            </div>
        </div>
    </div>

    {% if etc_types is empty %}
    <div class="alert alert-info">{{ phrase('No items') }}</div>
    {% else %}
    <form id="etc-filter-form" class="row g-2 mb-3" onsubmit="return false;">
        <div class="col-auto">
            <label for="etcType" class="form-label mb-1 small text-muted">{{ phrase('Type') }}</label>
            <select id="etcType" class="form-select form-select-sm"
                onchange="location.href='/wiki/items/etcitems/type/' + encodeURIComponent(this.value) + '/page/1';">
                {% for t,c in etc_types %}
                <option value="{{ t }}" {% if t==etc_current_type %}selected{% endif %}>{{ t }} ({{ c }})</option>
                {% endfor %}
            </select>
        </div>
    </form>

    <div class="card custom-card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-sm table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width:42px"></th>
                            <th>{{ phrase('Name') }}</th>
                            <th class="text-center">{{ phrase('Stack') }}</th>
                            <th class="text-end">{{ phrase('Price') }}</th>
                            <th class="text-end">{{ phrase('Weight') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if etc_items is empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">{{ phrase('No items to show') }}</td>
                        </tr>
                        {% else %}
                        {% for i in etc_items %}
                        {% include 'wiki/tpl/_etcitem_row.html' with {'i': i} %}
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% if etc_quest_included and etc_items is not empty and etc_current_type != 'quest' %}
    <div class="alert alert-warning mt-2 py-2 mb-2 small">
    {{ phrase('Shown with quest items')|default('Shown with quest items because there are no non-quest items of this type.') }}
    </div>
    {% endif %}

    <nav aria-label="{{ phrase('Pagination') }}" class="mt-3">
        <ul class="pagination pagination-sm flex-wrap mb-0">
            {% set base = '/wiki/items/etcitems/type/' ~ etc_current_type ~ '/page/' %}
            <li class="page-item {% if etc_page<=1 %}disabled{% endif %}"><a class="page-link"
                    href="{{ base ~ (etc_page-1) }}" tabindex="-1">‹</a></li>
            {% set start = etc_page - 3 %}
            {% set end = etc_page + 3 %}
            {% if start < 1 %}{% set end=end + (1-start) %}{% set start=1 %}{% endif %} {% if end> etc_pages %}{% set
                start = start - (end-etc_pages) %}{% set end = etc_pages %}{% endif %}
                {% if start < 1 %}{% set start=1 %}{% endif %} {% if start> 1 %}
                    <li class="page-item"><a class="page-link" href="{{ base ~ '1' }}">1</a></li>
                    {% if start > 2 %}<li class="page-item disabled"><span class="page-link">…</span></li>{% endif %}
                    {% endif %}
                    {% for p in start..end %}
                    <li class="page-item {% if p==etc_page %}active{% endif %}"><a class="page-link"
                            href="{{ base ~ p }}">{{ p }}</a></li>
                    {% endfor %}
                    {% if end < etc_pages %} {% if end < etc_pages - 1 %}<li class="page-item disabled"><span
                            class="page-link">…</span></li>{% endif %}
                        <li class="page-item"><a class="page-link" href="{{ base ~ etc_pages }}">{{ etc_pages }}</a>
                        </li>
                        {% endif %}
                        <li class="page-item {% if etc_page>=etc_pages %}disabled{% endif %}"><a class="page-link"
                                href="{{ base ~ (etc_page+1) }}">›</a></li>
        </ul>
    </nav>
    {% endif %}

    {% if db_timing is defined %}
    <div class="small text-muted mt-2">DB: {{ db_timing.db_open_ms }} ms • Read: {{ db_timing.read_ms }} ms • Total: {{
        db_timing.total_ms }} ms</div>
    {% endif %}
</div>

<style>
    .pagination .page-link {
        cursor: pointer;
    }

    .table td,
    .table th {
        vertical-align: middle;
    }
</style>
{% endblock %}

{% block css %}
<link rel="stylesheet" href="/src/component/plugins/wiki/tpl/css/_wiki_subnav.css">
{% endblock %}