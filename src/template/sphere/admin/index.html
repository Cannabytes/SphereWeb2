{% extends 'struct.html' %}

{% block title %}{{ phrase(221) }}{% endblock %}

{% block content %}

<div class="container-fluid">

    <div class="row">
        <div class="col-xxl-3">

            {% if config().enabled().isEnableEmulation() %}

            <div class="alert alert-dark" role="alert">
                {{ phrase('func_emulation_server_desc_enable')|raw }}
            </div>

            {% endif %}

            {% if sphereAPIError %}
            <div class="card custom-card">
                <div class="p-4 border-bottom border-block-end-dashed">
                    {{ phrase(SphereApiCodeError())|raw }}
                </div>
            </div>
            {% else %}


            {% if self_last_commit != sphere_last_commit %}
            <div class="card custom-card">
                <div class="p-4 border-bottom border-block-end-dashed">
                    <p class="fw-semibold mb-2 text-danger">{{ phrase('sphereweb_update_detected') }}</p>

                    {% if config().other().autoUpdate() == false %}
                    <div class="alert alert-danger" role="alert">
                        {{ phrase('auto_update_is_disabled') }}
                    </div>
                    {% endif %}

                    <a href="/admin/sphere/update" class="btn btn-light btn-wave btn-sm ms-auto">{{
                        phrase('proceed_to_update')
                        }}</a>
                </div>
            </div>
            {% endif %}

            {% if servers|length == 0 %}
            <div class="card custom-card">
                <div class="p-4 border-bottom border-block-end-dashed">
                    <p class="fw-semibold mb-2 text-danger">{{ phrase('you_have_no_servers') }}</p>
                    <a href="/admin/server/add/new" class="btn btn-light btn-wave btn-sm ms-auto">{{
                        phrase('add_server') }}</a>
                </div>
            </div>
            {% endif %}


{% set daysLeft = SSL.DaysLeft|default(0) %}
{% if SSL and (not SSL.IsValid or daysLeft <= 30) %}

<div class="card custom-card mt-2">
    <div class="card-header bg-light p-2 d-flex justify-content-between align-items-center">
        <h6 class="card-title mb-0">
            <i class="bi bi-shield-lock{% if SSL.IsValid %}-fill{% else %}-exclamation{% endif %} me-1"></i>
            {{ phrase('ssl_certificate') }}
        </h6>
        <span class="badge {% if SSL.IsValid %}bg-success{% else %}bg-danger{% endif %}">
            {% if SSL.IsValid %}{{ phrase('valid') }}{% else %}{{ phrase('invalid') }}{% endif %}
        </span>
    </div>
    <div class="card-body p-2">
        {% if SSL.IsValid %}

            {% if daysLeft < 30 %}
                <div class="alert alert-warning py-1 px-2 mb-2 small">
                    <i class="bi bi-exclamation-triangle-fill me-1"></i>
                    {{ phrase('expires in days', daysLeft|round(0, 'floor')) }}
                </div>
            {% else %}
                <div class="alert alert-success py-1 px-2 mb-2 small">
                    <i class="bi bi-shield-check me-1"></i>
                    {{ phrase('valid for more days', daysLeft|round(0, 'floor')) }}
                </div>
            {% endif %}
        {% else %}
            <div class="alert alert-danger py-1 px-2 mb-2 small">
                <i class="bi bi-x-circle-fill me-1"></i>
                {{ phrase('invalid') }}: {{ SSL.ErrorReason ?: phrase('Unknown error') }}
            </div>
        {% endif %}

        <div class="row g-1 small">
            <div class="col-sm-12">
                <div class="d-flex flex-wrap">
                    <div class="text-muted me-1">{{ phrase('domain') }}:</div>
                    <div class="text-truncate flex-grow-1 mb-1">
                        {{ SSL.Subject }}
                    </div>
                </div>

                <div class="d-flex flex-wrap">
                    <div class="text-muted me-1">{{ phrase('deadlines') }}:</div>
                    <div class="text-truncate flex-grow-1 mb-1">
                        {{ SSL.NotBefore|date("d.m.Y") }} -
                        <span class="{% if not SSL.IsValid or SSL.DaysLeft < 30 %}text-danger fw-bold{% endif %}">
                            {{ SSL.NotAfter|date("d.m.Y") }}
                        </span>
                    </div>
                </div>

                <div class="d-flex flex-wrap">
                    <div class="text-muted me-1">{{ phrase('domain') }}:</div>
                    <div class="text-truncate flex-grow-1">
                        {% for domain in SSL.DNSNames|slice(0, 2) %}
                            <span class="badge bg-light text-dark me-1">{{ domain }}</span>
                        {% endfor %}
                        {% if SSL.DNSNames|length > 2 %}
                            <span class="badge bg-light text-dark">+{{ SSL.DNSNames|length - 2 }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer p-2 text-center">
        {% if not SSL.IsValid or SSL.DaysLeft < 30 %}
            <a href="https://certbot.eff.org/" target="_blank" class="btn btn-sm btn-{% if SSL.IsValid %}warning{% else %}danger{% endif %} w-100">
                <i class="bi bi-{% if SSL.IsValid %}arrow-repeat{% else %}shield-plus{% endif %} me-1"></i>
                {% if SSL.IsValid %}{{phrase('update_ssl')}}{% else %}{{phrase('get a certificate')}}{% endif %}
            </a>
        {% endif %}
        <p class="small mb-0">{{ phrase('ssl_certificate_desc') }}</p>
    </div>
    </div>
{% elseif not SSL %}
<div class="card custom-card mt-2">
    <div class="card-header bg-light p-2">
        <h6 class="card-title mb-0">
            <i class="bi bi-shield-exclamation me-1"></i>
            {{ phrase('ssl_certificate') }}
        </h6>
    </div>
    <div class="card-body p-2">
        <div class="alert alert-danger py-1 px-2 mb-0 small">
            <i class="bi bi-exclamation-triangle-fill me-1"></i>
            {{ phrase('no_ssl_certificates')|raw }}
        </div>
        <p class="small mb-0 mt-2">{{phrase('no_ssl_certificates_desc')|raw}}</p>
    </div>
    <div class="card-footer p-2 text-center">
        <a href="https://certbot.eff.org/" target="_blank" class="btn btn-sm btn-outline-primary w-100">
            <i class="bi bi-shield-plus me-1"></i>
            {{ phrase('need_set_install') }}
        </a>
    </div>
</div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>

            <div class="card custom-card">

                <div class="card-body">
                    <div class="d-flex align-items-top justify-content-between mb-0 ">

                        <div class="flex-fill d-flex align-items-top">
                            <div class="me-2">
                                <span class="avatar avatar-md text-primary border bg-light"><i
                                      class="ti ti-currency-dollar fs-18"></i></span>
                            </div>
                            <div class="flex-fill">
                                <p class="fw-semibold fs-14 mb-0"><a href="/admin/balance">{{
                                    phrase('sphereweb_maintenance') }}</a></p>
                                <p class="mb-0 text-muted fs-12 op-7">{{ phrase('on_your_balance') }} <span
                                      class="text-primary h4">${{balance|number_format(2)}}</span></p>
                            </div>
                        </div>

                        <div>
                            <a href="javascript:void(0);" data-bs-toggle="dropdown"
                               class="btn btn-icon btn-sm btn-light" aria-expanded="false"><i
                                  class="ti ti-dots"></i></a>
                            <ul class="dropdown-menu" style="">
                                <li><a href="/admin/balance/faq" class="dropdown-item">{{
                                    phrase('frequently_asked_questions') }}</a></li>
                                <li><a href="/admin/balance" class="dropdown-item">{{ phrase('refill') }}</a></li>
                            </ul>
                        </div>

                    </div>

                    <div class="mb-2 ">
                        <div class="text-muted">
                            <div class="table-responsive">
                                <table class="table text-nowrap">
                                    <thead>
                                    <tr>
                                        <th scope="col">{{ phrase('service') }}</th>
                                        <th scope="col">{{ phrase('end date') }}</th>
                                    </tr>
                                    </thead>
                                    <tbody class="table-group-divider">

                                    <tr>
                                        <th scope="row">Sphere Web</th>
                                        <td><span class="text-{% if licenseActive %}success{% else %}danger{% endif %}">{% if licenseActive == false %}<i
                                              class="bi bi-x-circle"></i> {% endif %}{{ license|date('d.m.Y H:i', getUser().getTimezone()) }}</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <th scope="row">{{ phrase('extensions') }}</th>
                                        <td>
                                            {% if pluginActive %}
                                            <span class="text-success">{{pluginActiveDate|date('d.m.Y H:i', getUser().getTimezone())}}</span>
                                            {% else %}
                                            <span class="text-danger">{{ phrase('not_active') }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    <tr>
                                        <th scope="row"><a href="/admin/sphere/forum">{{ phrase(62) }}</a></th>
                                        <td>
                                            {% if pluginActive %}
                                            <span class="text-success">{{pluginActiveDate|date('d.m.Y H:i', getUser().getTimezone())}}</span>
                                            {% else %}
                                            <span class="text-danger">{{ phrase('limited') }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="d-grid gap-2 ">
                        <a class="btn btn-teal me-md-2 btn-wave waves-effect waves-light" href="/admin/balance">{{  phrase('balance management') }}</a>
                    </div>

                    {# Если лицензия была отключена #}
                    {% if licenseActive == false   %}
                    <div class="mt-0 task-navigation border-bottom border-block-end-dashed">
                        <ul class="list-unstyled task-main-nav mb-0">
                            <li class="px-0 pt-0">
                                <span class="fs-11 text-muted op-7 fw-semibold">{{ phrase('Restrictions introduced due to license expiration') }}</span>
                            </li>

                        {% if licenseActive == false %}
                            <li class="" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                data-bs-original-title="{{ phrase('sphere off license desc') }}">
                                <a href="javascript:void(0);">
                                    <div class="d-flex align-items-center">
                                                        <span class="me-2 lh-1">
                                                            <i class="ri-task-line align-middle fs-14"></i>
                                                        </span>
                                        <span class="flex-fill text-nowrap">
                                                            {{ phrase('Registrations per day') }}
                                                        </span>
                                        <span class="badge bg-secondary-transparent rounded-pill">{{registrationLimit}}/20</span>
                                    </div>
                                </a>
                            </li>
                        {% endif %}

                        {% if pluginActive == false %}
                            <li class="" data-bs-original-title="{{ phrase('forum_description_limit') }}" data-bs-placement="bottom"
                                data-bs-toggle="tooltip">
                                <a href="javascript:void(0);">
                                    <div class="d-flex align-items-center">
                                                        <span class="me-2 lh-1">
                                                            <i class="ri-task-line align-middle fs-14"></i>
                                                        </span>
                                        <span class="flex-fill text-nowrap">
                                                            {{ phrase('forum posts per day') }}
                                                        </span>
                                        <span class="badge bg-secondary-transparent rounded-pill">{{forumInfo.count}}/20</span>
                                    </div>
                                </a>
                            </li>
                        {% endif %}
                        </ul>
                    </div>
                    {% endif %}

                    <div class="text-center">
                        <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                              data-bs-original-title="{{ phrase('Time on the SphereApi server') }}" class="tag mt-1" id="serverTime">{{ serverTime|date('H:i:s / d.m.Y') }}</span>
                        <script>
                            $(document).ready(function() {
                                function updateServerTime() {
                                    let timeText = $("#serverTime").text();
                                    let parts = timeText.split(" / ");
                                    let timeParts = parts[0].split(":");
                                    let hours = parseInt(timeParts[0]);
                                    let minutes = parseInt(timeParts[1]);
                                    let seconds = parseInt(timeParts[2]);
                                    seconds++;
                                    if (seconds >= 60) {
                                        seconds = 0;
                                        minutes++;
                                        if (minutes >= 60) {
                                            minutes = 0;
                                            hours++;
                                            if (hours >= 24) {
                                                hours = 0;
                                            }
                                        }
                                    }
                                    let newTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')} / ${parts[1]}`;
                                    $("#serverTime").text(newTime);
                                }
                                setInterval(updateServerTime, 1000);
                            });
                        </script>
                    </div>

                </div>

            </div>



            {% if config().enabled().isEnableEmulation() == false %}

            {% for server in servers %}
            {% set serverInfo = getServer(server.id) %}
            <div class="card custom-card overflow-hidden">
                <div class="card-body p-0 border-bottom">
                    <div class="px-1 py-2 {% if server.gameServer == false %}bg-danger{% else %}bg-success{% endif %}">
                        {% if serverInfo.isDisabled() %}
                        <div class="text-center text-white">{{ phrase('The_server_has_been_disabled_by_the_administrator') }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="fs-18 fw-semibold">{{serverInfo.getName()}} x{{serverInfo.getRateExp()}}</div>
                            <div>
                                <span class="badge bg-info-transparent">{{serverInfo.getChronicle()}}</span>
                            </div>
                        </div>

                        <ul class="list-unstyled mb-0">
                            <li class="d-flex align-items-center mb-3">
                                <span class="me-2">
                                     <i class="{% if serverInfo.getStatus().isEnableLoginServerMySQL() %}ri-checkbox-circle-line text-success{% else %}ri-close-circle-line text-danger{% endif %} fs-15"></i>
                                </span>


                                <svg role="button" data-type="login" data-server-id="{{serverInfo.getLoginId()}}"
                                     class="connectionQualityCheck bi bi-database text-primary"
                                     xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                     viewBox="0 0 16 16">
                                    <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
                                </svg>

                                <span class="{% if serverInfo.getStatus().isEnableLoginServerMySQL() %}text-success{% else %}text-danger{% endif %}">
                                                                    <strong class="me-1">{{ phrase('Connecting to DB') }}</strong> LoginServer
                                                                </span>

                            </li>
                            <li class="d-flex align-items-center mb-3">
                <span class="me-2">
                   <i class="{% if serverInfo.getStatus().isEnableGameServerMySQL() %}ri-checkbox-circle-line text-success{% else %}ri-close-circle-line text-danger{% endif %} fs-15"></i>
                </span>

                                <svg role="button" data-type="game" data-server-id="{{serverInfo.getGameId()}}"
                                     class="connectionQualityCheck bi bi-database text-primary"
                                     xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                     viewBox="0 0 16 16">
                                    <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
                                </svg>

                                <span class="{% if serverInfo.getStatus().isEnableGameServerMySQL() %}text-success{% else %}text-danger{% endif %}">
                                                                    <strong class="me-1">{{ phrase('Connecting to DB') }}</strong> GameServer
                                                                </span>
                            </li>


                                {% if serverInfo.getStatus().isEnable() == false %}
                                <div class="card border-0">
                                        <div class="alert alert-danger border border-danger mb-0 ">
                                {{ phrase('Disabled in server settings') }}
                                {% endif %}
                            <li class="d-flex align-items-center {% if serverInfo.getStatus().isEnable() %}mb-3{% endif %}">
                                <span class="me-2">  <i
                                      class="{% if server.loginServer %}ri-checkbox-circle-line text-success{% else %}ri-close-circle-line text-danger{% endif %} fs-15"></i>  </span>
                                <span class="{% if server.loginServer %}text-success{% else %}text-danger{% endif %}">

                                                                    <svg role="button" data-type="login"
                                                                         data-server-id="{{serverInfo.getId()}}"
                                                                         class="portQualityCheck bi bi-database text-primary"
                                                                         xmlns="http://www.w3.org/2000/svg" width="16"
                                                                         height="16" fill="currentColor"
                                                                         viewBox="0 0 16 16">
                                    <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
                                </svg>

                    <strong class="me-1">{{ phrase('Checking the port') }} </strong> LoginServer
                    </span>
                            </li>

                            <li class="d-flex align-items-center {% if serverInfo.getStatus().isEnable() %}mb-3{% endif %}">
                                <span class="me-2">  <i
                                      class="{% if server.gameServer %}ri-checkbox-circle-line text-success{% else %}ri-close-circle-line text-danger{% endif %} fs-15"></i>  </span>
                                <span class="{% if server.gameServer %}text-success{% else %}text-danger{% endif %}">

                                                                    <svg role="button" data-type="game"
                                                                         data-server-id="{{serverInfo.getId()}}"
                                                                         class="portQualityCheck bi bi-database text-primary"
                                                                         xmlns="http://www.w3.org/2000/svg" width="16"
                                                                         height="16" fill="currentColor"
                                                                         viewBox="0 0 16 16">
                                    <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
                                </svg>

                    <strong class="me-1">{{ phrase('Checking the port') }}</strong> GameServer </span>
                            </li>
                                {% if serverInfo.getStatus().isEnable() == false %}
                                       </div>
                                    </div>
                                {% endif %}


                            <li class="d-grid">

                                <div class="btn-group btn-group-sm my-1 d-flex" role="group"
                                     aria-label="Small button group">
                                    <a href="/admin/server/edit/{{serverInfo.getId()}}"
                                       class="btn btn-outline-success w-100">{{ phrase('change') }}</a>
                                    <a href="/admin/server/statistic/{{serverInfo.getId()}}"
                                       class="btn btn-outline-success w-100">{{ phrase('server_online_statistics')
                                        }}</a>
                                </div>

                                <div class="btn-group btn-group-sm my-1 d-flex" role="group"
                                     aria-label="Small button group">
                                    <a href="/admin/server/set/donate/{{serverInfo.getId()}}"
                                       class="btn btn-outline-success w-100">{{ phrase('Donation settings') }}</a>
                                    <a href="/admin/server/set/referral/{{serverInfo.getId()}}"
                                       class="btn btn-outline-success w-100">{{ phrase('Referral settings') }}</a>
                                </div>

                                <div class="btn-group btn-group-sm my-1 d-flex" role="group"
                                     aria-label="Small button group">
                                    <a href="/admin/server/func/{{serverInfo.getId()}}"
                                       class="btn btn-outline-success w-100">{{phrase('functions')}}</a>
                                </div>

                            </li>

                        </ul>

                    </div>

                </div>

                <div class="card-body p-0 main-profile-info">
                    <div class="d-flex align-items-center justify-content-between w-100">
                        <div class="py-3 border-end w-100 text-center">
                            <p class="fw-bold fs-20  text-shadow mb-0">{{server.online}}</p>
                            <p class="mb-0 fs-12 text-muted ">{{ phrase('online') }}</p>
                        </div>
                        <div class="py-3 w-100 text-center {% if server.count_errors >= 1 %}bg-danger-transparent{% endif %}">
                            <a href="/admin/server/errors/{{serverInfo.getId()}}">
                                <p class="fw-bold fs-20  text-shadow mb-0">
                                    {{server.count_errors}}</p>
                                <p class="mb-0 fs-12 text-muted ">{{ phrase('errors') }}</p>
                            </a>
                        </div>
                    </div>
                </div>

            </div>


            {% endfor %}

            {% endif %}

            {% endif %}

            <div class="card custom-card">
                <div class="card-header">
                    <div class="card-title">
                        {{ phrase('l2wow_announcer_rating') }} - <a href="https://l2wow.com" target="_blank">L2WoW.com</a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="text-center">
                            {{ phrase('l2wow_project_continues') }}<br>
                            {{ phrase('l2wow_parallel_project') }}<br>
                            {{ phrase('l2wow_can_use_now') }}<br>
                            {{ phrase('l2wow_admin_panel') }}
                            {{ phrase('l2wow_voting_system') }}
                            {{ phrase('l2wow_add_server') }}
                        <br>
                        <a href="https://l2wow.com" target="_blank" class="btn btn-teal-gradient btn-wave waves-effect waves-light mt-1 ">L2WoW.com</a>
                    </div>
                </div>
            </div>


                        <div class="card custom-card">
                            <div class="card-header">
                                <div class="card-title">
                                    Sphere Launcher 2
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="swiper swiper-effect-cube">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_1.png" alt="img">
                                        </div>
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_2.png" alt="img">
                                        </div>
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_3.png" alt="img">
                                        </div>
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_4.png" alt="img">
                                        </div>
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_5.png" alt="img">
                                        </div>
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_6.png" alt="img">
                                        </div>
                                        <div class="swiper-slide">
                                            <img src="{{template}}/assets/images/promo_launcher_7.png" alt="img">
                                        </div>
                                    </div>
                                    <div class="swiper-pagination"></div>
                                </div>

                                <div class="text-center mt-4">
                                {{ phrase('launcher_looking_best') }}<br>
                                {{ phrase('launcher_sphere_description') }}

                                    <a href="/admin/plugin/sphereLauncher2" class="btn btn-teal-gradient btn-wave waves-effect waves-light mt-1 ">Перейти</a>
                                </div>

                            </div>
                        </div>


            <div class="card">
                    <div class="card-header bg-light p-2 d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">
                            {{phrase('found_bug_question')}}
                        </h6>
                    </div>

                <div class="card-body p-2">
                    <p>{{phrase('found_issue_server_build_missing_idea_contact_sphere_chat')|raw}}</p>
                </div>
            </div>

            <div class="card">
                  <div class="card-header bg-light p-2 d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">
                            {{phrase('admin_recommendations')}}
                        </h6>
                    </div>
                <div class="card-body p-2">

<ul class="list-unstyled mb-4">
  <!-- SUPER-GUARD -->
  <li class="d-flex py-2 border-bottom">
    <div>
      <h6 class="fw-bold mb-1">
        <a href="https://SUPER-GUARD.CLOUD" target="_blank" class="text-orange">
          <img src="{{template}}/assets/images/super-guard-logo-icon.svg" alt="SUPER-GUARD" width="50" height="auto" class="me-2">
          SUPER-GUARD.CLOUD
        </a>
      </h6>
      <p class="small text-muted mb-0">{{ phrase('SUPER-GUARD.CLOUD_BANNER') }}</p>
    </div>
  </li>

    <!-- L2Up.host -->
  <li class="d-flex py-2">
    <div>
      <h6 class="fw-bold mb-1">
        <a href="https://l2up.host" target="_blank" class="text-success">
          <img src="{{template}}/assets/images/l2up3.png" alt="L2Up.host" height="auto" class="me-2">
          L2Up.host
        </a>
      </h6>
      <p class="small text-muted mb-0">{{ phrase('L2Up.host_banner') }}</p>
    </div>
  </li>
</ul>


                </div>
            </div>


        </div>
        <div class="col-xxl-9">
            <div class="row">

                {% if config().enabled().isEnableEmulation() == false and getServerCount() >= 1 %}
				<div class="col-xl-12">
					<div class="card">
						<div class="border-bottom-0 card-body">
							<div id="echart-stats" class="echart-charts"></div>
						</div>
					</div>
				</div>
                {% endif %}

                <div class="col-xl-12">
                    <div class="custom-card">
                        <div class="card-body p-0">
                            <div class="border-block-end-dashed  bg-white rounded-2 p-2">
                                <div>
                                    <ul class="nav nav-pills nav-justified gx-3 tab-style-6 d-sm-flex d-block "
                                        id="myTab" role="tablist">
                                        <li class="nav-item rounded" role="presentation">
                                            <button class="nav-link active" id="followers-tab" data-bs-toggle="tab"
                                                    data-bs-target="#followers-tab-pane" type="button" role="tab"
                                                    aria-controls="followers-tab-pane" aria-selected="false"><i
                                                  class="ri-money-dollar-box-line me-1 align-middle d-inline-block fs-16"></i>{{
                                                phrase('settings') }}
                                            </button>
                                        </li>

                                        <li class="nav-item rounded" role="presentation">
                                            <button class="nav-link " id="php-tab" data-bs-toggle="tab"
                                                    data-bs-target="#php-tab-pane" type="button" role="tab"
                                                    aria-controls="php-tab-pane" aria-selected="true"><i
                                                  class="bi bi-clipboard2-data me-1 align-middle d-inline-block fs-16"></i>
                                                Web-Server
                                            </button>
                                        </li>

                                        <li class="nav-item rounded" role="presentation">
                                            <button class="nav-link " id="activity-tab" data-bs-toggle="tab"
                                                    data-bs-target="#activity-tab-pane" type="button" role="tab"
                                                    aria-controls="activity-tab-pane" aria-selected="true"><i
                                                  class="bi bi-cloud-download me-1 align-middle d-inline-block fs-16"></i>
                                                {{ phrase('History of software updates') }}
                                            </button>
                                        </li>

                                        <li class="nav-item rounded" role="presentation">
                                            <button aria-controls="license-tab-pane" aria-selected="true" class="nav-link "
                                                    data-bs-target="#license-tab-pane" data-bs-toggle="tab" id="licence-tab"
                                                    role="tab" type="button"><i
                                                  class="bi bi-cloud-download me-1 align-middle d-inline-block fs-16"></i>
                                                {{ phrase('license') }}
                                            </button>
                                        </li>

                                    </ul>
                                </div>
                            </div>
                            <div class="py-4">
                                <div class="tab-content" id="myTabContent">

                                    <div class="tab-pane show active fade p-0 border-0" id="followers-tab-pane"
                                         role="tabpanel" aria-labelledby="followers-tab" tabindex="0">
                                        <div class="row">

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/general.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{
                                                                    phrase('general_settings') }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/setting"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/donate.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{
                                                                    phrase('donation_history') }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/server/statistic/donate"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/pages.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('news_and_pages')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/pages"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/servers.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('servers') }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        {% if config().enabled().isEnableEmulation() %}
                                                        {{ phrase('available after disabling emulation') }}
                                                        {% else %}
                                                        <div class="btn-list">
                                                            <a href="/admin/server/list"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/stream.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{phrase('stream')}}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/stream"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/shop.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase(215) }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        {% if config().enabled().isEnableEmulation() %}
                                                        {{ phrase('available after disabling emulation') }}
                                                        {% else %}
                                                        <div class="btn-list">
                                                            <a href="/admin/shop" class="btn btn-sm btn-light btn-wave">{{
                                                                phrase('open') }}</a>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/startpack.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('starter_pack')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        {% if config().enabled().isEnableEmulation() %}
                                                        {{ phrase('available after disabling emulation') }}
                                                        {% else %}
                                                        <div class="btn-list">
                                                            <a href="/admin/shop/startpack"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/bonuscode.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('bonus_codes')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        {% if config().enabled().isEnableEmulation() %}
                                                        {{ phrase('available after disabling emulation') }}
                                                        {% else %}
                                                        <div class="btn-list">
                                                            <a href="/admin/bonuscode/create"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                            <a href="/admin/bonuscode/list"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase(56)
                                                                }}</a>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/forum.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('connect_forum')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/forum"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/users.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('users') }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/users"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/mailing.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('mail_messages')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/mailing"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/logs.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('logs') }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/logs" class="btn btn-sm btn-light btn-wave">{{
                                                                phrase('open') }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/paidext.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('extensions')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/extensions/paid"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/traffics.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('traffic_sources') }}
</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/statistic/http/referral"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                            <h5 class="mb-5 mt-3 fw-semibold text-center">{{ phrase('Developer Panel')
                                                }}</h5>


                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/paidext.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">Sphere API</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/sphereapi"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {# переводы #}
                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/news.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('translations')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/phrases"
                                                               class="btn btn-sm btn-light btn-wave">{{
                                                                phrase('system_phrase') }}</a>
                                                            <a href="/admin/phrases/custom"
                                                               class="btn btn-sm btn-light btn-wave">{{
                                                                phrase('custom_phrase') }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {# Маршрутизаторы #}
                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/routers.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('routers') }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/route"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {# Обновления ПО #}
                                            <div class="col-xxl-4 col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                                <div class="card custom-card shadow-none border">
                                                    <div class="card-body p-4">
                                                        <div class="text-center">
                                                                            <span
                                                                                  class="avatar avatar-xl avatar-rounded">
                                                                                <img
                                                                                      src="{{template}}/assets/images/admenu/updates.png"
                                                                                      alt="">
                                                                            </span>
                                                            <div class="mt-2">
                                                                <p class="mb-0 fw-semibold">{{ phrase('software_update')
                                                                    }}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer text-center">
                                                        <div class="btn-list">
                                                            <a href="/admin/sphere/update"
                                                               class="btn btn-sm btn-light btn-wave">{{ phrase('open')
                                                                }}</a>
                                                            <a href="/admin/filescanner"
                                                               class="btn btn-sm btn-light btn-wave">{{phrase('fileScanner')}}</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                        </div>
                                    </div>

                                    <div class="tab-pane fade p-0 border-0" id="php-tab-pane"
                                         role="tabpanel" aria-labelledby="followers-tab" tabindex="0">
                                        <div class="row">

                                            <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12">
                                                <div class="card custom-card shadow-none border">

                                                    {% set serverInfo = getAdvancedServerInfo() %}
                                                    <div class="container-fluid p-4">
                                                        <div class="row g-4">
                                                            {% for section, data in serverInfo %}
                                                            <div class="col-12">
                                                                <div class="card shadow-sm">
                                                                    <div class="card-header bg-light">
                                                                        <h5 class="card-title mb-0">
                                                                            {% if section == 'main' %}
                                                                            <i class="bi bi-gear-fill me-2"></i>
                                                                            {% elseif section == 'security' %}
                                                                            <i class="bi bi-shield-fill-check me-2"></i>
                                                                            {% elseif section == 'extensions' %}
                                                                            <i class="bi bi-puzzle-fill me-2"></i>
                                                                            {% elseif section == 'uploads' %}
                                                                            <i class="bi bi-upload me-2"></i>
                                                                            {% elseif section == 'sessions' %}
                                                                            <i class="bi bi-clock-history me-2"></i>
                                                                            {% elseif section == 'system' %}
                                                                            <i class="bi bi-cpu-fill me-2"></i>
                                                                            {% elseif section == 'ports' %}
                                                                            <i class="bi bi-hdd-network-fill me-2"></i>
                                                                            {% endif %}
                                                                            {{ data.title }}
                                                                        </h5>
                                                                    </div>
                                                                    <div class="card-body">
                                                                        <div class="table-responsive">
                                                                            <table class="table table-hover table-striped">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th style="width: 25%">Параметр</th>
                                                                                    <th style="width: 25%">Значение</th>
                                                                                    <th style="width: 15%">Статус</th>
                                                                                    <th style="width: 35%">
                                                                                        Рекомендация
                                                                                    </th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                {% for key, info in data.items %}
                                                                                <tr>
                                                                                    <td>
                                                                                        <span class="fw-medium">{{ info.description }}</span>
                                                                                    </td>
                                                                                    <td>
                                                                                        <code class="bg-light px-2 py-1 rounded">{{
                                                                                            info.value }}</code>
                                                                                    </td>
                                                                                    <td>
                                                <span class="badge bg-{{ info.status }} rounded-pill d-inline-flex align-items-center">
                                                    {% if info.status == 'success' %}
                                                        <i class="bi bi-check-circle-fill me-1"></i> OK
                                                    {% elseif info.status == 'warning' %}
                                                        <i class="bi bi-exclamation-triangle-fill me-1"></i> Внимание
                                                    {% elseif info.status == 'danger' %}
                                                        <i class="bi bi-x-circle-fill me-1"></i> Проблема
                                                    {% else %}
                                                        <i class="bi bi-info-circle-fill me-1"></i> Инфо
                                                    {% endif %}
                                                </span>
                                                                                    </td>
                                                                                    <td>
                                                                                        <small class="text-muted">{{
                                                                                            info.recommendation
                                                                                            }}</small>
                                                                                    </td>
                                                                                </tr>
                                                                                {% endfor %}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            {% endfor %}
                                                        </div>

                                                        <!-- Общее резюме -->
                                                        <div class="row mt-4">
                                                            <div class="col-12">
                                                                <div class="card shadow-sm">
                                                                    <div class="card-header bg-light">
                                                                        <h5 class="card-title mb-0">
                                                                            <i class="bi bi-clipboard-data-fill me-2"></i>
                                                                            {{ phrase('overall_summary') }}

                                                                        </h5>
                                                                    </div>
                                                                    <div class="card-body">
                                                                        <div class="row g-4">
                                                                            {% set total = {'success': 0, 'warning': 0,
                                                                            'danger': 0, 'info': 0} %}
                                                                            {% for section in serverInfo %}
                                                                            {% for item in section.items %}
                                                                            {% set total = total|merge({(item.status):
                                                                            total[item.status] + 1}) %}
                                                                            {% endfor %}
                                                                            {% endfor %}

                                                                            <div class="col-md-3">
                                                                                <div class="border rounded p-3 text-center bg-success bg-opacity-10">
                                                                                    <h3 class="text-success mb-0">{{
                                                                                        total.success }}</h3>
                                                                                    <small class="text-muted">{{ phrase('optimal') }}</small>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <div class="border rounded p-3 text-center bg-warning bg-opacity-10">
                                                                                    <h3 class="text-warning mb-0">{{
                                                                                        total.warning }}</h3>
                                                                                    <small class="text-muted">{{ phrase('requires_attention') }}</small>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <div class="border rounded p-3 text-center bg-danger bg-opacity-10">
                                                                                    <h3 class="text-danger mb-0">{{
                                                                                        total.danger }}</h3>
                                                                                    <small class="text-muted">{{ phrase('critical_issues') }}</small>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <div class="border rounded p-3 text-center bg-info bg-opacity-10">
                                                                                    <h3 class="text-info mb-0">{{
                                                                                        total.info }}</h3>
                                                                                    <small class="text-muted">{{ phrase('informational') }}</small>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="alert alert-info mt-4 mb-0">
                                                                            <i class="bi bi-info-circle-fill me-2"></i>
                                                                            {{ phrase('server_optimization_recommendation')|raw }}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="tab-pane fade p-0 border-0" id="activity-tab-pane"
                                         role="tabpanel" aria-labelledby="followers-tab" tabindex="0">
                                        <div class="row">

                                            <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12">
                                                <div class="card custom-card shadow-none border">

                                                    <div class="card-body border-bottom">
                                                        <div class="d-md-flex">
                                                            <a href="javascript:void(0);"
                                                               class="d-flex me-4 mb-sm-0 mb-2">
                                                                {{ phrase('List of recent important updates') }}
                                                            </a>

                                                            <div class="ms-auto">
                                                                {{ phrase('Latest software update') }}:
                                                                <span class="my-auto ms-2 text-muted fw-semibold">{{getLastDateUpdateCommit|date("H:m:s / d.m.Y")}}</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <ul class="list-unstyled profile-timeline   p-0 border-0 bg-white p-4 rounded-3 ">

                                                        {% for log in updateLog %}
                                                        <li>
                                                            <span class="fs-12 text-muted fw-semibold text-end profile-timeline-time">{{log.date}}</span>
                                                            <div>
                                                                    <span class="avatar avatar-sm avatar-rounded profile-timeline-avatar">
                                                                        <img src="{{template}}/assets/images/update_icon.webp"
                                                                             alt="">
                                                                    </span>

                                                                <p class="text-muted mb-0">
                                                                    {{log.message|raw}}
                                                                </p>

                                                            </div>
                                                        </li>
                                                        {% endfor %}


                                                    </ul>

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div aria-labelledby="followers-tab" class="tab-pane fade p-0 border-0"
                                         id="license-tab-pane" role="tabpanel" tabindex="0">
                                        <div class="row">

                                            <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12">
                                                <div class="card custom-card shadow-none border">


                                                    <div class="container mt-5">
                                                        {{ phrase('license_agreement')|raw }}
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End::row-1 -->

</div>

{% endblock %}


{% block css %}
<link rel="stylesheet" href="{{template}}/assets/libs/sweetalert2/sweetalert2.min.css">
<link rel="stylesheet" href="{{template}}/assets/libs/swiper/swiper-bundle.min.css">

{% endblock %}


{% block js %}
<script src="{{template}}/assets/libs/sweetalert2/sweetalert2.min.js?v=0.0.2"></script>
<script src="{{template}}/assets/js/sweetalertdb.js?v=0.0.3"></script>


    <!-- Swiper JS -->
    <script src="{{template}}/assets/libs/swiper/swiper-bundle.min.js"></script>

    <!-- Internal Swiper JS -->
    <script src="{{template}}/assets/js/swiper.js"></script>


{% if config().enabled().isEnableEmulation() == false and getServerCount() >= 1 %}
<script src="{{template}}/assets/libs/echarts/echarts.min.js"></script>
<script>
{% set getItemIdToGameTransfer = get_item_info(getServer().donate().getItemIdToGameTransfer()) %}
$(document).ready(function() {
    {% set sphereCoinCost = getServer().donate().getSphereCoinCost() %}
    {% if sphereCoinCost >= 1 %}
    {% set USD = getServer().donate().getRatioUSD() / sphereCoinCost %}
    {% else %}
    {% set USD = getServer().donate().getRatioUSD() * sphereCoinCost %}
    {% endif %}

    var usdRatio = {{ USD|json_encode|raw }};

    var registrationsData = {{ getUserRegistrations()|json_encode|raw }};
    var donationsData = {{ getUserDonations()|json_encode|raw }};

    var registrationDates = [];
    var registrationCounts = [];

    registrationsData.sort(function(a, b) {
        return new Date(a.registration_date) - new Date(b.registration_date);
    });

    for (var i = 0; i < registrationsData.length; i++) {
        var dateObj = new Date(registrationsData[i].registration_date);
        var formattedDate = dateObj.getDate() + '.' + (dateObj.getMonth() + 1) + '.' + dateObj.getFullYear();

        registrationDates.push(formattedDate);
        registrationCounts.push(registrationsData[i].registrations_count);
    }

    var donationsByDate = {};

    for (var i = 0; i < donationsData.length; i++) {
        var donationDate = donationsData[i].date.split(' ')[0];
        var donationPoint = parseInt(donationsData[i].point);

        if (!donationsByDate[donationDate]) {
            donationsByDate[donationDate] = 0;
        }

        donationsByDate[donationDate] += donationPoint;
    }

    var donationDates = [];
    var donationAmounts = [];
    var donationUsdAmounts = [];
    var sortedDonationDates = Object.keys(donationsByDate).sort();

    for (var i = 0; i < sortedDonationDates.length; i++) {
        var dateObj = new Date(sortedDonationDates[i]);
        var formattedDate = dateObj.getDate() + '.' + (dateObj.getMonth() + 1) + '.' + dateObj.getFullYear();

        donationDates.push(formattedDate);
        donationAmounts.push(donationsByDate[sortedDonationDates[i]]);
        var usdAmount = parseFloat((donationsByDate[sortedDonationDates[i]] * usdRatio).toFixed(2));
        donationUsdAmounts.push(usdAmount);
    }

    var serversData = [];
    var serverNames = [];
    var serverColors = [
        '#f7b731', // Желтый
        '#e82646', // Красный
        '#49b6f5', // Голубой
        '#28c76f', // Зеленый
        '#6c757d', // Серый
        '#fd7e14', // Оранжевый
        '#6f42c1', // Фиолетовый
        '#20c997'  // Бирюзовый
    ];

    {% for server in getServers() %}
    var serverName = "{{ server.getName() }}";
    var serverDataRaw = {{ getStatisticOnline(server.getId())|json_encode|raw }};
    var serverData = (serverDataRaw && typeof serverDataRaw === 'object') ? serverDataRaw : {};

    var onlineByDate = {};

    if (Object.keys(serverData).length > 0) {
        for (var date in serverData) {
            var totalOnline = 0;
            var hoursCount = 0;

            for (var hour in serverData[date]) {
                var onlineValue = serverData[date][hour];
                if (onlineValue !== null && onlineValue !== undefined && !isNaN(onlineValue)) {
                    totalOnline += onlineValue;
                    hoursCount++;
                }
            }

            // Вычисляем среднее значение онлайна за день
            if (hoursCount > 0) {
                onlineByDate[date] = Math.round(totalOnline / hoursCount);
            } else {
                onlineByDate[date] = 0;
            }
        }
    }

    var onlineDates = [];
    var onlineValues = [];

    var sortedOnlineDates = Object.keys(onlineByDate).sort();

    for (var i = 0; i < sortedOnlineDates.length; i++) {
        var dateObj = new Date(sortedOnlineDates[i]);
        var formattedDate = dateObj.getDate() + '.' + (dateObj.getMonth() + 1) + '.' + dateObj.getFullYear();

        onlineDates.push(formattedDate);
        onlineValues.push(onlineByDate[sortedOnlineDates[i]]);
    }

    serversData.push({
        name: serverName,
        dates: onlineDates,
        values: onlineValues
    });

    serverNames.push(serverName);
    {% endfor %}

    var allDates = [...registrationDates, ...donationDates];

    for (var i = 0; i < serversData.length; i++) {
        allDates = [...allDates, ...serversData[i].dates];
    }

    allDates = [...new Set(allDates)];

    allDates.sort(function(a, b) {
        var partsA = a.split('.');
        var partsB = b.split('.');
        var dateA = new Date(partsA[2], partsA[1] - 1, partsA[0]);
        var dateB = new Date(partsB[2], partsB[1] - 1, partsB[0]);
        return dateA - dateB;
    });

    var fullRegistrationData = [];
    var fullDonationData = [];
    var fullDonationUsdData = [];
    var fullServersData = [];

    for (var i = 0; i < allDates.length; i++) {
        var regIndex = registrationDates.indexOf(allDates[i]);
        var donIndex = donationDates.indexOf(allDates[i]);

        fullRegistrationData.push(regIndex !== -1 ? registrationCounts[regIndex] : 0);
        fullDonationData.push(donIndex !== -1 ? donationAmounts[donIndex] : 0);
        fullDonationUsdData.push(donIndex !== -1 ? donationUsdAmounts[donIndex] : 0);
    }

    for (var i = 0; i < serversData.length; i++) {
        var serverFullData = [];

        for (var j = 0; j < allDates.length; j++) {
            var serverDateIndex = serversData[i].dates.indexOf(allDates[j]);
            serverFullData.push(serverDateIndex !== -1 ? serversData[i].values[serverDateIndex] : 0);
        }

        fullServersData.push(serverFullData);
    }

    // Вычисляем общую сумму пожертвований
    var totalDonations = fullDonationData.reduce(function(a, b) { return a + b; }, 0);
    var totalDonationsUsd = fullDonationUsdData.reduce(function(a, b) { return a + b; }, 0);

    var dom = document.getElementById('echart-stats');
    var myChart = echarts.init(dom, null, {
        renderer: 'canvas',
        useDirtyRect: false
    });

    var allSeries = [
        {
            name: '{{phrase("registrations")}}',
            type: 'line',
            smooth: true,
            symbol: 'circle',
            symbolSize: 5,
            sampling: 'average',
            yAxisIndex: 0,
            itemStyle: {
                color: '#6c5ffc'
            },
            areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {
                        offset: 0,
                        color: 'rgba(108, 95, 252, 0.5)'
                    },
                    {
                        offset: 1,
                        color: 'rgba(108, 95, 252, 0.1)'
                    }
                ])
            },
            data: fullRegistrationData
        },
        {
            name: '{{phrase("LOG_DONATE_SUCCESS_DESC")}}',
            type: 'line',
            smooth: true,
            symbol: 'diamond',
            symbolSize: 6,
            yAxisIndex: 1,
            itemStyle: {
                color: '#05c3fb'
            },
            areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {
                        offset: 0,
                        color: 'rgba(5, 195, 251, 0.5)'
                    },
                    {
                        offset: 1,
                        color: 'rgba(5, 195, 251, 0.1)'
                    }
                ])
            },
            data: fullDonationData
        }
    ];

    for (var i = 0; i < serversData.length; i++) {
        allSeries.push({
            name: serversData[i].name,
            type: 'line',
            smooth: true,
            symbol: 'triangle',
            symbolSize: 6,
            yAxisIndex: 2,
            itemStyle: {
                color: serverColors[i % serverColors.length]
            },
            areaStyle: {
                opacity: 0.3,
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {
                        offset: 0,
                        color: serverColors[i % serverColors.length]
                    },
                    {
                        offset: 1,
                        color: 'rgba(' +
                              Math.floor(Math.random() * 100 + 155) + ', ' +
                              Math.floor(Math.random() * 100 + 155) + ', ' +
                              Math.floor(Math.random() * 100 + 155) + ', 0.1)'
                    }
                ])
            },
            data: fullServersData[i]
        });
    }

    var legendData = ['{{phrase("registrations")}}', '{{phrase("LOG_DONATE_SUCCESS_DESC")}}'].concat(serverNames);

    // Базовая конфигурация графика
    var option = {
        grid: {
            left: "3%",
            right: "5%",
            bottom: "25%",
            top: "22%",
            containLabel: true
        },
        title: {
            text: '{{phrase("complex_statistics")}}' + ' ($' + totalDonationsUsd.toFixed(2) + ')',
            left: 'center',
            textStyle: {
                color: '#555'
            },
            subtextStyle: {
                color: '#05c3fb'
            }
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'cross',
                label: {
                    backgroundColor: '#6a7985'
                }
            },
            formatter: function(params) {
                var result = params[0].name + '<br/>';
                for (var i = 0; i < params.length; i++) {
                    var color = params[i].color;
                    var marker = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:' + color + '"></span>';

                    if (params[i].seriesName === '{{phrase("registrations")}}') {
                        result += marker + params[i].seriesName + ': ' + params[i].value + ' {{phrase(103)|lower}}.<br/>';
                    } else if (params[i].seriesName === '{{phrase("LOG_DONATE_SUCCESS_DESC")}}') {
                        var dateIndex = allDates.indexOf(params[i].name);
                        var usdValue = fullDonationUsdData[dateIndex];
                        result += marker + params[i].seriesName + ': ' + params[i].value + ' {{ getItemIdToGameTransfer.itemName }} ($' + usdValue.toFixed(2) + ')<br/>';
                    } else {
                        result += marker + 'Online [' + params[i].seriesName + ']: ' + params[i].value + ' {{phrase(103)|lower}}.<br/>';
                    }
                }
                return result;
            }
        },
        legend: {
            data: legendData,
            top: '8%',
            textStyle: {
                color: '#777'
            },
            type: serversData.length > 3 ? 'scroll' : 'plain',
            pageButtonPosition: 'end',
            selectedMode: true
        },
        toolbox: {
            feature: {
                saveAsImage: {},
                dataZoom: {
                    yAxisIndex: 'none'
                },
                restore: {}
            },
            right: '2%',
            top: '3%'
        },
        dataZoom: [
            {
                type: 'inside',
                start: 50,
                end: 100,
                zoomLock: false
            },
            {
                type: 'slider',
                show: true,
                start: 50,
                end: 100,
                height: 30,
                bottom: 5,
                borderColor: '#ccc',
                fillerColor: 'rgba(108, 95, 252, 0.2)',
                handleStyle: {
                    color: '#6c5ffc',
                    borderColor: '#6c5ffc'
                }
            }
        ],
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: allDates,
            axisLabel: {
                rotate: 45,
                interval: 'auto',
                formatter: function(value) {
                    return value;
                }
            },
            axisLine: {
                lineStyle: {
                    color: "#8c9097"
                }
            }
        },
        yAxis: [
            {
                type: 'value',
                name: '{{phrase("registrations")}}',
                position: 'left',
                axisLabel: {
                    formatter: '{value} {{phrase(103)|lower}}.'
                },
                axisLine: {
                    lineStyle: {
                        color: "#6c5ffc"
                    }
                },
                splitLine: {
                    lineStyle: {
                        color: "rgba(142, 156, 173,0.1)"
                    }
                }
            },
            {
                type: 'value',
                name: 'USD',
                position: 'right',
                offset: 80,
                axisLabel: {
                    formatter: function(value) {
                        var usdValue = (value * usdRatio).toFixed(2);
                        return '$' + usdValue;
                    },
                    margin: 8
                },
                scale: true,
                min: 0,
                axisLine: {
                    lineStyle: {
                        color: "#05c3fb"
                    }
                },
                splitLine: {
                    show: false
                }
            },
            {
                type: 'value',
                name: '{{phrase("online")}}',
                position: 'right',
                axisLabel: {
                    formatter: '{value} {{phrase(103)|lower}}'
                },
                axisLine: {
                    lineStyle: {
                        color: "#f7b731"
                    }
                },
                splitLine: {
                    show: false
                }
            }
        ],
        series: allSeries
    };

    myChart.setOption(option);

    var axisState = {
        registration: true,
        donation: true,
        server: true
    };

    myChart.on('legendselectchanged', function(params) {
        var selectedSeries = params.selected;

        // Проверяем текущее состояние осей
        var newRegistrationState = selectedSeries['{{phrase("registrations")}}'] === true;
        var newDonationState = selectedSeries['{{phrase("LOG_DONATE_SUCCESS_DESC")}}'] === true;

        var newServerState = false;
        for (var i = 0; i < serverNames.length; i++) {
            if (selectedSeries[serverNames[i]] === true) {
                newServerState = true;
                break;
            }
        }

        var stateChanged = (
              newRegistrationState !== axisState.registration ||
              newDonationState !== axisState.donation ||
              newServerState !== axisState.server
        );

        axisState.registration = newRegistrationState;
        axisState.donation = newDonationState;
        axisState.server = newServerState;

        if (stateChanged) {
            var newYAxis = [
                {
                    type: 'value',
                    name: '{{phrase("registrations")}}',
                    position: 'left',
                    axisLabel: {
                        formatter: '{value} {{phrase(103)|lower}}.'
                    },
                    axisLine: {
                        lineStyle: {
                            color: "#6c5ffc"
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: "rgba(142, 156, 173,0.1)"
                        }
                    },
                    show: newRegistrationState
                },
                {
                    type: 'value',
                    name: 'USD',
                    position: newRegistrationState ? 'right' : 'left',
                    offset: newRegistrationState ? 80 : 0,
                    axisLabel: {
                        formatter: function(value) {
                            var usdValue = (value * usdRatio).toFixed(2);
                            return '$' + usdValue;
                        },
                        margin: 8
                    },
                    scale: true,
                    min: 0,
                    axisLine: {
                        lineStyle: {
                            color: "#05c3fb"
                        }
                    },
                    splitLine: {
                        show: false
                    },
                    show: newDonationState
                },
                {
                    type: 'value',
                    name: '{{phrase("online")}}',
                    position: 'right',
                    axisLabel: {
                        formatter: '{value} {{phrase(103)|lower}}'
                    },
                    axisLine: {
                        lineStyle: {
                            color: "#f7b731"
                        }
                    },
                    splitLine: {
                        show: false
                    },
                    show: newServerState
                }
            ];

            myChart.setOption({
                yAxis: newYAxis
            });
        }
    });

    window.addEventListener('resize', function() {
        myChart.resize();
    });
});
</script>
{% endif %}

{% endblock %}