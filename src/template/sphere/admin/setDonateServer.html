{% extends 'struct.html' %}

{% block title %}Set Donate{% endblock %}

{% block content %}
<div class="container-fluid">

    <div class="row">
        <div class="col-xl-12">
            <div class="card custom-card">
                <div class="card-header justify-content-between">
                    <div class="card-title">
                        <a href="/admin" class="avatar border text-muted">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM12 11H16V13H12V16L8 12L12 8V11Z"></path></svg>
                        </a>
                        Настройки пожертвований и вознаграждений
                    </div>
                    <div class="d-flex">
                        <button class="btn btn-sm btn-success btn-wave waves-light waves-effect waves-light saveDonateConfig"><i
                                class="ri-add-line fw-semibold align-middle me-1"></i> Сохранить</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="alert alert-primary alert-dismissible fade show custom-alert-icon shadow-sm" role="alert">
                        <svg class="svg-primary" xmlns="http://www.w3.org/2000/svg" height="1.5rem" viewBox="0 0 24 24" width="1.5rem" fill="#000000"><path d="M0 0h24v24H0z" fill="none"></path><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"></path></svg>
                        Настройки пожертвований и других настроек этого раздела будут использоваться для сервера {{server.getName()}} x{{server.getRateExp()}}
                    </div>
                    <div class="row">
                    <div class="col-xl-6">
                        <div class="card custom-card shadow-none mb-0 border">
                            <div class="card-body">

                                <div>
                                    <p class="fs-14 mb-1 fw-semibold">{{ phrase('default_payment_system') }}</p>
                                    <p class="fs-12 text-muted mb-0">{{ phrase('default_payment_system_for_users')
                                        }}</p>
                                </div>

                                <div class="custom-toggle-switch ms-0">
                                    <select class="form-control" data-trigger="" name="paySystemDefault"
                                            id="paySystemDefault">
                                        {% for donate in donateSysNames %}
                                        <option {% if config().donate().getPaySystemDefault()== donate.name %}selected{%
                                                endif %}
                                                value="{{donate.name}}">{{donate.name}}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>


                                <hr>
                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('donation_range') }}</p>
                                        <p class="fs-12 text-muted mb-0">{{ phrase('donation_min_max') }}</p>
                                    </div>

                                    <div class="col-xl-3">
                                        <label for="minSummaPaySphereCoin" class="form-label">{{ phrase('min_amount')
                                            }}</label>
                                        <input value="{{config().donate().getMinSummaPaySphereCoin()}}" type="number"
                                               class="form-control" id="minSummaPaySphereCoin" placeholder="1">
                                    </div>
                                    <div class="col-xl-3">
                                        <label for="maxSummaPaySphereCoin" class="form-label">{{ phrase('max_amount')
                                            }}</label>
                                        <input value="{{config().donate().getMaxSummaPaySphereCoin()}}" type="number"
                                               class="form-control" id="maxSummaPaySphereCoin" placeholder="999999">
                                    </div>
                                </div>

                                <hr>

                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('donate_coin_to_dollar') }}</p>
                                        <p class="fs-12 text-muted mb-0">{{ phrase('donate_coin_per_dollar') }}</p>
                                    </div>

                                    <div class="col-xl-3">
                                        <input min="0.01" step="0.01" type="number"
                                               value="{{config().donate().getSphereCoinCost()}}"
                                               class="form-control" id="sphereCoinCost" placeholder="1">
                                    </div>
                                </div>

                                <hr>

                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('currency_ratio') }}</p>
                                    </div>
                                    <div class="col-xl-2">
                                        <label for="ratioUSD" class="form-label">USD</label>
                                        <input min="0.01" step="0.01" type="number" class="form-control" disabled
                                               id="ratioUSD"
                                               value="{{config().donate().getRatioUSD()}}" placeholder="1">
                                    </div>
                                    <div class="col-xl-2">
                                        <label for="ratioEUR" class="form-label">EUR</label>
                                        <input min="0.01" step="0.01" type="number" class="form-control" id="ratioEUR"
                                               value="{{config().donate().getRatioEUR()}}" placeholder="1.05">
                                    </div>
                                    <div class="col-xl-2">
                                        <label for="ratioUAH" class="form-label">UAH</label>
                                        <input min="0.01" step="0.01" type="number" class="form-control" id="ratioUAH"
                                               value="{{config().donate().getRatioUAH()}}" placeholder="38.5">
                                    </div>
                                    <div class="col-xl-2">
                                        <label for="ratioRUB" class="form-label">RUB</label>
                                        <input min="0.01" step="0.01" type="number" class="form-control" id="ratioRUB"
                                               value="{{config().donate().getRatioRUB()}}" placeholder="100">
                                    </div>
                                </div>

                                <hr>

                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('enable_cumulative_discount_system')
                                            }}</p>
                                        <p class="fs-12 text-muted mb-0">
                                            {{ phrase('cumulative_discount_description') }}
                                        </p>
                                    </div>
                                    <div class="custom-toggle-switch ms-sm-2 ms-0">
                                        <input {% if config().donate().isEnableCumulativeDiscountSystem() %}checked{%
                                               endif %}
                                               id="enableCumulativeDiscountSystem" name="enableCumulativeDiscountSystem"
                                               type="checkbox">
                                        <label for="enableCumulativeDiscountSystem" class="label-primary mb-1"></label>
                                    </div>
                                </div>
                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div class="mb-sm-0 mb-2">
                                        <div class="mb-0">
                                            <div class="row">

                                                <div class="table-responsive">
                                                    <table class="table text-nowrap table-bordered"
                                                           id="table_CumulativeDiscountSystem">
                                                        <thead>
                                                        <tr>
                                                            <th data-name="coin" scope="col">{{
                                                                phrase('amount_of_donate_coin') }}
                                                            </th>
                                                            <th data-name="percent" scope="col">{{
                                                                phrase('bonus_percentage') }}
                                                            </th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        {% for table in
                                                        config().donate().getTableCumulativeDiscountSystem() %}
                                                        <tr>
                                                            <th scope="row">{{table.coin}}</th>
                                                            <td>{{table.percent}}</td>
                                                            <td>
                                                                <div class="hstack gap-2 flex-wrap">
                                                                    <a href="javascript:void(0);"
                                                                       class="text-info fs-14 lh-1"><i
                                                                            class="ri-edit-line"></i></a>
                                                                    <a href="javascript:void(0);"
                                                                       class="text-danger fs-14 lh-1"><i
                                                                            class="ri-delete-bin-5-line"></i></a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}

                                                        </tbody>
                                                    </table>
                                                    <button id="AddNewCumulativeDiscountSystem" type="button"
                                                            class="btn btn-sm btn-success btn-wave waves-effect waves-light">
                                                        {{ phrase(438) }}
                                                    </button>
                                                </div>


                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <hr>
                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('enable_one_time_bonus') }}</p>
                                        <p class="fs-12 text-muted mb-0">
                                            {{ phrase('one_time_bonus_description') }}
                                        </p>
                                    </div>
                                    <div class="custom-toggle-switch ms-sm-2 ms-0">
                                        <input {% if config().donate().isEnableOneTimeBonus() %}checked{% endif %}
                                               id="enableOneTimeBonus" name="enableOneTimeBonus" type="checkbox">
                                        <label for="enableOneTimeBonus" class="label-primary mb-1"></label>
                                    </div>
                                </div>
                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div class="mb-sm-0 mb-2">
                                        <div class="mb-0">
                                            <div class="row">

                                                <div class="table-responsive" id="table_EnableOneTimeBonus">
                                                    <table class="table text-nowrap table-bordered">
                                                        <thead>
                                                        <tr>
                                                            <th data-name="coin" scope="col">{{
                                                                phrase('amount_of_donate_coin') }}
                                                            </th>
                                                            <th data-name="percent" scope="col">{{
                                                                phrase('bonus_percentage') }}
                                                            </th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for table in config().donate().getTableEnableOneTimeBonus()
                                                        %}
                                                        <tr>
                                                            <th data-name="coin" scope="row">{{table.coin}}</th>
                                                            <td data-name="percent">{{table.percent}}</td>
                                                            <td>
                                                                <div class="hstack gap-2 flex-wrap">
                                                                    <a href="javascript:void(0);"
                                                                       class="text-info fs-14 lh-1"><i
                                                                            class="ri-edit-line"></i></a>
                                                                    <a href="javascript:void(0);"
                                                                       class="text-danger fs-14 lh-1"><i
                                                                            class="ri-delete-bin-5-line"></i></a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <button id="AddNewEnableOneTimeBonus" type="button"
                                                            class="btn btn-sm btn-success btn-wave waves-effect waves-light">
                                                        {{ phrase(438) }}
                                                    </button>
                                                </div>


                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <hr>


                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('enable_item_purchase_discounts')
                                            }}</p>
                                        <p class="fs-12 text-muted mb-0">
                                            {{ phrase('item_purchase_discount_description') }}
                                        </p>
                                    </div>
                                    <div class="custom-toggle-switch ms-sm-2 ms-0">
                                        <input {% if config().donate().isEnableSystemDiscountsOnItemPurchases()
                                               %}checked{% endif %}
                                               id="enableSystemDiscountsOnItemPurchases"
                                               name="enableSystemDiscountsOnItemPurchases"
                                               type="checkbox">
                                        <label for="enableSystemDiscountsOnItemPurchases"
                                               class="label-primary mb-1"></label>
                                    </div>
                                </div>
                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div class="mb-sm-0 mb-2">
                                        <div class="mb-0">
                                            <div class="row">

                                                <div class="table-responsive">
                                                    <table class="table text-nowrap table-bordered"
                                                           id="table_SystemDiscountsOnItemPurchases">
                                                        <thead>
                                                        <tr>
                                                            <th data-name="coin" scope="col">{{
                                                                phrase('amount_of_donate_coin') }}
                                                            </th>
                                                            <th data-name="percent" scope="col">{{
                                                                phrase('bonus_percentage') }}
                                                            </th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for table in
                                                        config().donate().getTableSystemDiscountsOnItemPurchases() %}
                                                        <tr>
                                                            <th scope="row">{{table.coin}}</th>
                                                            <td>{{table.percent}}</td>
                                                            <td>
                                                                <div class="hstack gap-2 flex-wrap">
                                                                    <a href="javascript:void(0);"
                                                                       class="text-info fs-14 lh-1"><i
                                                                            class="ri-edit-line"></i></a>
                                                                    <a href="javascript:void(0);"
                                                                       class="text-danger fs-14 lh-1"><i
                                                                            class="ri-delete-bin-5-line"></i></a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}

                                                        </tbody>
                                                    </table>
                                                    <button id="AddNewSystemDiscountsOnItemPurchases" type="button"
                                                            class="btn btn-sm btn-success btn-wave waves-effect waves-light">
                                                        {{ phrase(438) }}
                                                    </button>
                                                </div>


                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <hr>


                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div>
                                        <p class="fs-14 mb-1 fw-semibold">{{ phrase('enable_quantity_discounts') }}</p>
                                        <p class="fs-12 text-muted mb-0">
                                            {{ phrase('donation_based_discount') }}
                                        </p>
                                    </div>
                                    <div class="custom-toggle-switch ms-sm-2 ms-0">
                                        <input {% if
                                               config().donate().isEnableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity()
                                               %}checked{% endif %}
                                               id="enableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity"
                                               name="enableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity"
                                               type="checkbox">
                                        <label for="enableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity"
                                               class="label-primary mb-1"></label>
                                    </div>
                                </div>
                                <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                    <div class="mb-sm-0 mb-2">
                                        <div class="mb-0">
                                            <div class="row">

                                                <div class="table-responsive">
                                                    <table class="table text-nowrap table-bordered"
                                                           id="table_IncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity">
                                                        <thead>
                                                        <tr>
                                                            <th data-name="count" scope="col">{{
                                                                phrase('amount_of_donate_coin') }}
                                                            </th>
                                                            <th data-name="percent" scope="col">{{
                                                                phrase('bonus_percentage') }}
                                                            </th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for table in
                                                        config().donate().getTableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity()
                                                        %}
                                                        <tr>
                                                            <th scope="row">{{table.count}}</th>
                                                            <td>{{table.percent}}</td>
                                                            <td>
                                                                <div class="hstack gap-2 flex-wrap">
                                                                    <a href="javascript:void(0);"
                                                                       class="text-info fs-14 lh-1"><i
                                                                            class="ri-edit-line"></i></a>
                                                                    <a href="javascript:void(0);"
                                                                       class="text-danger fs-14 lh-1"><i
                                                                            class="ri-delete-bin-5-line"></i></a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}

                                                        </tbody>
                                                    </table>
                                                    <button id="AddNewIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity"
                                                            type="button"
                                                            class="btn btn-sm btn-success btn-wave waves-effect waves-light">
                                                        {{ phrase(438) }}
                                                    </button>
                                                </div>

                                            </div>

                                            {{ phrase('discount_item_ids') }}
                                            <div class="row">

                                                <div class="table-responsive">
                                                    <table class="table text-nowrap table-bordered"
                                                           id="table_ListOfItemsForDiscount">
                                                        <thead>
                                                        <tr>
                                                            <th data-name="count" scope="col">{{
                                                                phrase('quantity_of_items_purchased') }}
                                                            </th>
                                                            <th data-name="percent" scope="col">{{
                                                                phrase('discount_percentage') }}
                                                            </th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        {% for table in
                                                        config().donate().getTableListOfItemsForDiscount() %}
                                                        <tr>
                                                            <th scope="row">{{table.count}}</th>
                                                            <td>{{table.percent}}</td>
                                                            <td>
                                                                <div class="hstack gap-2 flex-wrap">
                                                                    <a href="javascript:void(0);"
                                                                       class="text-info fs-14 lh-1"><i
                                                                            class="ri-edit-line"></i></a>
                                                                    <a href="javascript:void(0);"
                                                                       class="text-danger fs-14 lh-1"><i
                                                                            class="ri-delete-bin-5-line"></i></a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <button id="AddNewListOfItemsForDiscount" type="button"
                                                            class="btn btn-sm btn-success btn-wave waves-effect waves-light">
                                                        {{ phrase(438) }}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="card custom-card shadow-none mb-4 border">
                            <div class="card-header">
                                <div class="card-title">{{ phrase('transfer_to_game') }}</div>
                            </div>
                            <div class="card-body row">

                                <label class="form-label op-5 ">{{ phrase('direct_transfer_items') }}</label>
                                <label class="form-label op-5 ">{{ phrase('items_per_donate_coin') }}</label>

                                <div class="col-xxl-4 col-xl-6 ">
                                    <div class="input-group">
                                        <div class="input-group-text">ID</div>
                                        <input name="item_id_to_game_transfer" min="1" type="number"
                                               class="form-control form-control-sm"
                                               id="item_id_to_game_transfer"
                                               placeholder="4037"
                                               value="{{config().donate().getItemIdToGameTransfer()}}">
                                    </div>
                                </div>

                                <div class="col-xxl-4 col-xl-6 mb-1">
                                    <div class="input-group">
                                        <div class="input-group-text">Donate Item</div>
                                        <input name="donate_item_to_game_transfer" min="1" type="number"
                                               class="form-control form-control-sm"
                                               id="donate_item_to_game_transfer"
                                               placeholder="1"
                                               value="{{config().donate().getDonateItemToGameTransfer()}}">
                                    </div>
                                </div>

                                <div class="col-xxl-4 col-xl-6 mb-1">
                                    <div class="input-group">
                                        <div class="input-group-text">Count</div>
                                        <input name="count_items_to_game_transfer" min="1" type="number"
                                               class="form-control form-control-sm"
                                               id="count_items_to_game_transfer"
                                               placeholder="1000"
                                               value="{{config().donate().getCountItemsToGameTransfer()}}">
                                    </div>
                                </div>


                            </div>
                        </div>
                        <div id="bonus_Item_donation"
                             class="card custom-card shadow-none mb-4 border">
                            <div class="card-header justify-content-between d-sm-flex d-block">
                                <div class="card-title">{{ phrase('item_donation_reward') }}
                                </div>
                                <div class="mt-sm-0 mt-2">
                                    <div class="custom-toggle-switch ms-sm-2 ms-0">
                                        <input {% if config().donate().isRewardForDonatingItems()
                                               %}checked{% endif %} id="rewardForDonatingItems"
                                               name="rewardForDonatingItems" type="checkbox">
                                        <label for="rewardForDonatingItems"
                                               class="label-primary mb-1"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">

                                <div class="row">

                                    <label class="form-label op-5 ">{{ phrase('donation_bonus_items') }}</label>

                                    <div class="px-4 py-3 border-top border-block-start-dashed d-sm-flex justify-content-end">
                                        <div class="col-xl-4">
                                            <input id="costItem" type="text"
                                                   class="form-control" placeholder="{{ phrase(72) }}">
                                        </div>
                                        <button id="addCostItem"
                                                class="btn btn-primary-light m-1">{{ phrase(438) }}
                                            {{ phrase('tab') }}<i class="bi bi-plus-lg ms-2"></i></button>
                                    </div>
                                </div>


                                <ul class="nav nav-tabs mb-3 tab-style-6" id="myTab"
                                    role="tablist">
                                    {% set i = 1 %}
                                    {% for key, table in config().donate().getTableItemsBonus() %}
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link {% if i==1 %} active{% endif %}"
                                                id="list_{{i}}" data-bs-toggle="tab"
                                                data-bs-target="#list_{{i}}-pane" type="button"
                                                role="tab"
                                                aria-controls="list_{{i}}-pane"
                                                aria-selected="true">{{key}}
                                        </button>
                                    </li>
                                    {% set i = i+1 %}
                                    {% endfor %}

                                </ul>

                                <div class="tab-content" id="allItemsBonusData">
                                    {% set i = 1 %}
                                    {% for key, table in config().donate().getTableItemsBonus() %}
                                    <div class="tab-pane fade p-0 border-bottom-0 {% if i==1 %}show active{% endif %} "
                                         id="list_{{i}}-pane"
                                         role="tabpanel" aria-labelledby="list_{{i}}"
                                         tabindex="0">
                                        <div class="table-responsive">
                                            <table class="table mb-0">
                                                <thead>
                                                <tr>
                                                    <th scope="col"></th>
                                                    <th scope="col">{{ phrase(301) }}</th>
                                                    <th scope="col">{{ phrase(71) }}</th>
                                                    <th scope="col">{{ phrase('enchant') }}</th>
                                                    <th scope="col"></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for data in table %}
                                                <tr>
                                                    <th scope="row">
                                                                                <span class="avatar avatar-sm">
                                                                                    <img
                                                                                            src="{{data.item.getIcon()}}"
                                                                                            alt="img">
                                                                                </span>
                                                    </th>
                                                    <td>{{data.id}}</td>
                                                    <td>{{data.count}}</td>
                                                    <td>{{data.enchant}}</td>
                                                    <td><a href="javascript:void(0);"
                                                           class="text-danger fs-14 lh-1 removeTableItemsBonus"><i
                                                            class="ri-delete-bin-5-line"></i></a></td>
                                                </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>


                                        </div>
                                    </div>
                                    {% set i = i+1 %}
                                    {% endfor %}
                                </div>

                                <br>
                                Какие предметы добавить
                                <div class="row gy-2 gx-3 align-items-center mb-4">
                                    <div class="col-xxl-2 col-xl-3 mb-2">
                                        <div class="input-group">
                                            <div class="input-group-text">ID</div>
                                            <input type="text" class="form-control"
                                                   id="item_id_insert_to_bonus_donate"
                                                   placeholder="57">
                                        </div>
                                    </div>
                                    <div class="col-xxl-3 col-xl-3 mb-2">
                                        <div class="input-group">
                                            <div class="input-group-text">Count</div>
                                            <input type="text" class="form-control"
                                                   id="count_insert_to_bonus_donate"
                                                   placeholder="1000">
                                        </div>
                                    </div>
                                    <div class="col-xxl-4 col-xl-3 mb-2">
                                        <div class="input-group">
                                            <div class="input-group-text">Enchant</div>
                                            <input type="text" class="form-control"
                                                   id="enchant_insert_to_bonus_donate"
                                                   placeholder="0">
                                        </div>
                                    </div>
                                    <div class="col-xxl-2 col-xl-3 mb-2">
                                        <button id="add_insert_to_bonus_donate" type="submit"
                                                class="btn btn-primary">{{ phrase(438) }}
                                        </button>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="card custom-card shadow-none mb-3 border">
                            <div class="card-header">
                                <div class="card-title">
                                    {{ phrase('payment_system_settings') }}
                                </div>
                            </div>
                            <div class="card-body  align-items-start">
                                <div class="row">


                                    <div class="col-md-4">
                                        <div class="nav flex-column nav-pills me-3 tab-style-7" id="v-pills-tab"
                                             role="tablist" aria-orientation="vertical">
                                            {% for i, donate in donateSysNames %}
                                            <div class="nav-link text-start d-flex justify-content-between align-items-center {% if i == 0 %}active{% endif %} donatelistSort"
                                                 id="{{donate.name}}-tab"
                                                 data-bs-toggle="pill"
                                                 data-bs-target="#{{donate.name}}"
                                                 type="button" role="tab"
                                                 aria-controls="{{donate.name}}"
                                                 aria-selected="false" tabindex="-1"
                                                 data-order="{{i}}"
                                                 data-name="{{donate.name}}">  <!-- Сохраняем имя элемента -->
                                                {{donate.name}}

                                                <div class="ms-auto">
                                                    <i class="ri-arrow-down-line move-down" aria-hidden="true"
                                                       style="cursor: pointer;"></i>
                                                    <i class="ri-arrow-up-line move-up" aria-hidden="true"
                                                       style="cursor: pointer;"></i>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>

                                    <script>
                                        $(document).on('click', '.donatelistSort', function () {
                                            var target = $(this).data('bs-target'); // Получаем id целевой вкладки

                                            // Удаляем классы active и show у всех вкладок
                                            $('.donatePanelWrite').removeClass('active show');
                                            $('.donatelistSort').removeClass('active');

                                            // Добавляем классы active и show к выбранной вкладке
                                            $(target).addClass('active show');
                                            $(this).addClass('active');
                                        });

                                        // Перемещение вверх
                                        $(document).on('click', '.move-up', function () {
                                            var $current = $(this).closest('.donatelistSort');
                                            var $prev = $current.prev('.donatelistSort');

                                            if ($prev.length) {
                                                $current.insertBefore($prev);
                                                updateOrder();
                                            }
                                        });

                                        // Перемещение вниз
                                        $(document).on('click', '.move-down', function () {
                                            var $current = $(this).closest('.donatelistSort');
                                            var $next = $current.next('.donatelistSort');

                                            if ($next.length) {
                                                $current.insertAfter($next);
                                                updateOrder();
                                            }
                                        });

                                        // Функция для обновления порядка
                                        function updateOrder() {
                                            $('.donatelistSort').each(function (index) {
                                                var name = $(this).attr('data-name');
                                                $(this).attr('data-order', index);

                                                // Обновляем соответствующий инпут
                                                $('#sort_' + name).val(index);
                                            });
                                        }
                                    </script>


                                    <div class="col-md-8">
                                        <div class="tab-content" id="v-pills-tabContent">
                                            {% for i, donate in config().donate().getDonateSystems() %}

                                            <div class="tab-pane {% if i == 0 %}active show{% endif %} donatePanelWrite"
                                                 id="{{donate.getName()}}" role="tabpanel"
                                                 tabindex="0"
                                                 aria-labelledby="{{donate.getName()}}-tab">
                                                <div class="d-sm-flex">

                                                    <div data-pay-name="{{donate.getName()}}">
                                                        <div class="my-md-auto mt-4 ms-md-3">

                                                            <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                                                <div>
                                                                    <p class="fs-14 mb-1 fw-semibold">
                                                                        {{ phrase('enable_payment_system') }}
                                                                        {{donate.getName()}}</p>
                                                                </div>
                                                                <div class="custom-toggle-switch ms-sm-2 ms-0">
                                                                    <input id="is_enable_{{donate.getName()}}"
                                                                           name="is_enable_{{donate.getName()}}"
                                                                           type="checkbox"
                                                                           {% if donate.isEnable() %}checked{% endif %}>
                                                                    <label for="is_enable_{{donate.getName()}}"
                                                                           class="label-primary mb-1"></label>
                                                                </div>
                                                            </div>

                                                            <div class="d-sm-flex d-block align-items-top mb-4 justify-content-between">
                                                                <div>
                                                                    <p class="fs-14 mb-1 fw-semibold">
                                                                        {{ phrase('admin_only_enable') }}
                                                                        {{donate.getName()}}</p>
                                                                </div>
                                                                <div class="custom-toggle-switch ms-sm-2 ms-0">
                                                                    <input id="forAdmin_{{donate.getName()}}"
                                                                           name="forAdmin_{{donate.getName()}}"
                                                                           type="checkbox"
                                                                           {% if donate.forAdmin() %}checked{% endif %}>
                                                                    <label for="forAdmin_{{donate.getName()}}"
                                                                           class="label-primary mb-1"></label>
                                                                </div>
                                                            </div>
                                                            {% for key, val in donate.getInputs() %}
                                                            <div class="form-floating mb-3">
                                                                <input data-name="{{key}}"
                                                                       value="{{val}}"
                                                                       type="text"
                                                                       class="form-control"
                                                                       id="donateSys_{{key}}"
                                                                       placeholder="">
                                                                <label for="donateSys_{{key}}">{{key}}</label>
                                                            </div>
                                                            {% endfor %}


                                                            <hr>
                                                            <div class="form-floating mb-3">
                                                                <input
                                                                        value="{{donate.getDescription()}}"
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="description_{{donate.getName()}}"
                                                                        placeholder="">
                                                                <label for="description_{{donate.getName()}}">{{
                                                                    phrase('payment_system_description') }}</label>
                                                            </div>

                                                            <div class="border rounded-3 p-3">
                                                                <p class="fs-15 fw-semibold mb-2">Webhook</p>
                                                                <p class="fs-12 text-muted">На сайте платежной системы в
                                                                    качестве уведомлений после успешной оплаты укажите
                                                                    POST запрос на адрес:</p>
                                                                {{donate.getWebhookUrl()}}
                                                            </div>

                                                            <input type="hidden" value="{{donate.getSortValue()}}"
                                                                   id="sort_{{donate.getName()}}" class="sort-input">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {% endfor %}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <div class="card-footer">
                    <button type="button" class="btn btn-success saveDonateConfig">
                        Сохранить
                    </button>
                </div>
            </div>
        </div>
    </div>


</div>
{% endblock %}


{% block css %}

{% endblock %}


{% block js %}
<script>
    $(document).on('click', '.saveDonateConfig', function () {
        let tableItemsBonus = {}; // Инициализация результирующего объекта
        // Перебор всех вкладок и сбор данных
        $('#bonus_Item_donation .nav-tabs .nav-link').each(function () {
            var tabId = $(this).attr('id');
            var tabPaneId = $(this).attr('aria-controls');
            var tabValue = $(this).text().trim(); // Используем текст вкладки как ключ
            tableItemsBonus[tabValue] = gatherTableData(tabPaneId); // Сбор данных из таблицы вкладки
        });

        AjaxSend('/admin/setting/donate/save', 'POST', {
            serverId : '{{server.getId()}}',
            paySystemDefault: $('#paySystemDefault').val(),
            minSummaPaySphereCoin: $('#minSummaPaySphereCoin').val(),
            maxSummaPaySphereCoin: $('#maxSummaPaySphereCoin').val(),
            sphereCoinCost: $('#sphereCoinCost').val(),
            ratioUSD: $('#ratioUSD').val(),
            ratioEUR: $('#ratioEUR').val(),
            ratioUAH: $('#ratioUAH').val(),
            ratioRUB: $('#ratioRUB').val(),
            enableCumulativeDiscountSystem: $('#enableCumulativeDiscountSystem').is(':checked'),
            table_CumulativeDiscountSystem: extractTableData('table_CumulativeDiscountSystem'),
            enableOneTimeBonus: $('#enableOneTimeBonus').is(':checked'),
            table_EnableOneTimeBonus: extractTableData('table_EnableOneTimeBonus'),
            enableSystemDiscountsOnItemPurchases: $('#enableSystemDiscountsOnItemPurchases').is(':checked'),
            table_SystemDiscountsOnItemPurchases: extractTableData('table_SystemDiscountsOnItemPurchases'),
            enableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity: $('#enableIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity').is(':checked'),
            table_IncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity: extractTableData('table_IncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity'),
            table_ListOfItemsForDiscount: extractTableData('table_ListOfItemsForDiscount'),
            rewardForDonatingItems: $('#rewardForDonatingItems').is(':checked'),
            tableItemsBonus: tableItemsBonus,
            donateSystems: collectPaymentSystemsData(),
            item_id_to_game_transfer: $('#item_id_to_game_transfer').val(),
            count_items_to_game_transfer: $('#count_items_to_game_transfer').val(),
            donate_item_to_game_transfer: $('#donate_item_to_game_transfer').val(),
        }, false);
    });


    function addNewRow(tableId) {
        var newRow = `<tr>
            <th scope="row"><input type="text" class="form-control"></th>
            <td><input type="text" class="form-control"></td>
            <td>
                <div class="hstack gap-2 flex-wrap">
                    <a href="javascript:void(0);" class="text-success fs-14 lh-1"><i class="ri-save-3-line"></i></a>
                    <a href="javascript:void(0);" class="text-danger fs-14 lh-1"><i class="ri-delete-bin-5-line"></i></a>
                </div>
            </td>
          </tr>`;
        $(tableId + ' tbody').append(newRow);
    }

    $('#AddNewCumulativeDiscountSystem').click(function () {
        addNewRow('#table_CumulativeDiscountSystem');
    });


    $('#AddNewEnableOneTimeBonus').click(function () {
        addNewRow('#table_EnableOneTimeBonus');
    });

    $('#AddNewSystemDiscountsOnItemPurchases').click(function () {
        addNewRow('#table_SystemDiscountsOnItemPurchases');
    });

    $('#AddNewIncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity').click(function () {
        addNewRow('#table_IncludeOneTimeDiscountsOnThePurchaseOfItemsByQuantity');
    });

    $('#AddNewListOfItemsForDiscount').click(function () {
        addNewRow('#table_ListOfItemsForDiscount');
    });

    $('.table-responsive').on('click', '.ri-delete-bin-5-line', function () {
        $(this).closest('tr').remove();
    });

    $('.table-responsive').on('click', '.ri-edit-line', function () {
        var $row = $(this).closest('tr');
        var currentValue1 = $row.find('th:nth-child(1)').text().trim();
        var currentValue2 = $row.find('td:nth-child(1)').text().trim();
        var newRow = `<tr>
            <th scope="row"><input type="text" class="form-control" value="${currentValue1}"></th>
            <td><input type="text" class="form-control" value="${currentValue2}"></td>
            <td>
                <div class="hstack gap-2 flex-wrap">
                    <a href="javascript:void(0);" class="text-success fs-14 lh-1"><i class="ri-save-3-line"></i></a>
                    <a href="javascript:void(0);" class="text-danger fs-14 lh-1"><i class="ri-delete-bin-5-line"></i></a>
                </div>
            </td>
          </tr>`;
        $row.replaceWith(newRow);
    });

    $('.table-responsive').on('click', '.ri-save-3-line', function () {
        var $row = $(this).closest('tr');
        var input1Value = $row.find('th input').val().trim();
        var input2Value = $row.find('td input').val().trim();
        var updatedRow = `<tr>
            <th scope="row">${input1Value}</th>
            <td>${input2Value}</td>
            <td>
                <div class="hstack gap-2 flex-wrap">
                    <a href="javascript:void(0);" class="text-info fs-14 lh-1"><i class="ri-edit-line"></i></a>
                    <a href="javascript:void(0);" class="text-danger fs-14 lh-1"><i class="ri-delete-bin-5-line"></i></a>
                </div>
            </td>
          </tr>`;
        $row.replaceWith(updatedRow);
    });

    $(document).on('click', '.removeTableItemsBonus', function () {
        $(this).closest('tr').remove();
    });


    $('#add_insert_to_bonus_donate').click(function () {

        let itemId = $('#item_id_insert_to_bonus_donate').val();
        let count = $('#count_insert_to_bonus_donate').val();
        let enchant = $('#enchant_insert_to_bonus_donate').val();
        let activeTabPane = $('#bonus_Item_donation .tab-pane.active.show');

        let icon = '';
        AjaxSend('/admin/client/item/info', 'POST', {'itemID': itemId}, true).then(function (response) {
                icon = response.item.icon;
                let table = activeTabPane.find('table');
                let newRow = '<tr>' +
                    '<th scope="row"><span class="avatar avatar-sm"><img src="' + icon + '" alt="img"></span></th>' +
                    '<td>' + itemId + '</td>' +
                    '<td>' + count + '</td>' +
                    '<td>' + enchant + '</td>' +
                    '<td><a href="javascript:void(0);" class="text-danger fs-14 lh-1 removeTableItemsBonus"><i class="ri-delete-bin-5-line"></i></a></td>' +
                    '</tr>';
                table.find('tbody').append(newRow);
            },
        );

    });

    $(document).on('click', '#addCostItem', function () {
        var costItemName = $('#costItem').val(); // Получаем значение из поля ввода
        var tabID = 'list_' + costItemName.replace(/\s+/g, '-').toLowerCase(); // Преобразуем имя в ID с префиксом 'list_'
        var isActive = $('#myTab li').length === 0; // Проверяем, будет ли это первая вкладка
        var newTab = `
<li class="nav-item ${isActive ? 'active' : ''}" role="presentation">
    <button class="nav-link ${isActive ? 'active' : ''}" id="${tabID}-tab" data-bs-toggle="tab"
            data-bs-target="#${tabID}-pane" type="button" role="tab"
            aria-controls="${tabID}-pane" aria-selected="${isActive ? 'true' : 'false'}">${costItemName}</button>
</li>
`;
        $('#myTab').append(newTab);
        var newTabPane = `
<div class="tab-pane fade ${isActive ? 'show active' : ''}" id="${tabID}-pane" role="tabpanel"
     aria-labelledby="${tabID}-tab" tabindex="0">
    <div class="table-responsive">
        <table class="table mb-0">
            <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">Предмет</th>
                    <th scope="col">Кол-во</th>
                    <th scope="col">Заточен</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
`;
        $('#allItemsBonusData').append(newTabPane);
    });


    function extractTableData(tableId) {
        let data = [];
        $('#' + tableId + ' tbody tr').each(function () {
            let row = $(this);
            let obj = {};
            $('#' + tableId + ' thead th').each(function (index) {
                let dataName = $(this).data('name');
                if (dataName) {
                    let cellValue = row.find(index === 0 ? 'th:eq(' + index + ')' : 'td:eq(' + (index - 1) + ')').text().trim();
                    obj[dataName] = cellValue;
                }
            });
            data.push(obj);
        });
        return data;
    }


    function gatherTableData(tabPaneId) {
        var data = []; // Инициализация массива данных для текущей вкладки
        $('#bonus_Item_donation #' + tabPaneId + ' .table tbody tr').each(function () {
            var rowData = {
                id: $(this).find('td:nth-child(2)').text().trim(),
                count: $(this).find('td:nth-child(3)').text().trim(),
                enchant: $(this).find('td:nth-child(4)').text().trim(),
            };
            data.push(rowData); // Добавление данных текущей строки в массив
        });
        return data;
    }


    function collectPaymentSystemsData() {
        var systemsData = [];

        // Итерируем через все блоки платежных систем
        $('[data-pay-name]').each(function () {
            var payName = $(this).data('pay-name'); // Получаем имя платежной системы
            var isEnabled = $('#is_enable_' + payName).is(':checked'); // Проверяем, включена ли система
            var forAdmin = $('#forAdmin_' + payName).is(':checked'); // Проверяем, является ли система по умолчанию для администратора
            var description = $('#description_' + payName).val(); // Получаем описание платежной системы
            var sort = $('#sort_' + payName).val(); // Получаем описание платежной системы

            var inputsData = {};
            // Итерируем через все поля ввода текущей платежной системы
            $(this).find('[data-name]').each(function () {
                var inputName = $(this).data('name'); // Получаем имя поля
                var inputValue = $(this).val(); // Получаем значение поля
                inputsData[inputName] = inputValue; // Сохраняем данные поля
            });


            // Собираем и сохраняем данные платежной системы
            systemsData.push({
                [payName]: {
                    enable: isEnabled,
                    forAdmin: forAdmin,
                    inputs: inputsData,
                    description: description,
                    sort: sort,
                },
            });
        });

        return systemsData;
    }


</script>
{% endblock %}

