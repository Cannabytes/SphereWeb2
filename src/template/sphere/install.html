<!DOCTYPE html>
<html lang="en" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light"
      data-menu-styles="light" data-toggled="close">

<head>

  <!-- Meta Data -->
  <meta charset="UTF-8">
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Sash – Bootstrap 5 Admin &amp; Dashboard Template </title>
  <meta name="Description" content="Bootstrap Responsive Admin Web Dashboard HTML5 Template">
  <meta name="Author" content="Spruko Technologies Private Limited">
  <meta name="keywords"
        content="admin dashboard,dashboard design htmlbootstrap admin template,html admin panel,admin dashboard html,admin panel html template,bootstrap dashboard,html admin template,html dashboard,html admin dashboard template,bootstrap dashboard template,dashboard html template,bootstrap admin panel,dashboard admin bootstrap,bootstrap admin dashboard">

  <!-- Favicon -->
  <link rel="icon" href="{{template}}/assets/images/brand-logos/favicon.ico" type="image/x-icon">

  <!-- Main Theme Js -->
  <script src="{{template}}/assets/js/authentication-main.js"></script>

  <!-- Bootstrap Css -->
  <link id="style" href="{{template}}/assets/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Style Css -->
  <link href="{{template}}/assets/css/styles.min.css" rel="stylesheet">

  <link href="{{template}}/assets/libs/simplebar/simplebar.min.css" rel="stylesheet">


  <!-- Icons Css -->
  <link href="{{template}}/assets/css/icons.min.css" rel="stylesheet">


</head>

<body>


<!-- Loader -->
<div id="loader">
  <img src="{{template}}/assets/images/media/loader.svg" alt="">
</div>
<!-- Loader -->

<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="successToast" class="toast colored-toast bg-success-transparent" role="alert" aria-live="assertive"
       aria-atomic="true">
    <div class="toast-header bg-success text-fixed-white">
      <img class="bd-placeholder-img rounded me-2" src="{{template}}/assets/images/brand-logos/toggle-white.png"
           alt="...">
      <strong class="me-auto" id="successTitleMessageNotice"></strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast"
              aria-label="Close"></button>
    </div>
    <div class="toast-body" id="successContentMessageNotice"></div>
  </div>

  <div id="dangerToast" class="toast colored-toast bg-danger-transparent" role="alert" aria-live="assertive"
       aria-atomic="true">
    <div class="toast-header bg-danger text-fixed-white">
      <img class="bd-placeholder-img rounded me-2" src="{{template}}/assets/images/brand-logos/toggle-white.png"
           alt="...">
      <strong class="me-auto" id="dangerTitleMessageNotice"></strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast"
              aria-label="Close"></button>
    </div>
    <div class="toast-body" id="dangerContentMessageNotice"></div>
  </div>
</div>

<div class="bg-dark-gradient ">

  <div class="container-lg">
    <div class="row justify-content-center authentication authentication-basic align-items-center h-100">
      <div class="row">
        <div class="col-xl-12">
          <div class="card custom-card">
            <div class="card-body p-0 product-checkout">
              <ul
                class="nav nav-tabs tab-style-2 d-sm-flex d-block border-bottom border-block-end-dashed justify-content-between"
                id="myTab1" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="order-tab" data-bs-toggle="tab"
                          data-bs-target="#order-tab-pane" type="button" role="tab"
                          aria-controls="order-tab" aria-selected="true"><i
                    class="ri-truck-line me-2 align-middle"></i>Лицензионное соглашение
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button disabled class="nav-link" id="minimum-requirements" data-bs-toggle="tab"
                          data-bs-target="#minimum-requirements-tab-pane" type="button" role="tab"
                          aria-controls="minimum-requirements" aria-selected="false"><i
                    class="ri-bank-card-line me-2 align-middle"></i>Минимальные требования
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button disabled class="nav-link" id="mysql-tab" data-bs-toggle="tab"
                          data-bs-target="#mysql-tab-pane" type="button" role="tab"
                          aria-controls="mysql-tab" aria-selected="false"><i
                    class="ri-user-3-line me-2 align-middle"></i>Подключение к БД
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button disabled class="nav-link" id="admin-tab" data-bs-toggle="tab"
                          data-bs-target="#admin-tab-pane" type="button" role="tab"
                          aria-controls="admin-tab" aria-selected="false"><i
                    class="ri-user-3-line me-2 align-middle"></i>Администратор
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button disabled class="nav-link" id="install-tab" data-bs-toggle="tab"
                          data-bs-target="#install-tab-pane" type="button" role="tab"
                          aria-controls="install-tab" aria-selected="false"><i
                    class="ri-checkbox-circle-line me-2 align-middle"></i>Confirmation
                  </button>
                </li>
              </ul>
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active border-0 p-0" id="order-tab-pane" role="tabpanel"
                     aria-labelledby="order-tab-pane" tabindex="0">


                  <div class="row justify-content-center">
                    <div class="col-xl-12">
                      <div class="card custom-card overflow-hidden">
                        <div class="card-body p-0 ">
                          <div class="p-4 text-muted terms-conditions" id="terms-scroll">
                            <h6 class="fw-bold pb-3 text-default ">Лицензионное соглашение</h6>

                            <p class="mb-0 pb-3">

                            <p class="mb-3 ">
                              <span
                                class="fw-bold text-default">1. Лицензия на использование Программного обеспечения</span><br>
                              1.1. Лицензиар предоставляет вам неисключительную, непередаваемую лицензию на
                              использование Программного обеспечения в соответствии с условиями настоящего
                              Соглашения.<br>
                              1.2. В рамках данной лицензии вы имеете право использовать Программное обеспечение только
                              в некоммерческих целях.<br>
                              1.3. Вы не имеете права продавать, сдавать в аренду, лицензировать, изменять,
                              адаптировать, распространять, переводить, декомпилировать, реверс-инжинирить, или
                              создавать производные работы на основе Программного обеспечения без явного письменного
                              разрешения Лицензиара.<br>
                            </p>

                            <p class="mb-0  pb-3">
                              <span class="fw-bold text-default">2. Ограниченная гарантия</span><br>
                              2.1. Программное обеспечение предоставляется "как есть", без каких-либо явных или
                              подразумеваемых гарантий, включая, но не ограничиваясь, подразумеваемыми гарантиями
                              коммерческой ценности, пригодности для конкретной цели или отсутствия нарушения прав.<br>
                            </p>

                            <p class="mb-0 pb-3">
                              <span class="fw-bold text-default">3. Ограничение ответственности</span><br>
                              3.1. В случае возникновения любых претензий, убытков или других обязательств, возникших в
                              результате использования Программного обеспечения, Лицензиар не несет ответственности
                              перед вами или третьими лицами.<br>
                            </p>

                            <p class="mb-0 pb-3">
                              <span class="fw-bold text-default">4. Запрет на продажу или изменение</span><br>
                              4.1. Вы не имеете права продавать, сдавать в аренду, лицензировать, изменять,
                              адаптировать, распространять, переводить, декомпилировать, реверс-инжинирить, или
                              создавать производные работы на основе Программного обеспечения без явного письменного
                              разрешения Лицензиара.<br>
                            </p>

                            <p class="mb-0 pb-3">
                              <span class="fw-bold text-default">5. Изучение исходного кода</span><br>
                              5.1. Вы имеете право изучать исходный код Программного обеспечения для личного познания и
                              обучения.<br>
                            </p>

                            <p class="mb-0 pb-3">
                              <span class="fw-bold text-default">6. Обращение за доработками</span><br>
                              6.1. В случае необходимости доработок или модификаций Программного обеспечения, вы
                              обязуетесь обращаться к Лицензиару для получения разрешения и согласования.<br>
                            </p>


                            <p class="mb-0 pb-3">
                              <span class="fw-bold text-default">7. Разрешение споров</span><br>
                              7.1. В случае возникновения споров, связанных с настоящим Соглашением, стороны обязуются
                              пытаться разрешить их путем переговоров.<br>
                              7.2. Если споры не могут быть разрешены путем переговоров, они подлежат разрешению в
                              соответствии с законодательством.<br>
                            </p>

                            <p class="mb-0 pb-3">
                              <span class="fw-bold text-default">8. Прочие условия</span><br>
                              8.1. Настоящее Соглашение является полным соглашением между вами и Лицензиаром
                              относительно Программного обеспечения и заменяет все предыдущие или одновременные
                              соглашения и обещания, явные или подразумеваемые, касающиеся данного предмета.<br>
                              8.2. Настоящее Соглашение регулируется и должно интерпретироваться в соответствии с
                              законодательством.<br>
                              8.3. Настоящее Соглашение вступает в силу с момента вашего начала использования
                              Программного обеспечения и действует до момента его прекращения.<br>
                            </p>

                            <footer class="mt-5">
                              <p>Подписано и согласовано: Sphere Project Developer</p>
                              <p>Дата: 04 May 2024.</p>
                            </footer>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>


                  <div class="px-4 py-3 border-top border-block-start-dashed d-sm-flex justify-content-end">
                    <button type="button" class="btn btn-success-light" id="termsApply">Принимаю условия<i
                      class="ri-user-3-line ms-2 align-middle d-inline-block"></i></button>
                  </div>


                </div>


                <div class="tab-pane fade border-0 p-0" id="minimum-requirements-tab-pane" role="tabpanel"

                     aria-labelledby="minimum-requirements-tab-pane" tabindex="0">
                  <div class="p-4">

                    <div class="row">
                      <div class="col-xl-12">
                        <div class="card custom-card">

                          <div class="table-responsive table-sm">
                            <table class="table text-nowrap">
                              <thead>
                              <tr>
                                <th scope="col">Название</th>
                                <th scope="col">Минимум</th>
                                <th scope="col">Сейчас</th>
                                <th scope="col">Статус</th>
                              </tr>
                              </thead>
                              <tbody>


                              {% for info in php_informations %}
                              <tr>
                                <th scope="row">{{info.name}}</th>
                                <th>{{info.min}}</th>
                                <th>{{info.get}}</th>
                                <th>{{info.allow ? '<i class="fe fe-check text-success"></i>' : '<i aria-hidden="true"
                                                                                                    class="fe fe-alert-circle text-danger"></i>'
                                  }}
                                </th>
                              </tr>
                              {% endfor %}


                              {% for ext in extensions %}
                              <tr>
                                <th scope="row">PHP модуль: {{ext.name}}</th>
                                <td></td>
                                <td></td>
                                <th>{{ext.allow ? '<i class="fe fe-check text-success"></i>' : '<i aria-hidden="true"
                                                                                                    class="fe fe-alert-circle text-danger"></i>'
                                  }}
                                </th>
                              </tr>
                              {% endfor %}

                              {% for dir in dir_permissions %}
                              <tr>
                                <th scope="row">{{ dir.path }}</th>
                                <td></td>
                                <td></td>
                                <td>{{ dir.per ? '<i aria-hidden="true" class="fe fe-check text-success"></i>' : '<i
                                  aria-hidden="true" class="fe fe-alert-circle text-danger"></i>' }}
                                </td>
                              </tr>
                              {% endfor %}

                              <tr>
                                <th scope="row">File: <a target="_blank"
                                                         href="https://github.com/Cannabytes/SphereWeb/blob/master/.htaccess">.htaccess</a>
                                </th>
                                <td></td>
                                <td></td>
                                <th>{{htaccess ? '<i aria-hidden="true" class="fe fe-check text-success"></i>' : '<i
                                  aria-hidden="true" class="fe fe-alert-circle text-danger"></i>' }}
                                </th>
                              </tr>

                              <tr>
                                <th scope="row">Apache</th>
                                <td>2.4</td>
                                <td></td>
                                <td></td>
                              </tr>
                              <tr>
                                <th scope="row">MySQL (MariaDB)</th>
                                <td>5.8</td>
                                <td></td>
                                <td></td>
                              </tr>
                              <tr>
                                <th scope="row">Оперативная память</th>
                                <td>1 GB</td>
                                <td></td>
                                <td></td>
                              </tr>
                              <tr>
                                <th scope="row">Доступное место на диске</th>
                                <td>3 GB</td>
                                <td></td>
                                <td></td>
                              </tr>

                              </tbody>
                            </table>
                          </div>

                        </div>
                      </div>

                    </div>

                  </div>
                  <div class="px-4 py-3 border-top border-block-start-dashed d-sm-flex justify-content-end">
                    <button type="button" class="btn btn-success-light" id="nextToConnectDB">Далее</button>
                  </div>

                </div>

                <div class="tab-pane fade border-0 p-0" id="mysql-tab-pane"
                     role="tabpanel" aria-labelledby="mysql-tab-pane" tabindex="0">
                  <div class="p-4">
                    <div class="fs-15 fw-semibold d-sm-flex d-block align-items-center justify-content-between mb-3">
                      <div>Подключение к БД MySQL / MariaDB</div>
                    </div>
                    <div class="row gy-4">

                      <div class="col-xl-2">
                        <label for="host" class="form-label">Host</label>
                        <input type="text" class="form-control" id="host" placeholder="127.0.0.1" value="127.0.0.1">
                      </div>

                      <div class="col-xl-2">
                        <label for="port" class="form-label">Port</label>
                        <input type="text" class="form-control" id="port" placeholder="3306" value="3306">
                      </div>

                      <div class="col-xl-2">
                        <label for="user" class="form-label">User</label>
                        <input type="text" class="form-control" id="user" placeholder="root" value="root">
                      </div>

                      <div class="col-xl-2">
                        <label for="password" class="form-label">Password</label>
                        <input type="text" class="form-control" id="password" placeholder="" value="">
                      </div>

                      <div class="col-xl-2">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" placeholder="sphere" value="sphere">
                      </div>

                      <div class="col-xl-2">
                        <label for="mysqlConnect" class="form-label">Проверка соединения</label>
                        <button type="button" class="btn btn-primary" id="mysqlConnect" value="">Connect</button>
                      </div>

                    </div>
                  </div>


                  <div class="px-4 py-3 border-top border-block-start-dashed d-sm-flex justify-content-end">
                    <button type="button" class="btn btn-success-light m-1" id="nextToCreateAdmin">Далее</button>
                  </div>
                </div>

                <div class="tab-pane fade border-0 p-0" id="admin-tab-pane"
                     role="tabpanel" aria-labelledby="mysql-tab-pane" tabindex="0">
                  <div class="p-4">
                    <div class="fs-15 fw-semibold d-sm-flex d-block align-items-center justify-content-between mb-3">
                      <div>Создание учетной записи администратора</div>
                    </div>
                    <div class="row gy-4">

                      <div class="col-xl-2">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="" value="">
                      </div>

                      <div class="col-xl-2">
                        <label for="nickname" class="form-label">Name</label>
                        <input type="text" class="form-control" id="nickname" placeholder="">
                      </div>

                      <div class="col-xl-2">
                        <label for="adminPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="" value="">
                      </div>

                    </div>
                  </div>


                  <div class="px-4 py-3 border-top border-block-start-dashed d-sm-flex justify-content-end">
                    <button type="button" class="btn btn-success-light" id="nextToInstall">Далее</button>
                  </div>
                </div>

                <div class="tab-pane fade border-0 p-0" id="install-tab-pane" role="tabpanel"
                     aria-labelledby="install-tab-pane" tabindex="0">
                  <div class="p-5 checkout-payment-success my-3">
                    <div class="mb-5">
                      <h5 class="text-success fw-semibold">Можно приступить к установки SphereWeb &#129309;</h5>
                    </div>

                    <div class="mb-4">
                    </div>

                    <button type="button" id="install" class="btn btn-success">Начать установку<i class="bi bi-cart ms-2"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script src="{{template}}/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>


<script src="{{template}}/assets/libs/simplebar/simplebar.min.js"></script>

<script src="{{template}}/assets/js/terms_conditions.js"></script>

<script src="{{template}}/assets/js/Toasts.js"></script>
<script src="{{template}}/assets/js/general.js"></script>

<script>
  $('#termsApply').click(function () {
    $('#minimum-requirements').tab('show');
    $('#minimum-requirements').removeAttr('disabled');
  });

  $('#nextToConnectDB').click(function () {
    $('#mysql-tab').tab('show');
    $('#mysql-tab').removeAttr('disabled');
  });

  $('#nextToCreateAdmin').click(function () {
    checkConnectDB().then(function() {
      if(MySQLVersionOK) {
        $('#admin-tab').tab('show');
        $('#admin-tab').removeAttr('disabled');
      } else {
        noticeError("Необходимо установить соединение с MySQL");
      }
    });
  });

  $('#nextToInstall').click(function () {

    let email = $('#email').val();
    let nickname = $('#nickname').val();
    let password = $('#adminPassword').val();

    if (!email || !nickname || !password) {
      noticeError("Заполните все обязательные поля");
      return;
    }
    // Проверяем валидность email адреса
    if (!isEmail(email)) {
      noticeError("Некорректный email");
      return;
    }

    // Проверяем длину пароля
    if (password.length < 6) {
      noticeError("Пароль должен содержать не менее 6 символов");
      return;
    }

    // Проверяем длину никнейма
    if (nickname.length < 3) {
      noticeError("Никнейм должен содержать не менее 3 символов");
      return;
    }


    $('#install-tab').tab('show');
    $('#install-tab').removeAttr('disabled');
  });


  function isEmail(email) {
    let regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    return regex.test(email);
  }

  var MySQLVersion = 0;
  var MySQLVersionOK = false;

  $('#mysqlConnect').click(function () {
    $(this).addClass('loading');
    checkConnectDB(function () {
      $('#mysqlConnect').removeClass('loading');
      if (MySQLVersionOK) {
        $('#admin-tab').tab('show');
        $('#admin-tab').removeAttr('disabled');
      }
    });
  });

  function checkConnectDB() {
    return new Promise(function(resolve, reject) {
      $.ajax({
        type: 'POST',
        url: '{{action("install_connect_test_db")}}',
        data: {
          host: $('#host').val(),
          name: $('#name').val(),
          user: $('#user').val(),
          password: $('#password').val(),
          port: $('#port').val(),
        },
        dataType: 'json',
        encode: true,
      }).done(function (data) {
        needMinMySQLVer = parseFloat('{{need_mysql_version}}');
        if (data.ok) {
          MySQLVersion = parseFloat(data.mysqlVersion);
          if(MySQLVersion >= needMinMySQLVer) {
            resolve("Соединение с MySQL прошло успешно");
          } else {
            reject("Версия MySQL должна быть не менее " + needMinMySQLVer);
          }
        }else{
          reject("Соединение с MySQL не удалось");
        }
      });
    }).then(function(message) {
      noticeSuccess(message);
      MySQLVersionOK = true;
    }).catch(function(message) {
      noticeError(message);
    });
  }


  $("#install").click(function () {
     AjaxSend("/install", "POST", {
       email: $('#email').val(),
       nickname: $('#nickname').val(),
       adminPassword: $('#adminPassword').val(),

       host: $('#host').val(),
       name: $('#name').val(),
       user: $('#user').val(),
       password: $('#password').val(),
       port: $('#port').val(),
     }, true).then(function (data) {
       ResponseNotice(data);
     })
  });






</script>

</body>

</html>